<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="data:image/svg+xml;base64," type="image/svg+xml">
    <title>Axiom Files -- Axiom Republic</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Base styles matching the chat interface */
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
            display: flex;
            height: 100vh;
            margin: 0;
            background: #f8f9fa;
        }
        
        .sidebar {
            width: 320px;
            border-right: 1px solid #eee;
            padding: 16px;
            box-sizing: border-box;
            overflow: auto;
            background: #fff;
            transition: all 0.3s ease;
        }
        
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            padding: 12px;
            border-bottom: 1px solid #eee;
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .content {
            flex: 1;
            padding: 20px;
            overflow: auto;
            background: #f8f9fa;
        }
        
        button {
            padding: 8px 12px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #4a90e2;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3a7bc8;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        /* Download-specific styles */
        .download-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .download-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 12px;
            border: 1px solid #eee;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        .download-item:hover {
            background: #f0f5ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .file-info {
            flex: 1;
        }
        
        .file-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .file-details {
            font-size: 0.85rem;
            color: #666;
        }
        
        .download-btn {
            padding: 8px 16px;
            font-weight: 500;
        }
        
        .category-title {
            font-size: 1.2rem;
            margin-bottom: 16px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .sidebar { 
                width: 100%; 
                height: auto; 
                border-right: none; 
                border-bottom: 1px solid #eee; 
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>Download Categories</h2>
        <div class="category-list">
            <div class="download-item">
                <div class="file-info">
                    <div class="file-name">Software & Apps</div>
                    <div class="file-details">Applications and Games</div>
                </div>
            </div>
            <div class="download-item">
                <div class="file-info">
                    <div class="file-name">Documents</div>
                    <div class="file-details">Tutorials & Guides</div>
                </div>
            </div>
            <div class="download-item">
                <div class="file-info">
                    <div class="file-name">Media</div>
                    <div class="file-details">Images, videos, and audio</div>
                </div>
            </div>
            <div class="download-item">
                <div class="file-info">
                    <div class="file-name">Archives</div>
                    <div class="file-details">Stuff LONG ago or do not need anymore.</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="main">
        <div class="header">
            <h2>File Downloads</h2>
        </div>
        
        <div class="content">
            <div class="download-section">
                <h3 class="category-title">Software Downloads</h3>
                
                <div class="download-item">
                    <div class="file-info">
                        <div class="file-name">Axiom Chat(Pre PX Chat).html</div>
                        <div class="file-details">Version Pre1.5 HTML • ? MB • Browser • In Progress</div>
                    </div>
                    <button class="download-btn btn-primary" data-filename="Axiom Chat(Pre PX Chat).html" data-filetype="text/html">
                        Download
                    </button>
                </div>
                <div class="download-item">
                    <div class="file-info">
                        <div class="file-name">GAME -- Ravenfield -- </div>
                        <div class="file-details">APP • ~ 800 MB • Mac</div>
                    </div>
                    <button class="download-btn btn-primary" onclick="window.location.href='https://pan.baidu.com/s/18DXl5z7MCtRY5eAyp3jGww?pwd=9999'">
                        Download Link
                    </button>
                </div>
                <div class="download-item">
                    <div class="file-info">
                        <div class="file-name">Minecraft.zip</div>
                        <div class="file-details">APP • 11.8 MB • Windows, Mac</div>
                    </div>
                    <button class="download-btn btn-primary" data-filename="Image Editor Pro.zip" data-filetype="application/zip">
                        Download
                    </button>
                </div>
            </div>
            
            <div class="download-section">
                <h3 class="category-title">Documentation</h3>
                
                <div class="download-item">
                    <div class="file-info">
                        <div class="file-name">Axiom Tutorials.txt</div>
                        <div class="file-details">TXT • 109 KB • Comprehensive guide</div>
                    </div>
                    <button class="download-btn btn-primary" data-filename="User Manual.pdf" data-filetype="application/pdf">
                        Download
                    </button>
                </div>
            </div>
            
            <div class="download-section">
                <h3 class="category-title">Media Files</h3>
                
                <div class="download-item">
                    <div class="file-info">
                        <div class="file-name">Product Demo Video</div>
                        <div class="file-details">MP4 • 45.2 MB • 5 minute overview</div>
                    </div>
                    <button class="download-btn btn-primary" data-filename="Product Demo Video.mp4" data-filetype="video/mp4">
                        Download
                    </button>
                </div>
                
                <div class="download-item">
                    <div class="file-info">
                        <div class="file-name">Brand Assets</div>
                        <div class="file-details">ZIP • 12.8 MB • Logos and images</div>
                    </div>
                    <button class="download-btn btn-primary" data-filename="Brand Assets.zip" data-filetype="application/zip">
                        Download
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Base64 file data storage
        const fileData = {
            // Add your Base64 data here later
            // Example format:
            "Axiom Chat(Pre PX Chat).html": "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEiPgo8dGl0bGU+QXhpb20gR2xvYmFsICYgUHJpdmF0ZSBDaGF0IC0tIEF4aW9tIFJlcHVibGljPC90aXRsZT4KPHN0eWxlPgpib2R5e2ZvbnQtZmFtaWx5OnN5c3RlbS11aSwtYXBwbGUtc3lzdGVtLFNlZ29lIFVJLFJvYm90byxIZWx2ZXRpY2EsQXJpYWw7ZGlzcGxheTpmbGV4O2hlaWdodDoxMDB2aDttYXJnaW46MDtiYWNrZ3JvdW5kOiNmOGY5ZmE7fQouc2lkZWJhcnt3aWR0aDozMjBweDtib3JkZXItcmlnaHQ6MXB4IHNvbGlkICNlZWU7cGFkZGluZzoxNnB4O2JveC1zaXppbmc6Ym9yZGVyLWJveDtvdmVyZmxvdzphdXRvO2JhY2tncm91bmQ6I2ZmZjt0cmFuc2l0aW9uOmFsbCAwLjNzIGVhc2U7fQoubWFpbntmbGV4OjE7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn0KLmhlYWRlcntwYWRkaW5nOjEycHg7Ym9yZGVyLWJvdHRvbToxcHggc29saWQgI2VlZTtiYWNrZ3JvdW5kOiNmZmY7Ym94LXNoYWRvdzowIDJweCA0cHggcmdiYSgwLDAsMCwwLjA1KTt9Ci5tZXNzYWdlc3tmbGV4OjE7cGFkZGluZzoxMnB4O292ZXJmbG93OmF1dG87YmFja2dyb3VuZDojZjhmOWZhO30KLmNvbXBvc2Vye2Rpc3BsYXk6ZmxleDtwYWRkaW5nOjEycHg7Ym9yZGVyLXRvcDoxcHggc29saWQgI2VlZTtiYWNrZ3JvdW5kOiNmZmY7fQouY29tcG9zZXIgaW5wdXR7ZmxleDoxO3BhZGRpbmc6OHB4O21hcmdpbi1yaWdodDo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci1yYWRpdXM6MjBweDt0cmFuc2l0aW9uOmFsbCAwLjNzIGVhc2U7fQouY29tcG9zZXIgaW5wdXQ6Zm9jdXN7b3V0bGluZTpub25lO2JvcmRlci1jb2xvcjojNGE5MGUyO2JveC1zaGFkb3c6MCAwIDAgMnB4IHJnYmEoNzQsMTQ0LDIyNiwwLjIpO30KYnV0dG9ue3BhZGRpbmc6OHB4IDEycHg7Y3Vyc29yOnBvaW50ZXI7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo2cHg7dHJhbnNpdGlvbjphbGwgMC4ycyBlYXNlO30KLmZyaWVuZCwgLmNoYXQtYnRue3BhZGRpbmc6OHB4O2JvcmRlci1yYWRpdXM6NnB4O2N1cnNvcjpwb2ludGVyO21hcmdpbi1ib3R0b206NHB4O3RyYW5zaXRpb246YWxsIDAuMnMgZWFzZTtwb3NpdGlvbjpyZWxhdGl2ZTt9Ci5mcmllbmQ6aG92ZXIsIC5jaGF0LWJ0bjpob3ZlcntiYWNrZ3JvdW5kOiNmMGY1ZmY7dHJhbnNmb3JtOnRyYW5zbGF0ZVkoLTFweCk7fQoubWV7Y29sb3I6Z3JlZW59Ci5tc2d7bWFyZ2luOjhweCAwO3BhZGRpbmc6OHB4IDEycHg7Ym9yZGVyLXJhZGl1czoxMnB4O21heC13aWR0aDo4MCU7YW5pbWF0aW9uOmZhZGVJbiAwLjNzIGVhc2U7cG9zaXRpb246cmVsYXRpdmU7fQoubXNnIC5mcm9te2ZvbnQtd2VpZ2h0OjYwMH0KZm9ybXtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2dhcDo4cHh9CmlucHV0W3R5cGU9dGV4dF0saW5wdXRbdHlwZT1wYXNzd29yZF17cGFkZGluZzo4cHg7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO2JvcmRlci1yYWRpdXM6NHB4O3RyYW5zaXRpb246YWxsIDAuM3MgZWFzZTt9CmlucHV0W3R5cGU9dGV4dF06Zm9jdXMsaW5wdXRbdHlwZT1wYXNzd29yZF06Zm9jdXN7b3V0bGluZTpub25lO2JvcmRlci1jb2xvcjojNGE5MGUyO2JveC1zaGFkb3c6MCAwIDAgMnB4IHJnYmEoNzQsMTQ0LDIyNiwwLjIpO30KaDR7bWFyZ2luLXRvcDoxMnB4O21hcmdpbi1ib3R0b206NHB4O30KLnN0YXR1cy1kb3R7Zm9udC13ZWlnaHQ6Ym9sZDttYXJnaW4tcmlnaHQ6NHB4O30KCi8qIE5ldyBzdHlsZXMgZm9yIGVuaGFuY2VkIFVJICovCiNhdXRoLWFyZWEge2FuaW1hdGlvbjogZmFkZUluIDAuNXMgZWFzZTt9CiNmcmllbmRzLWFyZWEge2FuaW1hdGlvbjogc2xpZGVJbiAwLjVzIGVhc2U7fQoKLyogTWVzc2FnZSBzdHlsZXMgKi8KLm1zZy5vd24ge2JhY2tncm91bmQ6I2UzZjJmZDttYXJnaW4tbGVmdDphdXRvO2JvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOjRweDt9Ci5tc2cub3RoZXIge2JhY2tncm91bmQ6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNlMGUwZTA7Ym9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czo0cHg7fQoKLyogU3RhdHVzIGluZGljYXRvcnMgKi8KLnN0YXR1cy1vbmxpbmUge2NvbG9yOiM0Y2FmNTA7fQouc3RhdHVzLW9mZmxpbmUge2NvbG9yOiM5ZTllOWU7fQouc3RhdHVzLXR5cGluZyB7Y29sb3I6I2ZmOTgwMDt9CgovKiBUeXBpbmcgaW5kaWNhdG9yIGFuaW1hdGlvbiAqLwoudHlwaW5nLWluZGljYXRvciB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIG1hcmdpbi1sZWZ0OiA4cHg7Cn0KLnR5cGluZy1kb3QgewogIGRpc3BsYXk6IGlubGluZS1ibG9jazsKICB3aWR0aDogNnB4OwogIGhlaWdodDogNnB4OwogIGJvcmRlci1yYWRpdXM6IDUwJTsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjOTk5OwogIG1hcmdpbi1yaWdodDogMnB4OwogIGFuaW1hdGlvbjogdHlwaW5nIDEuNHMgaW5maW5pdGUgZWFzZS1pbi1vdXQ7Cn0KLnR5cGluZy1kb3Q6bnRoLWNoaWxkKDEpIHsgYW5pbWF0aW9uLWRlbGF5OiAtMC4zMnM7IH0KLnR5cGluZy1kb3Q6bnRoLWNoaWxkKDIpIHsgYW5pbWF0aW9uLWRlbGF5OiAtMC4xNnM7IH0KCi8qIEJ1dHRvbiBzdHlsZXMgKi8KLmJ0bi1wcmltYXJ5IHtiYWNrZ3JvdW5kOiM0YTkwZTI7Y29sb3I6d2hpdGU7fQouYnRuLXByaW1hcnk6aG92ZXIge2JhY2tncm91bmQ6IzNhN2JjODtib3gtc2hhZG93OjAgMnB4IDRweCByZ2JhKDAsMCwwLDAuMSk7fQouYnRuLXNlY29uZGFyeSB7YmFja2dyb3VuZDojZjVmNWY1O2NvbG9yOiMzMzM7fQouYnRuLXNlY29uZGFyeTpob3ZlciB7YmFja2dyb3VuZDojZTBlMGUwO30KCi8qIEFuaW1hdGlvbnMgKi8KQGtleWZyYW1lcyBmYWRlSW4gewogIGZyb20geyBvcGFjaXR5OiAwOyB9CiAgdG8geyBvcGFjaXR5OiAxOyB9Cn0KCkBrZXlmcmFtZXMgc2xpZGVJbiB7CiAgZnJvbSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtMjBweCk7IG9wYWNpdHk6IDA7IH0KICB0byB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWCgwKTsgb3BhY2l0eTogMTsgfQp9CgpAa2V5ZnJhbWVzIHR5cGluZyB7CiAgMCUsIDYwJSwgMTAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsgfQogIDMwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNXB4KTsgfQp9CgpAa2V5ZnJhbWVzIHB1bHNlIHsKICAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMSk7IH0KICA1MCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEuMDUpOyB9CiAgMTAwJSB7IHRyYW5zZm9ybTogc2NhbGUoMSk7IH0KfQoKQGtleWZyYW1lcyBtZXNzYWdlU2xpZGUgewogIGZyb20geyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoMTBweCk7IG9wYWNpdHk6IDA7IH0KICB0byB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgwKTsgb3BhY2l0eTogMTsgfQp9CgovKiBNZXNzYWdlIG91dGxpbmUgZmxhc2ggZWZmZWN0cyAtIEZJWEVEIEVRVUFMIFNQRUVEICovCi8qIE1lc3NhZ2Ugb3V0bGluZSBmbGFzaCBlZmZlY3RzIC0gRklYRUQgSEVJR0hUIElTU1VFICovCi8qIE1lc3NhZ2Ugb3V0bGluZSBmbGFzaCBlZmZlY3RzIC0gRklYRUQgV0hJVEUgRkxBU0ggKi8KLyogTWVzc2FnZSBvdXRsaW5lIGZsYXNoIGVmZmVjdHMgLSBOTyBPVVRMSU5FLCBPTkxZIEJPWC1TSEFET1cgKi8KLyogTWVzc2FnZSBvdXRsaW5lIGZsYXNoIGVmZmVjdHMgLSBCSUcgRFJBTUFUSUMgR0xPVyAqLwpAa2V5ZnJhbWVzIG91dGxpbmVGbGFzaFNlbmQgewogIDAlLCAxMDAlIHsgCiAgICBib3gtc2hhZG93OiAKICAgICAgMCAwIDAgMCByZ2JhKDc0LCAxNDQsIDIyNiwgMCksCiAgICAgIDAgMCAwIDAgcmdiYSg3NCwgMTQ0LCAyMjYsIDApOwogIH0KICA1MCUgeyAKICAgIGJveC1zaGFkb3c6IAogICAgICAwIDAgMCA4cHggcmdiYSg3NCwgMTQ0LCAyMjYsIDAuNCksCiAgICAgIDAgMCAwIDE2cHggcmdiYSg3NCwgMTQ0LCAyMjYsIDAuMik7CiAgfQp9CgpAa2V5ZnJhbWVzIG91dGxpbmVGbGFzaFJlY2VpdmUgewogIDAlLCAxMDAlIHsgCiAgICBib3gtc2hhZG93OiAKICAgICAgMCAwIDAgMCByZ2JhKDc2LCAxNzUsIDgwLCAwKSwKICAgICAgMCAwIDAgMCByZ2JhKDc2LCAxNzUsIDgwLCAwKTsKICB9CiAgNTAlIHsgCiAgICBib3gtc2hhZG93OiAKICAgICAgMCAwIDAgOHB4IHJnYmEoNzYsIDE3NSwgODAsIDAuNCksCiAgICAgIDAgMCAwIDE2cHggcmdiYSg3NiwgMTc1LCA4MCwgMC4yKTsKICB9Cn0KCi5tc2cub3duLmZsYXNoIHsKICBhbmltYXRpb246IG1lc3NhZ2VTbGlkZSAwLjRzIGVhc2UsIG91dGxpbmVGbGFzaFNlbmQgMXMgZWFzZS1pbi1vdXQ7Cn0KCi5tc2cub3RoZXIuZmxhc2ggewogIGFuaW1hdGlvbjogbWVzc2FnZVNsaWRlIDAuNHMgZWFzZSwgb3V0bGluZUZsYXNoUmVjZWl2ZSAxcyBlYXNlLWluLW91dDsKfQoKLm1zZy5vd24uZmxhc2ggewogIGFuaW1hdGlvbjogbWVzc2FnZVNsaWRlIDAuNHMgZWFzZSwgb3V0bGluZUZsYXNoU2VuZCAxcyBlYXNlLWluLW91dDsKfQoKLm1zZy5vdGhlci5mbGFzaCB7CiAgYW5pbWF0aW9uOiBtZXNzYWdlU2xpZGUgMC40cyBlYXNlLCBvdXRsaW5lRmxhc2hSZWNlaXZlIDFzIGVhc2UtaW4tb3V0Owp9CgoubXNnLm93bi5mbGFzaCB7CiAgYW5pbWF0aW9uOiBtZXNzYWdlU2xpZGUgMC40cyBlYXNlLCBvdXRsaW5lRmxhc2hTZW5kIDEuNXMgZWFzZTsKfQoKLm1zZy5vdGhlci5mbGFzaCB7CiAgYW5pbWF0aW9uOiBtZXNzYWdlU2xpZGUgMC40cyBlYXNlLCBvdXRsaW5lRmxhc2hSZWNlaXZlIDEuNXMgZWFzZTsKfQoKLyogRnJpZW5kIHJlcXVlc3Qgc3R5bGVzICovCi5mcmllbmQtcmVxdWVzdCB7CiAgZGlzcGxheTogZmxleDsKICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBwYWRkaW5nOiA4cHg7CiAgYm9yZGVyLXJhZGl1czogNnB4OwogIGJhY2tncm91bmQ6ICNmOWY5Zjk7CiAgbWFyZ2luLWJvdHRvbTogNHB4OwogIGFuaW1hdGlvbjogZmFkZUluIDAuM3MgZWFzZTsKfQoKLmZyaWVuZC1yZXF1ZXN0LWJ1dHRvbnMgewogIGRpc3BsYXk6IGZsZXg7CiAgZ2FwOiA0cHg7Cn0KCi8qIFNlbGVjdGVkIGZyaWVuZCBoaWdobGlnaHQgKi8KLmZyaWVuZC5zZWxlY3RlZCB7CiAgYmFja2dyb3VuZDogI2UzZjJmZDsKICBib3JkZXItbGVmdDogM3B4IHNvbGlkICM0YTkwZTI7Cn0KCi8qIEdsb2JhbCBjaGF0IGJ1dHRvbiBoaWdobGlnaHQgKi8KI2dsb2JhbC1jaGF0LWJ0bi5zZWxlY3RlZCB7CiAgYmFja2dyb3VuZDogI2UzZjJmZDsKICBib3JkZXItbGVmdDogM3B4IHNvbGlkICM0YTkwZTI7Cn0KCi8qIE1lc3NhZ2UgdGltZXN0YW1wICovCi5tc2ctdGltZSB7CiAgZm9udC1zaXplOiAwLjdyZW07CiAgY29sb3I6ICM5OTk7CiAgbWFyZ2luLWxlZnQ6IDhweDsKfQoKLyogT25saW5lIHVzZXJzIGNvdW50ZXIgKi8KLm9ubGluZS1jb3VudGVyIHsKICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7CiAgYmFja2dyb3VuZDogIzRjYWY1MDsKICBjb2xvcjogd2hpdGU7CiAgYm9yZGVyLXJhZGl1czogMTBweDsKICBwYWRkaW5nOiAycHggOHB4OwogIGZvbnQtc2l6ZTogMC44cmVtOwogIG1hcmdpbi1sZWZ0OiA4cHg7Cn0KCi8qIEZJWDogQ29uc2lzdGVudCBmb3JtIHNwYWNpbmcgKi8KLmF1dGgtZm9ybSB7CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogIGdhcDogMTJweDsKICBtYXJnaW4tdG9wOiAxNnB4Owp9CgouYXV0aC1mb3JtIC5idXR0b24tZ3JvdXAgewogIGRpc3BsYXk6IGZsZXg7CiAgZ2FwOiA4cHg7CiAgbWFyZ2luLXRvcDogOHB4Owp9CgovKiBSZXNwb25zaXZlIGFkanVzdG1lbnRzICovCkBtZWRpYSAobWF4LXdpZHRoOiA3NjhweCkgewogIGJvZHkgeyBmbGV4LWRpcmVjdGlvbjogY29sdW1uOyB9CiAgLnNpZGViYXIgeyB3aWR0aDogMTAwJTsgaGVpZ2h0OiA0MCU7IGJvcmRlci1yaWdodDogbm9uZTsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7IH0KICAubXNnIHsgbWF4LXdpZHRoOiA5MCU7IH0KfQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGNsYXNzPSJzaWRlYmFyIj4KICA8ZGl2IGlkPSJhdXRoLWFyZWEiPgogICAgPGgzPlNpZ24gdXAgLyBTaWduIGluPC9oMz4KICAgIDxmb3JtIGlkPSJzaWdudXAtZm9ybSIgY2xhc3M9ImF1dGgtZm9ybSI+CiAgICAgIDxpbnB1dCBpZD0ic2lnbnVwLXVzZXJuYW1lIiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iVXNlcm5hbWUiIHJlcXVpcmVkPgogICAgICA8aW5wdXQgaWQ9InNpZ251cC1wYXNzd29yZCIgdHlwZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJQYXNzd29yZCIgcmVxdWlyZWQ+CiAgICAgIDxkaXYgY2xhc3M9ImJ1dHRvbi1ncm91cCI+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4tcHJpbWFyeSI+U2lnbiB1cDwvYnV0dG9uPgogICAgICAgIDxidXR0b24gdHlwZT0iYnV0dG9uIiBpZD0ic2hvdy1zaWduaW4iIGNsYXNzPSJidG4tc2Vjb25kYXJ5Ij5TaWduIGluPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgPC9mb3JtPgogICAgPGZvcm0gaWQ9InNpZ25pbi1mb3JtIiBjbGFzcz0iYXV0aC1mb3JtIiBzdHlsZT0iZGlzcGxheTpub25lIj4KICAgICAgPGlucHV0IGlkPSJzaWduaW4tdXNlcm5hbWUiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJVc2VybmFtZSIgcmVxdWlyZWQ+CiAgICAgIDxpbnB1dCBpZD0ic2lnbmluLXBhc3N3b3JkIiB0eXBlPSJwYXNzd29yZCIgcGxhY2Vob2xkZXI9IlBhc3N3b3JkIiByZXF1aXJlZD4KICAgICAgPGRpdiBjbGFzcz0iYnV0dG9uLWdyb3VwIj4KICAgICAgICA8YnV0dG9uIHR5cGU9InN1Ym1pdCIgY2xhc3M9ImJ0bi1wcmltYXJ5Ij5TaWduIGluPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJidXR0b24iIGlkPSJzaG93LXNpZ251cCIgY2xhc3M9ImJ0bi1zZWNvbmRhcnkiPkJhY2s8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Zvcm0+CiAgPC9kaXY+CgogIDxkaXYgaWQ9ImZyaWVuZHMtYXJlYSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+CiAgICA8aDM+Q2hhdHMgPHNwYW4gaWQ9Im9ubGluZS1jb3VudGVyIiBjbGFzcz0ib25saW5lLWNvdW50ZXIiPjA8L3NwYW4+PC9oMz4KICAgIDxidXR0b24gY2xhc3M9ImNoYXQtYnRuIiBpZD0iZ2xvYmFsLWNoYXQtYnRuIj7wn4yQIEdsb2JhbCBDaGF0PC9idXR0b24+CiAgICA8aDQ+RnJpZW5kczwvaDQ+CiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7Z2FwOjRweCI+CiAgICAgIDxpbnB1dCBpZD0iZnJpZW5kLXVzZXJuYW1lIiB0eXBlPSJ0ZXh0IiBwbGFjZWhvbGRlcj0iRnJpZW5kJ3MgdXNlcm5hbWUiPgogICAgICA8YnV0dG9uIGlkPSJhZGQtZnJpZW5kIiBjbGFzcz0iYnRuLXByaW1hcnkiPkFkZDwvYnV0dG9uPgogICAgPC9kaXY+CiAgICA8ZGl2IGlkPSJmcmllbmRzLWxpc3QiPjwvZGl2PgoKICAgIDxoND5QZW5kaW5nIFJlcXVlc3RzPC9oND4KICAgIDxkaXYgaWQ9InBlbmRpbmctcmVxdWVzdHMiPjwvZGl2PgogIDwvZGl2Pgo8L2Rpdj4KCjxkaXYgY2xhc3M9Im1haW4iPgogIDxkaXYgY2xhc3M9ImhlYWRlciI+PGgzIGlkPSJjaGF0LXRpdGxlIj5DaGF0PC9oMz48L2Rpdj4KICA8ZGl2IGNsYXNzPSJtZXNzYWdlcyIgaWQ9Im1lc3NhZ2VzIj48L2Rpdj4KICA8ZGl2IGNsYXNzPSJjb21wb3NlciI+CiAgICA8aW5wdXQgaWQ9Im1lc3NhZ2UtaW5wdXQiIHR5cGU9InRleHQiIHBsYWNlaG9sZGVyPSJUeXBlIGEgbWVzc2FnZSI+CiAgICA8YnV0dG9uIGlkPSJzZW5kLW1zZyIgY2xhc3M9ImJ0bi1wcmltYXJ5Ij5TZW5kPC9idXR0b24+CiAgPC9kaXY+CjwvZGl2PgoKPHNjcmlwdCB0eXBlPSJtb2R1bGUiPgppbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL0BzdXBhYmFzZS9zdXBhYmFzZS1qcy8rZXNtJzsKCmNvbnN0IFNVUEFCQVNFX1VSTCA9ICdodHRwczovL2ZsenZ5bGZweHd4a2pjZmpudnJtLnN1cGFiYXNlLmNvJzsKY29uc3QgU1VQQUJBU0VfQU5PTl9LRVkgPSAnZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW1ac2VuWjViR1p3ZUhkNGEycGpabXB1ZG5KdElpd2ljbTlzWlNJNkltRnViMjRpTENKcFlYUWlPakUzTmpBek1qRXlPRElzSW1WNGNDSTZNakEzTlRnNU56STRNbjAuX3NPbnlRbGlYTVV4SE95UkdHYWdBOGl1UDlxRmpBZXR5WDh3ZnVjMGlJSSc7Cgpjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChTVVBBQkFTRV9VUkwsIFNVUEFCQVNFX0FOT05fS0VZKTsKCi8vIE1lc3NhZ2UgbWVtb3J5IHRvIHRyYWNrIHdoaWNoIG1lc3NhZ2VzIGhhdmUgYWxyZWFkeSBiZWVuIHNob3duCmNvbnN0IG1lc3NhZ2VNZW1vcnkgPSBuZXcgU2V0KCk7Cgpjb25zdCBzaWdudXBGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NpZ251cC1mb3JtJyk7CmNvbnN0IHNpZ25pbkZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbmluLWZvcm0nKTsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3ctc2lnbmluJykub25jbGljaz0oKT0+ewogIHNpZ251cEZvcm0uc3R5bGUuZGlzcGxheT0nbm9uZSc7IAogIHNpZ25pbkZvcm0uc3R5bGUuZGlzcGxheT0nZmxleCc7CiAgc2lnbmluRm9ybS5zdHlsZS5hbmltYXRpb24gPSAnZmFkZUluIDAuM3MgZWFzZSc7Cn0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Nob3ctc2lnbnVwJykub25jbGljaz0oKT0+ewogIHNpZ25pbkZvcm0uc3R5bGUuZGlzcGxheT0nbm9uZSc7IAogIHNpZ251cEZvcm0uc3R5bGUuZGlzcGxheT0nZmxleCc7CiAgc2lnbnVwRm9ybS5zdHlsZS5hbmltYXRpb24gPSAnZmFkZUluIDAuM3MgZWFzZSc7Cn0KCmZ1bmN0aW9uIGhhc2hQYXNzKHBhc3MpeyByZXR1cm4gYnRvYShwYXNzKTsgfQoKbGV0IGN1cnJlbnRVc2VyPXtpZDpudWxsLCB1c2VybmFtZTpudWxsfTsKbGV0IGN1cnJlbnRGcmllbmQ9bnVsbDsKbGV0IGN1cnJlbnRGcmllbmROYW1lPScnOwpsZXQgdHlwaW5nVGltZW91dD1udWxsOwoKLy8gT25saW5lIHN0YXR1cwphc3luYyBmdW5jdGlvbiBzZXRPbmxpbmUoc3RhdHVzKXsgaWYoIWN1cnJlbnRVc2VyLmlkKSByZXR1cm47IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykudXBkYXRlKHtvbmxpbmU6c3RhdHVzfSkuZXEoJ2lkJyxjdXJyZW50VXNlci5pZCk7fQp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgKCk9PnNldE9ubGluZShmYWxzZSkpOwoKLy8gR2VuZXJhdGUgYSB1bmlxdWUgbWVzc2FnZSBJRCBmb3IgdHJhY2tpbmcKZnVuY3Rpb24gZ2VuZXJhdGVNZXNzYWdlSWQobWVzc2FnZSkgewogIHJldHVybiBgJHttZXNzYWdlLmZyb21faWR9LSR7bWVzc2FnZS50b19pZH0tJHttZXNzYWdlLmNvbnRlbnR9LSR7bWVzc2FnZS5jcmVhdGVkX2F0fWA7Cn0KCi8vIC0tLSBTaWdudXAKc2lnbnVwRm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBhc3luYyBlPT57CiAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIGNvbnN0IHVzZXJuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NpZ251cC11c2VybmFtZScpLnZhbHVlOwogIGNvbnN0IHBhc3N3b3JkX2hhc2ggPSBoYXNoUGFzcyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbnVwLXBhc3N3b3JkJykudmFsdWUpOwoKICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLnNlbGVjdCgnaWQnKS5lcSgndXNlcm5hbWUnLCB1c2VybmFtZSkuc2luZ2xlKCk7CiAgaWYoZXhpc3Rpbmcpe2FsZXJ0KCdVc2VybmFtZSB0YWtlbicpOyByZXR1cm47fQoKICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLmluc2VydCh7dXNlcm5hbWUsIHBhc3N3b3JkX2hhc2gsIG9ubGluZTp0cnVlfSkuc2VsZWN0KCkuc2luZ2xlKCk7CiAgaWYoZXJyb3Ipe2FsZXJ0KGVycm9yLm1lc3NhZ2UpO30gZWxzZSB7CiAgICBpbml0Q2hhdChkYXRhLnVzZXJuYW1lLCBkYXRhLmlkKTsKICB9Cn0pOwoKLy8gLS0tIFNpZ25pbgpzaWduaW5Gb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIGU9PnsKICBlLnByZXZlbnREZWZhdWx0KCk7CiAgY29uc3QgdXNlcm5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbmluLXVzZXJuYW1lJykudmFsdWU7CiAgY29uc3QgcGFzc3dvcmRfaGFzaCA9IGhhc2hQYXNzKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWduaW4tcGFzc3dvcmQnKS52YWx1ZSk7CgogIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykuc2VsZWN0KCcqJykuZXEoJ3VzZXJuYW1lJywgdXNlcm5hbWUpLmVxKCdwYXNzd29yZF9oYXNoJywgcGFzc3dvcmRfaGFzaCkuc2luZ2xlKCk7CiAgaWYoZXJyb3IgfHwgIWRhdGEpe2FsZXJ0KCdJbnZhbGlkIHVzZXJuYW1lL3Bhc3N3b3JkJyk7IHJldHVybjt9CiAgaW5pdENoYXQoZGF0YS51c2VybmFtZSwgZGF0YS5pZCk7Cn0pOwoKLy8gLS0tIEluaXQgY2hhdAphc3luYyBmdW5jdGlvbiBpbml0Q2hhdCh1c2VybmFtZSwgdWlkKXsKICBjdXJyZW50VXNlcj17aWQ6dWlkLCB1c2VybmFtZX07CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F1dGgtYXJlYScpLnN0eWxlLmRpc3BsYXk9J25vbmUnOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmcmllbmRzLWFyZWEnKS5zdHlsZS5kaXNwbGF5PSdibG9jayc7CiAgYXdhaXQgc2V0T25saW5lKHRydWUpOwoKICBhc3luYyBmdW5jdGlvbiBsb2FkRnJpZW5kcygpewogICAgY29uc3QgeyBkYXRhOiBmcmllbmRzIH0gPSBhd2FpdCBzdXBhYmFzZS5mcm9tKCdmcmllbmRzaGlwcycpLnNlbGVjdCgnaWQsIHJlcXVlc3Rlcl9pZCwgcmVxdWVzdGVkX2lkLCBzdGF0dXMnKTsKICAgIGNvbnN0IGxpc3Q9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZyaWVuZHMtbGlzdCcpOyBsaXN0LmlubmVySFRNTD0nJzsKICAgIGZvcihjb25zdCBmIG9mIGZyaWVuZHMpewogICAgICBsZXQgZmlkID0gZi5yZXF1ZXN0ZXJfaWQ9PT1jdXJyZW50VXNlci5pZD9mLnJlcXVlc3RlZF9pZDooZi5yZXF1ZXN0ZWRfaWQ9PT1jdXJyZW50VXNlci5pZD9mLnJlcXVlc3Rlcl9pZDpudWxsKTsKICAgICAgaWYoIWZpZCB8fCBmLnN0YXR1cyE9PSdhY2NlcHRlZCcpIGNvbnRpbnVlOwogICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykuc2VsZWN0KCd1c2VybmFtZSwgb25saW5lLCB0eXBpbmcnKS5lcSgnaWQnLGZpZCkuc2luZ2xlKCk7CiAgICAgIGNvbnN0IGRpdj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsgCiAgICAgIGRpdi5jbGFzc05hbWUgPSBgZnJpZW5kICR7Y3VycmVudEZyaWVuZCA9PT0gZmlkID8gJ3NlbGVjdGVkJyA6ICcnfWA7CiAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCBmaWQpOwogICAgICAKICAgICAgbGV0IHR5cGluZ0luZGljYXRvciA9ICcnOwogICAgICBpZiAocHJvZmlsZS50eXBpbmcpIHsKICAgICAgICB0eXBpbmdJbmRpY2F0b3IgPSBgPHNwYW4gY2xhc3M9InR5cGluZy1pbmRpY2F0b3IiPgogICAgICAgICAgPHNwYW4gY2xhc3M9InR5cGluZy1kb3QiPjwvc3Bhbj4KICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0eXBpbmctZG90Ij48L3NwYW4+CiAgICAgICAgICA8c3BhbiBjbGFzcz0idHlwaW5nLWRvdCI+PC9zcGFuPgogICAgICAgIDwvc3Bhbj5gOwogICAgICB9CiAgICAgIC8vIEdldCB0aGUgYWN0dWFsIHNlbmRlcidzIHVzZXJuYW1lIGZvciBkaXNwbGF5CiAgICAgIGNvbnN0IHNlbmRlck5hbWUgPSBtLmZyb21faWQgPT09IGN1cnJlbnRVc2VyLmlkID8gJ1lvdScgOiBhd2FpdCBnZXRVc2VybmFtZUJ5SWQobS5mcm9tX2lkKTsKICAgICAgZGl2LmlubmVySFRNTD1gPHNwYW4gY2xhc3M9ImZyb20iPiR7c2VuZGVyTmFtZX08L3NwYW4+PHNwYW4gY2xhc3M9Im1zZy10aW1lIj4ke3RpbWVTdHJ9PC9zcGFuPjxicj4ke20uY29udGVudH1gO2Rpdi5vbmNsaWNrPSgpPT5zZWxlY3RGcmllbmQoZmlkLCBwcm9maWxlLnVzZXJuYW1lKTsKICAgICAgbGlzdC5hcHBlbmRDaGlsZChkaXYpOwogICAgfQogIH0KICBhc3luYyBmdW5jdGlvbiBnZXRVc2VybmFtZUJ5SWQodXNlcklkKSB7CiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykuc2VsZWN0KCd1c2VybmFtZScpLmVxKCdpZCcsIHVzZXJJZCkuc2luZ2xlKCk7CiAgICByZXR1cm4gZGF0YT8udXNlcm5hbWUgfHwgJ1VzZXInOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gbG9hZFBlbmRpbmdSZXF1ZXN0cygpewogICAgY29uc3QgeyBkYXRhOiByZXF1ZXN0cyB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnZnJpZW5kc2hpcHMnKS5zZWxlY3QoJ2lkLCByZXF1ZXN0ZXJfaWQnKS5lcSgncmVxdWVzdGVkX2lkJywgY3VycmVudFVzZXIuaWQpLmVxKCdzdGF0dXMnLCdwZW5kaW5nJyk7CiAgICBjb25zdCBwZW5kaW5nRGl2PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZW5kaW5nLXJlcXVlc3RzJyk7IHBlbmRpbmdEaXYuaW5uZXJIVE1MPScnOwogICAgZm9yKGNvbnN0IHIgb2YgcmVxdWVzdHMpewogICAgICBjb25zdCB7IGRhdGE6IHByb2ZpbGUgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykuc2VsZWN0KCd1c2VybmFtZScpLmVxKCdpZCcsIHIucmVxdWVzdGVyX2lkKS5zaW5nbGUoKTsKICAgICAgY29uc3QgZGl2PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyAKICAgICAgZGl2LmNsYXNzTmFtZSA9ICdmcmllbmQtcmVxdWVzdCc7CiAgICAgIGRpdi5pbm5lckhUTUwgPSBgPHNwYW4+JHtwcm9maWxlLnVzZXJuYW1lfTwvc3Bhbj5gOwogICAgICAKICAgICAgY29uc3QgYnV0dG9uQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGJ1dHRvbkNvbnRhaW5lci5jbGFzc05hbWUgPSAnZnJpZW5kLXJlcXVlc3QtYnV0dG9ucyc7CiAgICAgIAogICAgICBjb25zdCBhY2NlcHRCdG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7IAogICAgICBhY2NlcHRCdG4udGV4dENvbnRlbnQ9J0FjY2VwdCc7CiAgICAgIGFjY2VwdEJ0bi5jbGFzc05hbWUgPSAnYnRuLXByaW1hcnknOwogICAgICBhY2NlcHRCdG4uc3R5bGUucGFkZGluZyA9ICc0cHggOHB4JzsKICAgICAgYWNjZXB0QnRuLnN0eWxlLmZvbnRTaXplID0gJzAuOHJlbSc7CiAgICAgIAogICAgICBjb25zdCByZWplY3RCdG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7IAogICAgICByZWplY3RCdG4udGV4dENvbnRlbnQ9J1JlamVjdCc7CiAgICAgIHJlamVjdEJ0bi5jbGFzc05hbWUgPSAnYnRuLXNlY29uZGFyeSc7CiAgICAgIHJlamVjdEJ0bi5zdHlsZS5wYWRkaW5nID0gJzRweCA4cHgnOwogICAgICByZWplY3RCdG4uc3R5bGUuZm9udFNpemUgPSAnMC44cmVtJzsKICAgICAgCiAgICAgIGFjY2VwdEJ0bi5vbmNsaWNrPWFzeW5jICgpPT57CiAgICAgICAgc2V0VGltZW91dChhc3luYyAoKT0+ewogICAgICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnZnJpZW5kc2hpcHMnKS51cGRhdGUoe3N0YXR1czonYWNjZXB0ZWQnfSkuZXEoJ2lkJyxyLmlkKTsKICAgICAgICAgIGxvYWRGcmllbmRzKCk7IAogICAgICAgICAgbG9hZFBlbmRpbmdSZXF1ZXN0cygpOwogICAgICAgIH0sIDMwMCk7CiAgICAgIH07CiAgICAgIHJlamVjdEJ0bi5vbmNsaWNrPWFzeW5jICgpPT57CiAgICAgICAgc2V0VGltZW91dChhc3luYyAoKT0+ewogICAgICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnZnJpZW5kc2hpcHMnKS51cGRhdGUoe3N0YXR1czoncmVqZWN0ZWQnfSkuZXEoJ2lkJyxyLmlkKTsKICAgICAgICAgIGxvYWRQZW5kaW5nUmVxdWVzdHMoKTsKICAgICAgICB9LCAzMDApOwogICAgICB9OwogICAgICAKICAgICAgYnV0dG9uQ29udGFpbmVyLmFwcGVuZENoaWxkKGFjY2VwdEJ0bik7IAogICAgICBidXR0b25Db250YWluZXIuYXBwZW5kQ2hpbGQocmVqZWN0QnRuKTsKICAgICAgZGl2LmFwcGVuZENoaWxkKGJ1dHRvbkNvbnRhaW5lcik7CiAgICAgIHBlbmRpbmdEaXYuYXBwZW5kQ2hpbGQoZGl2KTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHNlbGVjdEZyaWVuZChmaWQsIHVuYW1lKXsgCiAgICAvLyBSZW1vdmUgc2VsZWN0ZWQgY2xhc3MgZnJvbSBhbGwgZnJpZW5kcyBhbmQgZ2xvYmFsIGJ1dHRvbgogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZyaWVuZCcpLmZvckVhY2goZiA9PiBmLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJykpOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dsb2JhbC1jaGF0LWJ0bicpLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJyk7CiAgICAKICAgIC8vIEFkZCBzZWxlY3RlZCBjbGFzcyB0byBjbGlja2VkIGZyaWVuZAogICAgaWYgKGZpZCkgewogICAgICBjdXJyZW50RnJpZW5kPWZpZDsgCiAgICAgIGN1cnJlbnRGcmllbmROYW1lPXVuYW1lOyAKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLmZyaWVuZFtkYXRhLWlkPSIke2ZpZH0iXWApPy5jbGFzc0xpc3QuYWRkKCdzZWxlY3RlZCcpOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdC10aXRsZScpLnRleHRDb250ZW50ID0gYENoYXQgd2l0aCAke3VuYW1lfWA7CiAgICB9CiAgICBsb2FkTWVzc2FnZXMoKTsgCiAgfQoKICBhc3luYyBmdW5jdGlvbiBsb2FkTWVzc2FnZXMoKXsKICAgIGNvbnN0IHsgZGF0YTogbXNncyB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnbWVzc2FnZXMnKS5zZWxlY3QoJyonKS5vcmRlcignY3JlYXRlZF9hdCcse2FzY2VuZGluZzp0cnVlfSk7CiAgICBjb25zdCBjb250YWluZXI9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21lc3NhZ2VzJyk7IAogICAgCiAgICAvLyBTdG9yZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbgogICAgY29uc3Qgd2FzQXRCb3R0b20gPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0IC0gY29udGFpbmVyLnNjcm9sbFRvcCAtIGNvbnRhaW5lci5jbGllbnRIZWlnaHQgPCA1MDsKICAgIAogICAgY29udGFpbmVyLmlubmVySFRNTD0nJzsKICAgIGxldCBoYXNOZXdNZXNzYWdlcyA9IGZhbHNlOwogICAgCiAgICBmb3IoY29uc3QgbSBvZiBtc2dzKXsKICAgICAgaWYoY3VycmVudEZyaWVuZCl7CiAgICAgICAgaWYobS5mcm9tX2lkIT09Y3VycmVudEZyaWVuZCAmJiBtLnRvX2lkIT09Y3VycmVudEZyaWVuZCAmJiBtLmZyb21faWQhPT1jdXJyZW50VXNlci5pZCAmJiBtLnRvX2lkIT09Y3VycmVudFVzZXIuaWQpIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmKG0udG9faWQhPT1udWxsKSBjb250aW51ZTsKICAgICAgfQogICAgICAKICAgICAgY29uc3QgZGl2PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOyAKICAgICAgY29uc3QgbWVzc2FnZUlkID0gZ2VuZXJhdGVNZXNzYWdlSWQobSk7CiAgICAgIGNvbnN0IGlzTmV3TWVzc2FnZSA9ICFtZXNzYWdlTWVtb3J5LmhhcyhtZXNzYWdlSWQpOwogICAgICAKICAgICAgLy8gQWRkIGZsYXNoIGNsYXNzIG9ubHkgZm9yIG5ldyBtZXNzYWdlcwogICAgICBjb25zdCBmbGFzaENsYXNzID0gaXNOZXdNZXNzYWdlID8gJ2ZsYXNoJyA6ICcnOwogICAgICBkaXYuY2xhc3NOYW1lPWBtc2cgJHttLmZyb21faWQ9PT1jdXJyZW50VXNlci5pZD8nb3duJzonb3RoZXInfSAke2ZsYXNoQ2xhc3N9YDsKICAgICAgCiAgICAgIC8vIEZvcm1hdCB0aW1lc3RhbXAKICAgICAgY29uc3QgdGltZSA9IG5ldyBEYXRlKG0uY3JlYXRlZF9hdCk7CiAgICAgIGNvbnN0IHRpbWVTdHIgPSB0aW1lLnRvTG9jYWxlVGltZVN0cmluZyhbXSwge2hvdXI6ICcyLWRpZ2l0JywgbWludXRlOicyLWRpZ2l0J30pOwogICAgICAKICAgICAgZGl2LmlubmVySFRNTD1gPHNwYW4gY2xhc3M9ImZyb20iPiR7bS5mcm9tX2lkPT09Y3VycmVudFVzZXIuaWQ/J1lvdSc6KGN1cnJlbnRGcmllbmROYW1lIHx8ICdVc2VyJyl9PC9zcGFuPjxzcGFuIGNsYXNzPSJtc2ctdGltZSI+JHt0aW1lU3RyfTwvc3Bhbj48YnI+JHttLmNvbnRlbnR9YDsKICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpdik7CiAgICAgIAogICAgICAvLyBBZGQgdG8gbWVtb3J5IGlmIGl0J3MgYSBuZXcgbWVzc2FnZQogICAgICBpZiAoaXNOZXdNZXNzYWdlKSB7CiAgICAgICAgaGFzTmV3TWVzc2FnZXMgPSB0cnVlOwogICAgICAgIG1lc3NhZ2VNZW1vcnkuYWRkKG1lc3NhZ2VJZCk7CiAgICAgICAgCiAgICAgICAgLy8gUmVtb3ZlIGZsYXNoIGNsYXNzIGFmdGVyIGFuaW1hdGlvbiBjb21wbGV0ZXMKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGRpdi5jbGFzc0xpc3QucmVtb3ZlKCdmbGFzaCcpOwogICAgICAgIH0sIDE1MDApOwogICAgICB9CiAgICB9CiAgICAKICAgIC8vIFNjcm9sbCB0byBib3R0b20gaWYgd2Ugd2VyZSBhdCBib3R0b20gb3IgaWYgdGhlcmUgYXJlIG5ldyBtZXNzYWdlcwogICAgaWYgKHdhc0F0Qm90dG9tIHx8IGhhc05ld01lc3NhZ2VzKSB7CiAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgfQogIH0KCiAgY29uc3QgbWVzc2FnZUlucHV0PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXNzYWdlLWlucHV0Jyk7CiAgbWVzc2FnZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgYXN5bmMgKCk9PnsKICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykudXBkYXRlKHt0eXBpbmc6dHJ1ZX0pLmVxKCdpZCcsY3VycmVudFVzZXIuaWQpOwogICAgY2xlYXJUaW1lb3V0KHR5cGluZ1RpbWVvdXQpOwogICAgdHlwaW5nVGltZW91dD1zZXRUaW1lb3V0KGFzeW5jICgpPT57CiAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykudXBkYXRlKHt0eXBpbmc6ZmFsc2V9KS5lcSgnaWQnLGN1cnJlbnRVc2VyLmlkKTsKICAgIH0sMTAwMCk7CiAgfSk7CgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZW5kLW1zZycpLm9uY2xpY2s9c2VuZE1lc3NhZ2U7CiAgbWVzc2FnZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXByZXNzJywgZT0+eyBpZihlLmtleT09PSdFbnRlcicpIHNlbmRNZXNzYWdlKCk7IH0pOwoKICBhc3luYyBmdW5jdGlvbiBzZW5kTWVzc2FnZSgpewogICAgY29uc3QgY29udGVudD1tZXNzYWdlSW5wdXQudmFsdWUudHJpbSgpOwogICAgaWYoIWNvbnRlbnQpIHJldHVybjsKICAgIAogICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnbWVzc2FnZXMnKS5pbnNlcnQoe2Zyb21faWQ6Y3VycmVudFVzZXIuaWQsdG9faWQ6Y3VycmVudEZyaWVuZCxjb250ZW50fSk7CiAgICBtZXNzYWdlSW5wdXQudmFsdWU9Jyc7CiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdwcm9maWxlcycpLnVwZGF0ZSh7dHlwaW5nOmZhbHNlfSkuZXEoJ2lkJyxjdXJyZW50VXNlci5pZCk7CiAgICBsb2FkTWVzc2FnZXMoKTsKICB9CgogIC8vIEdsb2JhbCBjaGF0IGJ1dHRvbgogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnbG9iYWwtY2hhdC1idG4nKS5vbmNsaWNrPSgpPT57CiAgICAvLyBSZW1vdmUgc2VsZWN0ZWQgY2xhc3MgZnJvbSBhbGwgZnJpZW5kcwogICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZyaWVuZCcpLmZvckVhY2goZiA9PiBmLmNsYXNzTGlzdC5yZW1vdmUoJ3NlbGVjdGVkJykpOwogICAgCiAgICBjdXJyZW50RnJpZW5kPW51bGw7IAogICAgY3VycmVudEZyaWVuZE5hbWU9J0dsb2JhbCc7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2xvYmFsLWNoYXQtYnRuJykuY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnKTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjaGF0LXRpdGxlJykudGV4dENvbnRlbnQgPSAnR2xvYmFsIENoYXQnOwogICAgbG9hZE1lc3NhZ2VzKCk7CiAgfQoKICAvLyBVcGRhdGUgb25saW5lIHVzZXJzIGNvdW50CiAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlT25saW5lQ291bnRlcigpIHsKICAgIGNvbnN0IHsgZGF0YTogcHJvZmlsZXMgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oJ3Byb2ZpbGVzJykuc2VsZWN0KCdpZCcpLmVxKCdvbmxpbmUnLCB0cnVlKTsKICAgIGNvbnN0IGNvdW50ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb25saW5lLWNvdW50ZXInKTsKICAgIGlmIChwcm9maWxlcykgewogICAgICBjb3VudGVyLnRleHRDb250ZW50ID0gcHJvZmlsZXMubGVuZ3RoOwogICAgfQogIH0KCiAgLy8gLS0tIEluaXRpYWwgbG9hZAogIGxvYWRGcmllbmRzKCk7IAogIGxvYWRQZW5kaW5nUmVxdWVzdHMoKTsKICB1cGRhdGVPbmxpbmVDb3VudGVyKCk7CiAgCiAgLy8gU2V0IHVwIHJlYWwtdGltZSBzdWJzY3JpcHRpb25zIGZvciBzdGF0dXMgdXBkYXRlcwogIGNvbnN0IHByb2ZpbGVzU3Vic2NyaXB0aW9uID0gc3VwYWJhc2UKICAgIC5jaGFubmVsKCdwcm9maWxlcycpCiAgICAub24oJ3Bvc3RncmVzX2NoYW5nZXMnLCB7IGV2ZW50OiAnKicsIHNjaGVtYTogJ3B1YmxpYycsIHRhYmxlOiAncHJvZmlsZXMnIH0sIAogICAgICBwYXlsb2FkID0+IHsKICAgICAgICBsb2FkRnJpZW5kcygpOwogICAgICAgIHVwZGF0ZU9ubGluZUNvdW50ZXIoKTsKICAgICAgfQogICAgKQogICAgLnN1YnNjcmliZSgpOwp9CgovLyBBZGQgZnJpZW5kCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhZGQtZnJpZW5kJykub25jbGljaz1hc3luYyAoKT0+ewogIGNvbnN0IHVuYW1lPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmcmllbmQtdXNlcm5hbWUnKS52YWx1ZS50cmltKCk7CiAgaWYoIXVuYW1lKSByZXR1cm47CiAgCiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgncHJvZmlsZXMnKS5zZWxlY3QoJ2lkJykuZXEoJ3VzZXJuYW1lJyx1bmFtZSkuc2luZ2xlKCk7CiAgaWYoZXJyb3IgfHwgIWRhdGEpe2FsZXJ0KCdVc2VyIG5vdCBmb3VuZCcpOyByZXR1cm47fQogIGF3YWl0IHN1cGFiYXNlLmZyb20oJ2ZyaWVuZHNoaXBzJykuaW5zZXJ0KHtyZXF1ZXN0ZXJfaWQ6Y3VycmVudFVzZXIuaWQsIHJlcXVlc3RlZF9pZDpkYXRhLmlkLCBzdGF0dXM6J3BlbmRpbmcnfSk7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZyaWVuZC11c2VybmFtZScpLnZhbHVlPScnOwp9Owo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+",
            "Axiom Tutorials.txt": "4pWt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWuCuKUgistPS0+TklUSEVSRklMRVM8LT0tKyDilIIK4pSCICstPS0+VFVUT1JJQUxTPC09LSsgIOKUggrilbDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDila8K4pSO4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSSCuKUgyBPcmlnaW5hbCBNaW5lY3JvLVJlcHVibGljIFJFQURNRSAoYXZhaWxhYmxlKSAgICAgICAgICAgICAgICAgICAgICDilIMK4pSD4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSoCuKUg01pY3JvIFJlcHVibGljICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIMK4pSDR3JlZXRpbmdzIHRvIGFsbCwgdGhpcyBpcyBhIHNwZWNpYWwgcmVwb3NpdG9yeSBkZXNpZ25lZCBmb3IgICAgICAgIOKUgwrilINNaW5lY3JhZnQgUmVzb3VyY2VzLiBBcyB0aGUg4paI4paI4paIIGFyZSBjbG9zaW5nIGluIG9uIG91ciBNaW5lY3JhZnQgICAg4pSDCuKUg2xhdW5jaGVyczog4paI4paIIGFuZCDilojilojilogsIHdlIG5vdyBmYWNlIHRoZSBmYWN0IHRoYXQgb25seSBsaXR0bGUgICAgICAg4pSDCuKUg01pbmVjcmFmdCBsYXVuY2hlcnMgY2FuIGJlIGZvdW5kIGFuZCB1c2VkIGZ1bmN0aW9uYWxseS4gICAgICAgICAgICDilIMK4pSDICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUgwrilINOb3csIHRoaXMgcmVwb3NpdG9yeSwgYWxzbyBsaW5raW5nIHRvIGl0cyBzaXRlOiAgICAgICAgICAgICAgICAgICAg4pSDCuKUg2h0dHBzOi8vbWluZWNyb3dhdmVyLmdpdGh1Yi5pby9NaW5lY3JvUmVwdWJsaWMvIGlzIGRpc3BsYXlpbmcgICAgICDilIMK4pSDdGhlIG9ubHkgZnVuY3Rpb25hbCBhbmQgdXNhYmxlIE1pbmVjcmFmdCBsYXVuY2hlcnMgYW5kIHJlc291cmNlcywgIOKUgwrilINhbHNvIHByb3ZpZGluZyBsaW5rcyB0byBkb3dubG9hZC4gTm93LCB2aXNpdCB0aGUgc2l0ZSBhbmQgZ2V0ICAgICAg4pSDCuKUg2FsbCBzb3J0cyBvZiByZXNvdXJjZXMgYW5kIGEgZ29vZCBNQyBleHBlcmllbmNlISBUaGVyZSBpcyBhbHNvICAgICDilIMK4pSDYSBwcml2YXRlIHJlcG9zaXRvcnkgd2l0aCBhbGwgdGV4dHMgYW5kIGxpbmtzIHVuYmxvY2tlZCEgQ29udGFjdCAgIOKUgwrilINtZSBhdDogbWluZWNyb3dhdmVyQG91dGxvb2suY29tIHRvIGdldCBwZXJtaXNzaW9uISA9RCAgICAgICAgICAgICAg4pSDCuKUgyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIMK4pSDRmVhdHVyZXMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUgwrilINNaW5lY3JhZnQgcmVzb3VyY2VzIGFuZCBsaW5rcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSDCuKUg1NvbHV0aW9ucyB0byBwb3NzaWJsZSBwcm9ibGVtcyB3aGlsZSBzZXR0aW5nIHByb2dyYW1zIHVwICAgICAgICAgICDilIMK4pSDQ29udGludW91cyB1cGRhdGVzICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKUgwrilINDcm9zcyBwbGF0Zm9ybSBwcm9ncmFtcyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSDCuKUg0Fja25vd2xlZGdlbWVudHMgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilIMK4pSDQWxsIGxpbmtzIGFyZSBmb3VuZCBieSBteXNlbGYsIHNvIEkgaG9wZSB0aGF0IHRoZXJlIGFyZSBubyBmb3JtcyAgIOKUgwrilINvZiBwcml2YWN5IGFuZCBhdXRob3JpdHkgdmlvbGF0aW9uIHRvIGFueWJvZHkgICAgICAgICAgICAgICAgICAgICAg4pSDCuKUg0ZvciBhbGwgbG9zcyBvZiBhc3NldCBvciBwcm9wZXJ0eSBvciBhbnl0aGluZywgSSBhbSBub3QgcmVzcG9uc2libGXilIMK4pSDSWYgeW91IGFyZSB1c2luZyB0aGUgbGlua3MgYW5kIHByb2dyYW1zIHRoYXQgSSBzaGFyZWQsIHdlbGwsIEVOSk9ZIeKUgwrilINTdXBwb3J0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pSDCuKUg0ZvciBzdXBwb3J0LCBlbWFpbCBtaW5lY3Jvd2F2ZXJAb3V0bG9vay5jb20gb3Igam9pbiB0aGUgZGlzY29yZCAgICDilIMK4pSDY2hhbm5lbCAoU2VuZCB0aGUgcmVxdWVzdCBhbmQgdXNlcm5hbWUgdG8gbWUpLiAgICAgICAgICAgICAgICAgICAgIOKUgwrilJbilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJoK4pWt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWuCuKUgiBPcmlnaW5hbCBNaW5lY3JvLVJlcHVibGljIHR1dG9yaWFscyhhdmFpbGFibGUgfCBzdG9wZWQgdXBkYXRpbmcgfCBtb2RpZmllZCB8IEJBRCBHUkFNTUFSKSDilIIK4pWw4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWvCuKUjCBNaW5lY3JhZnQgUmVzb3VyY2VzOgrilIIg4pSMIExhdW5jaGVyIGRvd25sb2FkOgrilIIg4pSCIOKUjCBUTCBMZWdhY3kK4pSCIOKUgiDilIIK4pSCIOKUgiDilIIgRG93bmxvYWQgaXQgYXQgdGhlIG9mZmljaWFsIHdlYnNpdGU6CuKUgiDilIIg4pSCIGh0dHBzOi8vbGxhdW4uY2gvbWFjb3MK4pSCIOKUgiDilIIK4pSCIOKUgiDilIIgSWYgdGhlIHdlYnNpdGUgZG9uJ3Qgd29yaywgZ28gdG86CuKUgiDilIIg4pSUIGh0dHBzOi8vbWFjZG93bmxvYWQuaW5mb3JtZXIuY29tL3RsLWxlZ2FjeS9kb3dubG9hZC8/Y2EzMDQ1MmQK4pSCIOKUggrilIIg4pSCIOKUjCBITUNMKE5lZWQgVGVybWluYWwgdG8gc2tpcCBBZG1pbmlzdHJhdG9yJ3MgVXNlcm5hbWUgYW5kIFBhc3N3b3JkLiBUdXRvcmlhbCBiZWxvdy4pCuKUgiDilIIg4pSCCuKUgiDilIIg4pSCIEphciBmb3IgbWFjKE1heSBub3QgYmUgdGhlIG5ld2VzdCB2ZXJzaW9uLCBpZiB5b3Ugd2FudCB0aGUgbmV3ZXN0IHZlcnNpb24sIGdvIHRvIHRoZSBvZmZpY2lhbCB3ZWJzaXRlIGJlbG93Lik6CuKUgiDilIIg4pSCIGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS9maWxlL2QvMXRGOFZyQjFoa1BsSkhzaTJuc3hLXy03ajJlOF9HNEhHL3ZpZXc/dXNwPWRyaXZlX2xpbmsK4pSCIOKUgiDilIIgaHR0cDovL21pcnJvcnMuY2xvdWQudGVuY2VudC5jb20vbmV4dXMvcmVwb3NpdG9yeS9tYXZlbi1wdWJsaWMvb3JnL2dsYXZvL2htY2wvaG1jbC1kZXYvMy41LjkuMjU1L2htY2wtZGV2LTMuNS45LjI1NS5qYXIK4pSCIOKUgiDilIIK4pSCIOKUgiDilIIgT2ZmaWNpYWwgd2Vic2l0ZToK4pSCIOKUgiDilJQgaHR0cHM6Ly9obWNsLmh1YW5neXVodWkubmV0LwrilIIg4pSUIE90aGVyIExhdW5jaGVycyBsaWtlIE11bHRpTUMgb3IgQVRMYXVuY2hlciBwbGVhc2UgZG93bmxvYWQgYWxvbmUuCuKUggrilIIg4pSMIE1vZHM6CuKUgiDilIIgUGh5c2ljcyBNb2Qgb2ZmaWNpYWwgZG93bmxvYWQgd2Vic2l0ZTogaHR0cHM6Ly9taW5lY3JhZnRwaHlzaWNzbW9kLmNvbS9kb3dubG9hZCAoU2VlIGFsc28gb24gTW9kcmludGgpCuKUgiDilIIg4pSMIE1pbmVjcmFmdCBTSEFERVJTIGRvd25sb2FkIHNpdGVzOiAK4pSCIOKUgiDilIIgaHR0cHM6Ly93d3cuY3Vyc2Vmb3JnZS5jb20vbWluZWNyYWZ0L3NlYXJjaD9jbGFzcz1zaGFkZXJzJnBhZ2U9MSZwYWdlU2l6ZT0yMCZzb3J0Qnk9cmVsZXZhbmN5IChDdXJzZSBGb3JnZSkK4pSCIOKUgiDilIIgaHR0cHM6Ly9taW5lY3JhZnRzaGFkZXIuY29tIChPdGhlciBTaGFkZXIgV2Vic2l0ZXMpCuKUgiDilIIg4pSCIGh0dHBzOi8vbW9kcmludGguY29tL3NoYWRlcnMgKE1vZHJpbnRoKQrilIIg4pSCIOKUlCBJZiB5b3Ugd2FudCB0byBmaW5kIHRoZSBiZXN0IHNoYWRlcnMgYW5kIGRvd25sb2FkOiBodHRwczovL3d3dy5yb2NrcGFwZXJzaG90Z3VuLmNvbS9iZXN0LW1pbmVjcmFmdC1zaGFkZXJzIChPdGhlciBTaGFkZXIgV2ViZHNpdGVzKQrilJTilIDilLQgWW91IGNhbiBmaW5kIG1vZHMgaW4gQ1VSU0VGT1JHRSBvciBvdGhlciBNaW5lY3JhZnQgbW9kIHBsYXRmb3Jtcy4KCuKUjCBNYWMgUmVzb3VyY2VzOgrilIIK4pSCIOKUjCBNYWMgSW5mb3JtZXI6CuKUgiDilJQgaHR0cHM6Ly9tYWNkb3dubG9hZC5pbmZvcm1lci5jb20vZ28vZ28yLnBocD9kbQrilIIK4pSCIOKUjCBNb3VzZSBDaGFuZ2VyKE1vdXNlQ2FwZSwgbWF5IG5vdCBiZSBuZXdlc3QgdmVyc2lvbi4pOgrilIIg4pSCIGh0dHBzOi8vZ2l0aHViLmNvbS9hbGV4emllbGVuc2tpL01vdXNlY2FwZS9yZWxlYXNlcy9kb3dubG9hZC8xODEzL01vdXNlY2FwZV8xODEzLnppcArilIIg4pSCCuKUgiDilIIgT2ZmaWNpYWwgV2Vic2l0ZToK4pSU4pSA4pS0IGh0dHBzOi8vZ2l0aHViLmNvbS9hbGV4emllbGVuc2tpL21vdXNlY2FwZS9yZWxlYXNlcwoK4pSMIFVzZWZ1bCBUdXRvcmlhbHM6CuKUggrilIIgMS4gT3BlbiBKYXIgZmlsZXMgd2l0aG91dCBBZG1pbmlzdHJhdG9yJ3MgVXNlcm5hbWUgYW5kIFBhc3N3b3JkLiBZb3UgbmVlZCBKQVZBIGluc3RhbGxlZCBmaXJzdC4K4pSCIEluc3RydWN0aW9uczoK4pSCIENvcHkgdGhlIHBhdGggb2YgeW91ciBKYXIgZmlsZS4K4pSCIEdvIGludG8gVGVybWluYWwgb3Igc29tZSBraW5kIG9mIGNvbW1hbmQgaW5wdXRlcgrilIIgICAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAYmFzaOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkArilIIgSW50ZXI64pSCamF2YSAtamFyIFlPVVJGSUxFUEFUSC5qYXLilIIK4pSCICAgICAgIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmArilIIgSW5jYXNlIHlvdSBhcmUgaGF2aW5nIHByb2JsZW1zIHVuZGVyc3RhbmRpbmcsIGhlcmUgaXMgYSBleGFtcGxlOgrilIIg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSAYmFzaOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkArilIIg4pSCamF2YSAtamFyIC9kb3dubG9hZHMvbXlqYXIuamFy4pSCCuKUgiDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgK4pSCCuKUgiBZb3Ugd2lsbCBzZWUgeW91ciBhcHBsaWNhdGlvbiBydW5uaW5nIHVwIQrilIIgV2l0aCB0aGlzIHRyaWNrLCB0aGVyZSBhcmUgc28gbXVjaCBtb3JlIE1pbmVjcmFmdCBMYXVuY2hlcnMgYW5kIHRvb2wgeW91IGNhbiB1c2UhCuKUlCBHb29kIEx1Y2shCgrilIwgRXZvbHZlIFJlc291cmNlczoK4pSCCuKUgiBFdm9sdmUgZ2FtZSBvZmZpY2lhbCB3ZWJzaXRlOiBodHRwczovL3Btb3RzY2htYW5uLmdpdGh1Yi5pby9Fdm9sdmUvCuKUggrilIIgSGFja3MgZm9yIEV2b2x2ZToK4pSCCuKUgiBVbmxpbWl0ZWQgcmVzb3VyY2VzL0NyZWF0aXZlIG1vZGUgaGFjazogaHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yL0V2b2x2ZUlkbGUvY29tbWVudHMvanI5bXoyL2V2b2x2ZV9jcmVhdGl2ZV9tb2RlX3NhdmVfZWRpdG9yX3Rvb2xoYWNrLwrilIIgQ29kZSBNaW5pZmllZDogamF2YXNjcmlwdDohZnVuY3Rpb24oKXtsZXQgZT0kKCQoIm5hdiIpWzBdLmZpcnN0Q2hpbGQpLHQ9ITEsbj0kKCIjbWFpbkNvbHVtbiA+IGRpdiA+IGRpdiA+IHNlY3Rpb24iKSxsPSc8ZGl2IGlkPSJoYWNrQ29udGVudCIgc3R5bGU9InBhZGRpbmc6IDIwcHg7Ij5cbjxzcGFuPkV2b2x2ZSBDcmVhdGl2ZSBNb2RlXG5bbWFkZSBieSBTaW1wbHlOb108L3NwYW4+XG48dGFibGU+XG4gICAgPHRyPlxuICAgICAgICA8dGggc3R5bGU9ImZvbnQtd2VpZ2h0OiBub3JtYWw7IiBjbGFzcz0iaGFzLXRleHQtd2FybmluZyI+XG4gICAgICAgICAgICBUeXBlXG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzdHlsZT0iZm9udC13ZWlnaHQ6IG5vcm1hbDsiIGNsYXNzPSJoYXMtdGV4dC13YXJuaW5nIj5cbiAgICAgICAgICAgIEl0ZW1cbiAgICAgICAgPC90aD5cbiAgICAgICAgPHRoIHN0eWxlPSJmb250LXdlaWdodDogbm9ybWFsOyIgY2xhc3M9Imhhcy10ZXh0LXdhcm5pbmciPlxuICAgICAgICAgICAgUHJvcGVydHlcbiAgICAgICAgPC90aD5cbiAgICAgICAgPHRoIHN0eWxlPSJmb250LXdlaWdodDogbm9ybWFsOyIgY2xhc3M9Imhhcy10ZXh0LXdhcm5pbmciPlxuICAgICAgICAgICAgTmV3IFZhbHVlXG4gICAgICAgIDwvdGg+XG4gICAgICAgIDx0aCBzdHlsZT0iZm9udC13ZWlnaHQ6IG5vcm1hbDsiIGNsYXNzPSJoYXMtdGV4dC1zdWNjZXNzIj5cbiAgICAgICAgICAgIEN1cnJlbnQgVmFsdWVcbiAgICAgICAgPC90aD5cbiAgICA8L3RyPlxuPC90YWJsZT5cbjxidXR0b24gY2xhc3M9ImJ1dHRvbiIgb25DbGljaz0ibmV3U2V0KCkiPk5ldyBTZXQ8L2J1dHRvbj5cbjxidXR0b24gY2xhc3M9ImJ1dHRvbiIgb25DbGljaz0ic2F2ZSgpIiBzdHlsZT0iZmxvYXQ6IHJpZ2h0OyI+U2F2ZSBDaGFuZ2VzPC9idXR0b24+XG5cbjwvZGl2Pic7ZS5hcHBlbmQoJzxsaSBpZD0iaGFja1RhYiIgY2xhc3M+PGEgb25DbGljaz0ib3BlbkhhY2tUYWIoKSI+c2ltcGx5XCdhcyBoYWNrPC9hPjwvbGk+Jyksd2luZG93LmdldFNlc3Npb249KCgpPT5KU09OLnBhcnNlKExaU3RyaW5nLmRlY29tcHJlc3NGcm9tQmFzZTY0KGV4cG9ydEdhbWUoKSkpKSx3aW5kb3cuZ2V0S2V5cz0oKGUsdCk9PntsZXQgbixsLGQ9d2luZG93LmdldFNlc3Npb24oKTtyZXR1cm4iKiI9PWU/KGw9ZCxuPU9iamVjdC5rZXlzKGwpKToiZmlsbCI9PWU/KGw9dCxuPU9iamVjdC5rZXlzKGwpKToobD1kW2VdLG49T2JqZWN0LmtleXMobCkpLCJvYmplY3QiIT10eXBlb2YgbD8wOihuLnNvcnQoKGUsdCk9PmUudG9Mb3dlckNhc2UoKT50LnRvTG93ZXJDYXNlKCk/MTp0LnRvTG93ZXJDYXNlKCk+ZS50b0xvd2VyQ2FzZSgpPy0xOjApLG4ubGVuZ3RoP2A8b3B0aW9uPiR7bi5qb2luKCI8L29wdGlvbj48b3B0aW9uPiIpfTwvb3B0aW9uPmA6LTEpfSksd2luZG93LmhhbmRsZVR5cGU9KGU9PntsZXQgdD0kKGUucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50KSxuPWUudmFsdWUsbD13aW5kb3cuZ2V0S2V5cyhuKTtmb3IoO3RbMF0uY2hpbGRFbGVtZW50Q291bnQ+MTspJCh0WzBdLmxhc3RDaGlsZCkucmVtb3ZlKCk7aWYoLTE9PWwpJCh0WzBdKS5hcHBlbmQoJzx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij5uL2E8L3RkPicpLCQodFswXSkuYXBwZW5kKCc8dGQgc3R5bGU9ImJvcmRlcjowOyI+bi9hPC90ZD4nKSwkKHRbMF0pLmFwcGVuZCgnPHRkIHN0eWxlPSJib3JkZXI6MDsiPm4vYTwvdGQ+JyksJCh0WzBdKS5hcHBlbmQoJzx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij5uL2E8L3RkPicpO2Vsc2UgaWYobCl7bGV0IGU9dC5hcHBlbmQoYDx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij48c2VsZWN0IG9uY2hhbmdlPSJoYW5kbGVJdGVtKHRoaXMpIj4ke2x9PC9zZWxlY3Q+PC90ZD5gKTt3aW5kb3cuaGFuZGxlSXRlbShlWzBdLmNoaWxkcmVuWzFdLmZpcnN0Q2hpbGQpfWVsc2UgJCh0WzBdKS5hcHBlbmQoJzx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij5uL2E8L3RkPicpLCQodFswXSkuYXBwZW5kKCc8dGQgc3R5bGU9ImJvcmRlcjowOyI+bi9hPC90ZD4nKSwkKHRbMF0pLmFwcGVuZCgnPHRkIHN0eWxlPSJib3JkZXI6MDsiPjxpbnB1dCBwbGFjZWhvbGRlcj0iTmV3IFZhbHVlIj48L2lucHV0PjwvdGQ+JyksJCh0WzBdKS5hcHBlbmQoYDx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij4ke3dpbmRvdy5nZXRTZXNzaW9uKClbbl19PC90ZD5gKX0pLHdpbmRvdy5oYW5kbGVJdGVtPShlPT57bGV0IHQ9JChlLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudCksbj10WzBdLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLnZhbHVlLGw9ZS52YWx1ZSxkPXdpbmRvdy5nZXRLZXlzKCJmaWxsIix3aW5kb3cuZ2V0U2Vzc2lvbigpW25dW2xdKTtmb3IoO3RbMF0uY2hpbGRFbGVtZW50Q291bnQ+MjspJCh0WzBdLmxhc3RDaGlsZCkucmVtb3ZlKCk7aWYoLTE9PWQpJCh0WzBdKS5hcHBlbmQoJzx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij5uL2E8L3RkPicpLCQodFswXSkuYXBwZW5kKCc8dGQgc3R5bGU9ImJvcmRlcjowOyI+bi9hPC90ZD4nKSwkKHRbMF0pLmFwcGVuZCgnPHRkIHN0eWxlPSJib3JkZXI6MDsiPm4vYTwvdGQ+Jyk7ZWxzZSBpZihkKXtsZXQgZT10LmFwcGVuZChgPHRkIHN0eWxlPSJib3JkZXI6MDsiPjxzZWxlY3Qgb25jaGFuZ2U9ImhhbmRsZVByb3AodGhpcykiPiR7ZH08L3NlbGVjdD48L3RkPmApO3dpbmRvdy5oYW5kbGVQcm9wKGVbMF0uY2hpbGRyZW5bMl0uZmlyc3RDaGlsZCl9ZWxzZSAkKHRbMF0pLmFwcGVuZCgnPHRkIHN0eWxlPSJib3JkZXI6MDsiPm4vYTwvdGQ+JyksJCh0WzBdKS5hcHBlbmQoJzx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij48aW5wdXQgcGxhY2Vob2xkZXI9Ik5ldyBWYWx1ZSI+PC9pbnB1dD48L3RkPicpLCQodFswXSkuYXBwZW5kKGA8dGQgc3R5bGU9ImJvcmRlcjowOyI+JHt3aW5kb3cuZ2V0U2Vzc2lvbigpW25dW2xdfTwvdGQ+YCl9KSx3aW5kb3cuaGFuZGxlUHJvcD0oZT0+e2xldCB0PSQoZS5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQpLG49dFswXS5jaGlsZHJlblswXS5jaGlsZHJlblswXS52YWx1ZSxsPXRbMF0uY2hpbGRyZW5bMV0uY2hpbGRyZW5bMF0udmFsdWUsZD1lLnZhbHVlLGE9d2luZG93LmdldEtleXMoImZpbGwiLHdpbmRvdy5nZXRTZXNzaW9uKClbbl1bbF1bZF0pO2Zvcig7dFswXS5jaGlsZEVsZW1lbnRDb3VudD4zOykkKHRbMF0ubGFzdENoaWxkKS5yZW1vdmUoKTstMT09YT8oJCh0WzBdKS5hcHBlbmQoJzx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij5uL2E8L3RkPicpLCQodFswXSkuYXBwZW5kKCc8dGQgc3R5bGU9ImJvcmRlcjowOyI+bi9hPC90ZD4nKSk6YT9hbGVydCgib2giKTooJCh0WzBdKS5hcHBlbmQoJzx0ZCBzdHlsZT0iYm9yZGVyOjA7Ij48aW5wdXQgcGxhY2Vob2xkZXI9Ik5ldyBWYWx1ZSI+PC9pbnB1dD48L3RkPicpLCQodFswXSkuYXBwZW5kKGA8dGQgc3R5bGU9ImJvcmRlcjowOyI+JHt3aW5kb3cuZ2V0U2Vzc2lvbigpW25dW2xdW2RdfTwvdGQ+YCkpfSksd2luZG93Lm5ld1NldD0oKCk9PntsZXQgZT0kKCIjaGFja0NvbnRlbnQgPiB0YWJsZSA+IHRib2R5IikuYXBwZW5kKGAgICAgPHRyPlxuICAgIDx0ZCBzdHlsZT0iYm9yZGVyOiAwOyI+XG4gICAgICAgIDxzZWxlY3Qgb25jaGFuZ2U9ImhhbmRsZVR5cGUodGhpcykiPlxuICAgICAgICAgICAgJHtnZXRLZXlzKCIqIil9XG4gICAgICAgIDwvc2VsZWN0PlxuICAgIDwvdGQ+XG48L3RyPmApO3dpbmRvdy5oYW5kbGVUeXBlKGVbMF0ubGFzdENoaWxkLmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdKX0pLHdpbmRvdy5zYXZlPSgoKT0+e2xldCBlPXdpbmRvdy5nZXRTZXNzaW9uKCk7QXJyYXkuZnJvbSgkKCIjaGFja0NvbnRlbnQgPiB0YWJsZSA+IHRib2R5IilbMF0uY2hpbGRyZW4pLmZvckVhY2goKHQsbik9PntpZihuKXtsZXQgdD0kKGAjaGFja0NvbnRlbnQgPiB0YWJsZSA+IHRib2R5ID4gdHI6bnRoLWNoaWxkKCR7bisxfSkgPiB0ZDpudGgtY2hpbGQoMSkgPiBzZWxlY3RgKVswXT8kKGAjaGFja0NvbnRlbnQgPiB0YWJsZSA+IHRib2R5ID4gdHI6bnRoLWNoaWxkKCR7bisxfSkgPiB0ZDpudGgtY2hpbGQoMSkgPiBzZWxlY3RgKVswXS52YWx1ZTpudWxsLGw9JChgI2hhY2tDb250ZW50ID4gdGFibGUgPiB0Ym9keSA+IHRyOm50aC1jaGlsZCgke24rMX0pID4gdGQ6bnRoLWNoaWxkKDIpID4gc2VsZWN0YClbMF0/JChgI2hhY2tDb250ZW50ID4gdGFibGUgPiB0Ym9keSA+IHRyOm50aC1jaGlsZCgke24rMX0pID4gdGQ6bnRoLWNoaWxkKDIpID4gc2VsZWN0YClbMF0udmFsdWU6bnVsbCxkPSQoYCNoYWNrQ29udGVudCA+IHRhYmxlID4gdGJvZHkgPiB0cjpudGgtY2hpbGQoJHtuKzF9KSA+IHRkOm50aC1jaGlsZCgzKSA+IHNlbGVjdGApWzBdPyQoYCNoYWNrQ29udGVudCA+IHRhYmxlID4gdGJvZHkgPiB0cjpudGgtY2hpbGQoJHtuKzF9KSA+IHRkOm50aC1jaGlsZCgzKSA+IHNlbGVjdGApWzBdLnZhbHVlOm51bGwsYT0kKGAjaGFja0NvbnRlbnQgPiB0YWJsZSA+IHRib2R5ID4gdHI6bnRoLWNoaWxkKCR7bisxfSkgPiB0ZDpudGgtY2hpbGQoNCkgPiBpbnB1dGApWzBdPyQoYCNoYWNrQ29udGVudCA+IHRhYmxlID4gdGJvZHkgPiB0cjpudGgtY2hpbGQoJHtuKzF9KSA+IHRkOm50aC1jaGlsZCg0KSA+IGlucHV0YClbMF0udmFsdWU6bnVsbDthJiYoZD9lW3RdW2xdW2RdPWE6bD9lW3RdW2xdPWE6dCYmKGVbdF09YSkpfX0pO2xldCB0PUxaU3RyaW5nLmNvbXByZXNzVG9CYXNlNjQoSlNPTi5zdHJpbmdpZnkoZSkpO2ltcG9ydEdhbWUodCl9KSx3aW5kb3cub3BlbkhhY2tUYWI9KCgpPT57dHx8KHQ9ITAsblswXS5jaGlsZE5vZGVzLmZvckVhY2goZT0+eyJoYWNrQ29udGVudCIhPT1lLmlkJiZlLnNldEF0dHJpYnV0ZSgic3R5bGUiLCJkaXNwbGF5OiBub25lIil9KSwkKG5bMF0pLmFwcGVuZChsLnJlcGxhY2UoIiVLRVlTX0dMT0JBTCUiLGdldEtleXMoIioiKSkpLGVbMF0uY2hpbGROb2Rlcy5mb3JFYWNoKGU9PnsiaGFja1RhYiIhPT1lLmlkPyhlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCIiKSxlLnNldEF0dHJpYnV0ZSgib25DbGljayIsImNsb3NlSGFja1RhYigpIikpOmUuc2V0QXR0cmlidXRlKCJjbGFzcyIsImlzLWFjdGl2ZSIpfSksd2luZG93Lm5ld1NldCgpKX0pLHdpbmRvdy5jbG9zZUhhY2tUYWI9KCgpPT57dCYmKHQ9ITEsZVswXS5jaGlsZE5vZGVzLmZvckVhY2goZT0+eyJoYWNrVGFiIiE9PWUuaWQ/ZS5zZXRBdHRyaWJ1dGUoIm9uQ2xpY2siLCJjbG9zZUhhY2tUYWIoKSIpOmUuc2V0QXR0cmlidXRlKCJjbGFzcyIsIiIpfSksJCgiI2hhY2tDb250ZW50IikucmVtb3ZlKCkpfSksd2luZG93Lm9wZW5IYWNrVGFiKCl9KCk7CuKUggrilIIgU3BlZWQgaGFjazogaHR0cHM6Ly93d3cucmVkZGl0LmNvbS9yL0V2b2x2ZUlkbGUvY29tbWVudHMvMWd5a253My91c2Vyc2NyaXB0X2dhbWVfc3BlZWRfbXVsdGlwbGllci8K4pSCIENvZGUgTWluaWZpZWQ6ICgoKT0+eyJ1c2Ugc3RyaWN0Ijtjb25zdCBlPShuPSJjdXN0b21TcGVlZCIsdD0xLEpTT04ucGFyc2Uod2luZG93LmxvY2FsU3RvcmFnZS5nZXRJdGVtKG4pKXx8dCk7dmFyIG4sdDtjb25zdCBvPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpO28udGV4dENvbnRlbnQ9YFxuICAgICAgICAoKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGN1c3RvbVNwZWVkID0gJHtlfTtcbiAgICAgICAgICAgIGxldCBmcm9tU2NyaXB0ID0gZmFsc2U7XG4gICAgICAgICAgICBsZXQgdnVlTWV0aG9kO1xuXG4gICAgICAgICAgICBjb25zdCBvbGRQb3N0ID0gV29ya2VyLnByb3RvdHlwZS5wb3N0TWVzc2FnZTtcblxuICAgICAgICAgICAgV29ya2VyLnByb3RvdHlwZS5wb3N0TWVzc2FnZSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJnc1swXS5wZXJpb2QpIHtcbiAgICAgICAgICAgICAgICAgICAgYXJnc1swXS5wZXJpb2QgPSBhcmdzWzBdLnBlcmlvZCAvIGN1c3RvbVNwZWVkO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG9sZFBvc3QuYXBwbHkodGhpcywgYXJncyk7XG5cbiAgICAgICAgICAgICAgICBpZiAoZnJvbVNjcmlwdCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2dWVNZXRob2QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2dWVNZXRob2QucGF1c2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIGZyb21TY3JpcHQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCBoaWphY2tXb3JrZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHZ1ZU1ldGhvZCAmJiAhdnVlTWV0aG9kLl9kYXRhLnMucGF1c2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbVNjcmlwdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHZ1ZU1ldGhvZC5wYXVzZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZVNwZWVkRGlzcGxheSA9IChzcGVlZFNwYW4pID0+IHtcbiAgICAgICAgICAgICAgICBzcGVlZFNwYW4udGV4dENvbnRlbnQgPSBcYHNwZWVkIMOXXCR7Y3VzdG9tU3BlZWR9XGA7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgdGltZXIgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmVyc2lvbkxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ2ZXJzaW9uTG9nIik7XG4gICAgICAgICAgICAgICAgaWYgKCF2ZXJzaW9uTG9nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzcGVlZFNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7XG4gICAgICAgICAgICAgICAgc3BlZWRTcGFuLmlkID0gImN1c3RvbVNwZWVkIjtcbiAgICAgICAgICAgICAgICBzcGVlZFNwYW4uY2xhc3NOYW1lID0gInZlcnNpb24iO1xuICAgICAgICAgICAgICAgIHNwZWVkU3Bhbi5zdHlsZS5jdXJzb3IgPSAicG9pbnRlciI7XG4gICAgICAgICAgICAgICAgdXBkYXRlU3BlZWREaXNwbGF5KHNwZWVkU3Bhbik7XG5cbiAgICAgICAgICAgICAgICBzcGVlZFNwYW4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1NwZWVkID0gTWF0aC5tYXgoXG4gICAgICAgICAgICAgICAgICAgICAgICBOdW1iZXIocHJvbXB0KCJtdWx0aXBseSBkZWZhdWx0IGdhbWUgc3BlZWQgYnk6IiwgY3VzdG9tU3BlZWQpKSB8fCAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgMVxuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21TcGVlZCA9IG5ld1NwZWVkO1xuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnc3BlZWRDaGFuZ2VkJywgeyBkZXRhaWw6IG5ld1NwZWVkIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3BlZWREaXNwbGF5KHNwZWVkU3Bhbik7XG4gICAgICAgICAgICAgICAgICAgIGhpamFja1dvcmtlcigpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdmVyc2lvbkxvZy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShzcGVlZFNwYW4sIHZlcnNpb25Mb2cpO1xuICAgICAgICAgICAgICAgIHZ1ZU1ldGhvZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN0b3BCYXIiKS5fX3Z1ZV9fO1xuICAgICAgICAgICAgICAgIGhpamFja1dvcmtlcigpO1xuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfSkoKTtcbiAgICBgLGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hcHBlbmRDaGlsZChvKSxvLnJlbW92ZSgpLGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoInNwZWVkQ2hhbmdlZCIsKGU9PnsoKGUsbik9Pnt3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oZSxKU09OLnN0cmluZ2lmeShuKSl9KSgiY3VzdG9tU3BlZWQiLGUuZGV0YWlsKX0pKX0pKCk7CuKUggrilIIgICAgICAgICAgICAg4pSM4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSQIOKUjOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUkArilIIgSG93IHRvIGNvcHk64pSCY29tbWFuZChjb250cm9sKSBzaGlmdCByaWdodF9hcnJvd+KUgivilIJjb21tYW5kKGNvbnRyb2wpICJDIuKUggrilIIgICAgICAgICAgICAg4pSU4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSYIOKUlOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUmArilJQgSGF2ZSBmdW4gd2l0aCB0aGUgaGFjayA9RAoKICAK4pSMIEN1cnJlbnQgUHJvYmxlbXM6CuKUggrilIIgQWRtaW5pc3RyYXRvcidzIFVzZXJuYW1lIGFuZCBQYXNzd29yZCBpcyByZXF1aXJlZCBmb3IgVlBOCuKUgiBORVdTISEgU29tZSBjbHVlcyBwb2ludGVkIHRvIG5ldyBWUE4gc291cmNlISBVc2UgdGhlIGJyb3dzZXIgb3Igc29tZSBraW5kIG9mIGV4dGVybmFsIFZQTihGb3IgbWFjKQrilIIgSmF2YSB1cGRhdGluZyBpcyByZXF1aXJpbmcgQWRtaW5pc3RyYXRvcidzIFVzZXJuYW1lIGFuZCBQYXNzd29yZArilIIK4pSUIFBsZWFzZSBoZWxwIHNvbHZlIHRoZXNlIHByb2JsZW1zISBJZiB5b3UgZmluZCBhbnkgc29sdXRpb25zLCBlbWFpbCB5b3VyIHNvbHV0aW9uIHRvIE1pbmVjcm93YXZlckBvdXRsb29rLmNvbSEgVGhhbmsgeW91IQogICAgICAgICAgICAgICAgICAgICDilIzilIDilIDilIB0ZXh04pSA4pSA4pSQCkN1cnJlbnQgSFRNTCBWZXJzaW9uOuKUgkhUTUwgYjEuMeKUggogICAgICAgICAgICAgICAgICAgICDilJTilIDilIDilIDilIDilIDilIDilIDilIDilIDilJgKCgoKQ3VycmVudGx5LCB0aGlzIEhUTUwgaXMgYXQgYmV0YS4KCgoK4pWt4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pSA4pWuCuKUgiBCTE9YRCBUVVRPUklBTFMg4pSCCuKVsOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKUgOKVrwpCbG94ZC5pbyBpcyBhIG11bHRpcGxheWVyIHZveGVsIHNhbmRib3ggZ2FtZSBmcmVlIHRvIHBsYXkgb25saW5lLCBvcmlnaW5hbGx5IGluc3BpcmVkIGJ5IE1pbmVjcmFmdC4gClRoZSBnYW1lIGZlYXR1cmVzIGEgdmFyaWV0eSBvZiBkaWZmZXJlbnQgc3ViLWdhbWVzLCBiZXR0ZXIga25vd24gYXMgZ2FtZW1vZGVzLCBlYWNoIGhhdmluZyBhIHVuaXF1ZSB0d2lzdCBvbiB0aGUgZ2FtZXMgY29yZS4KCkhvdyB0byBoYWNrIGluIEJsb3hkLmlvPwoKSSBkbyBub3QgcmVjb21tZW5kIGhhY2tpbmcgb3IgY2hlYXRpbmcgaW4gZ2FtZXMuIEhlcmUncyB3aHk6CgpJdCdzIGFnYWluc3QgdGhlIHJ1bGVzIC0gR2FtZSBkZXZlbG9wZXJzIHdvcmsgaGFyZCB0byBjcmVhdGUgZmFpciBleHBlcmllbmNlcyBmb3IgYWxsIHBsYXllcnMKUmlza3MgeW91ciBhY2NvdW50IC0gSGFja2luZyBjYW4gZ2V0IHlvdSBwZXJtYW5lbnRseSBiYW5uZWQKU2VjdXJpdHkgcmlza3MgLSAiSGFja2luZyIgdHV0b3JpYWxzIG9mdGVuIGNvbnRhaW4gbWFsd2FyZQpSdWluIHRoZSBleHBlcmllbmNlIC0gQ2hlYXRpbmcgbWFrZXMgdGhlIGdhbWUgbGVzcyBmdW4gZm9yIGV2ZXJ5b25lCgpCZXR0ZXIgYWx0ZXJuYXRpdmVzOgoKTGVhcm4gbGVnaXRpbWF0ZSBnYW1lIHN0cmF0ZWdpZXMgZnJvbSBvZmZpY2lhbCB0dXRvcmlhbHMKUHJhY3RpY2UgdG8gaW1wcm92ZSB5b3VyIHNraWxscyBuYXR1cmFsbHkKSm9pbiBjb21tdW5pdHkgZm9ydW1zIHRvIGxlYXJuIGZyb20gZXhwZXJpZW5jZWQgcGxheWVycwpTdWdnZXN0IGZlYXR1cmVzIHRvIGRldmVsb3BlcnMgdGhyb3VnaCBwcm9wZXIgY2hhbm5lbHMKCkJ1dCB3aGF0ZXZlci4uLi4uLgoKSGFjayBvbmU6ICJTcGVjdHJhIiBDbGllbnQgZm9yIEJsb3hkLmlvClVzZSBCbG94ZC5pbydzIGNvbnNvbGUgaW4gRGV2IFRvb2xzIGFuZCBwYXN0ZSBpbiB0aGlzIGNvZGU6IAoKLy8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBTcGVjdHJhIENsaWVudCAoSGFja3MgRXh0cmFjdGVkKQovLyBAbmFtZXNwYWNlICAgIGh0dHA6Ly90YW1wZXJtb25rZXkubmV0LwovLyBAdmVyc2lvbiAgICAgIDEuMAovLyBAZGVzY3JpcHRpb24gIEFsbCBoYWNrcyBmcm9tIHBvdHRlcnkwMDkudHh0IHdpdGggdGhlIFNwZWN0cmEgQ2xpZW50IFVJCi8vIEBhdXRob3IgICAgICAgSnVsZXMKLy8gQG1hdGNoICAgICAgICBodHRwczovL2Jsb3hkLmlvLwovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gQGRvd25sb2FkVVJMIGh0dHBzOi8vdXBkYXRlLmdyZWFzeWZvcmsub3JnL3NjcmlwdHMvNTQ4ODAzL1NwZWN0cmElMjBDbGllbnQlMjAlMjhIYWNrcyUyMEV4dHJhY3RlZCUyOS51c2VyLmpzCi8vIEB1cGRhdGVVUkwgaHR0cHM6Ly91cGRhdGUuZ3JlYXN5Zm9yay5vcmcvc2NyaXB0cy81NDg4MDMvU3BlY3RyYSUyMENsaWVudCUyMCUyOEhhY2tzJTIwRXh0cmFjdGVkJTI5Lm1ldGEuanMKLy8gPT0vVXNlclNjcmlwdD09CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CgogICAgLy9fX1NUQVJUX19IQUNLX0NPREVfRlJPTV9QT1RURVJZMDA5X1RYVF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX18KCiAgICBsZXQgRnV4bnkgPSB7fTsKICAgIGxldCBkZWZhdWx0QWNjZW50ID0gIiNGRjAwMDAiOwoKICAgIGNvbnN0IFRJVExFID0gIk1pZG5pZ2h0X18iIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1UaXRsZQoKCiAgICBjb25zdCBjaGFuZ2VIZWFsdGhCYXIgPSB0cnVlIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tQ2hhbmdlIGhlYWx0aCBiYXIgY29sb3IgdG8gZ3JhZGllbnQgY29sb3IKICAgIGNvbnN0IHNwb29mUmFua3NFbmFibGVkID0gdHJ1ZTsgLy8gLS0tLS0tLS0tLS0tLS0tLS1HaXZlcyB5b3UgYWxsIHJhbmtzIChZVCwgU3VwZXIsIERldmVsb3BlcikKICAgIGNvbnN0IEFUVEFDS19JTlRFUlZBTF9NUyA9IDIwOyAvLyAtLS0tLS0tLS0tLS0tLS0tLUhvdyBmYXN0IHRvIGhpdCBwbGF5ZXJzIHdpdGggdHJpZ2dlcmJvdC9raWxsQXVyYSAgICBMT1cgPSBCQU4KICAgIGxldCBkZXNpcmVkUG90aW9uU2xvdCA9IDEgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1XaGF0IHNsb3Qgc2hvdWxkIHBvdGlvbnMgZ28gdG8/IE51bWJlcnMgc3RhcnQgYXQgemVybyEgMC05CiAgICBsZXQgc3Bpa2VTbG90ID0gOCAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tV2hhdCBzbG90IGRvIHNwaWtlcyBhdXRvbWF0aWNhbGx5IGdvIGluPyAwLTkKICAgIGxldCB3ZWJTbG90ID0gOSAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1XaGF0IHNsb3QgZG8gd2VicyAvIG5ldHMgYXV0b21hdGljYWxseSBnbyBpbj8gMC05CgoKICAgIGxldCBhbHJlYWR5Q29ubmVjdGVkID0gbnVsbDsKICAgIGxldCBjb2x5Um9vbSA9IG51bGw7CiAgICBsZXQgc2VuZEJ5dGVzTmFtZSA9IG51bGw7CiAgICBsZXQgZ2FtZU9iamVjdHMgPSB7fTsKICAgIGxldCBpbmplY3RlZEJvb2wgPSBmYWxzZTsKICAgIGxldCBteUlkID0gMQogICAgbGV0IGlzSW5pdGlhbGl6aW5nID0gdHJ1ZTsKICAgIGxldCBjbGllbnRPcHRpb25zID0gbnVsbDsKICAgIGxldCBub2FQYXJlbnQgPSBudWxsOwogICAgbGV0IG5vYUtleUluUGFyZW50ID0gbnVsbDsKICAgIGxldCBibGlua1N0YXRlID0gewogICAgICAgIGVuYWJsZWQ6IGZhbHNlLAogICAgICAgIG9yaWdpbmFsU2VuZEJ5dGVzOiBudWxsLAogICAgICAgIHF1ZXVlZDogW10sCiAgICAgICAgaW50ZXJ2YWw6IDAsCiAgICAgICAgbm9QYWNrZXQ6IGZhbHNlCiAgICB9OwoKICAgIGxldCBldmVyRW5hYmxlZCA9IHt9OwoKICAgIGxldCB3YWxsSnVtcEludGVydmFsID0gbnVsbDsKICAgIGxldCB3YWxsSnVtcFJ1bm5pbmcgPSBmYWxzZTsKCgogICAgbGV0IGxvY2tQbGF5ZXJXYXRlclN0YXRlSW50ZXJ2YWwgPSBudWxsOwogICAgbGV0IHdhdGVySnVtcGluZ0VuYWJsZWQgPSBmYWxzZQoKCiAgICBsZXQgd2lyZUZyYW1lc0Jvb2wgPSBmYWxzZTsKCgogICAgbGV0IGVzcEVuYWJsZWQgPSBmYWxzZTsKCiAgICBsZXQgY2hlc3RFU1BFbmFibGVkID0gZmFsc2U7CiAgICBsZXQgb3JlRVNQRW5hYmxlZCA9IGZhbHNlOwogICAgbGV0IGNoZXN0T3JlSW50ZXJ2YWwgPSBudWxsOwogICAgbGV0IGNoZXN0Qm94ZXMgPSB7fTsKCgoKICAgIGxldCBpc1NreWJveEhpZGRlbiA9IGZhbHNlOwoKCiAgICBsZXQgdHJpZ2dlckJvdEVuYWJsZWQgPSBmYWxzZTsKICAgIGxldCB0b2dnbGVUcmlnZ2VyQm90SW50ZXJ2YWwgPSBudWxsOwoKCiAgICBjb25zdCBwb3NzaWJsZU5hbWVzID0gWwogICAgICAgIC8vIkxlZ0xlZnRNZXNoIiwKICAgICAgICAvLyJMZWdSaWdodE1lc2giLAogICAgICAgIC8vIlRvcnNvTm9kZSIsCiAgICAgICAgLy8iQXJtTGVmdE1lc2giLAogICAgICAgIC8vIkFybVJpZ2h0TWVzaCIsCiAgICAgICAgIkJvZHlNZXNoIiwKICAgICAgICAnQm9keXxBcm1vdXInLAogICAgICAgIC8vIkhlYWRNZXNoIgogICAgXTsgLy8gUG90ZW50aWFsIGRldGVjdGlvbjogSWYgdGhlIHBsYXllciBoYXMgbGVnIGFybW91ciB0aGVyZSBpcyBubyB3YXkgbGVmdExlZ01lc2ggY291bGQgaGF2ZSBiZWVuIGhpdC4KICAgIGxldCBraWxsQXVyYUVuYWJsZWQgPSBmYWxzZQogICAgbGV0IGtpbGxBdXJhSW50ZXJ2YWxJZCA9IG51bGwKICAgIGxldCBsYXN0Q2xvc2VzdElkID0gbnVsbAogICAgbGV0IG5ld0JveCA9IG51bGw7CiAgICBsZXQgbmV3Qm94SWQgPSBudWxsOwogICAgbGV0IF9fbnVsbEtleSA9IG51bGw7IC8vRW50aXR5IGVuYWJsZWQga2V5CiAgICBsZXQgX19zdHJpbmdLZXkgPSBudWxsOyAvL0VudGl0eSBJRCBrZXkgIlRoZW4gd2h5IGRpZG4ndCB5b3UganVzdCBsYWJlbCB0aGVtIHRoYXQ/IgogICAgbGV0IGFuaW1hdGlvbkZyYW1lSWQgPSBudWxsOwogICAgbGV0IGhpdEJveEVuYWJsZWQgPSBmYWxzZTsKICAgIGNvbnN0IGhpdGJveGVzID0ge307CgoKICAgIGxldCBjYWNoZWROYW1lVGFnUGFyZW50ID0gbnVsbDsKICAgIGxldCBjYWNoZWRCSE9QUGFyZW50ID0gbnVsbDsKCgogICAgbGV0IGF1dG9Qb3Rpb25FbmFibGVkID0gZmFsc2U7CiAgICBsZXQgYXV0b1BvdGlvbkludGVydmFsID0gbnVsbDsKCgogICAgbGV0IG5hbWVUYWdzRW5hYmxlZCA9IGZhbHNlOwogICAgbGV0IG5hbWVUYWdzSW50ZXJ2YWxJZCA9IG51bGw7CiAgICBsZXQgbmFtZVRhZ1BhcmVudCA9IG51bGw7CgoKICAgIGxldCBiaG9wRW5hYmxlZCA9IGZhbHNlOwogICAgbGV0IGJob3BJbnRlcnZhbElkID0gbnVsbDsKCiAgICBsZXQgZW5lbXlIZWFsdGhHdWlFbmFibGVkID0gZmFsc2U7CiAgICBsZXQgaGVhbHRoV2F0Y2hlckludGVydmFsID0gbnVsbDsKICAgIGxldCBsYXN0UGVyY2VudCA9IG51bGw7CiAgICBsZXQgbGFzdENoYW5nZVRpbWUgPSBEYXRlLm5vdygpOwogICAgbGV0IHJlc2V0VGltZW91dCA9IG51bGw7CgoKICAgIGxldCBlSWRLZXkgPSBudWxsOwogICAgbGV0IHRhcmdldEVudGl0eSA9IG51bGw7CiAgICBsZXQgdGFyZ2V0RW50aXR5RGlzdGFuY2UgPSBudWxsOwoKCiAgICBsZXQgcGlja3VwUmVhY2hFbmFibGVkID0gZmFsc2U7IC8vQ3JlZGl0cyB0byB3YW5nISEhIQogICAgbGV0IG9yaWdpbmFsR2V0RW50aXRpZXNJbkFBQkIgPSBudWxsOwogICAgY29uc3QgUkFOR0VfTVVMVElQTElFUiA9IDU7CiAgICBsZXQgZ2hNZXRob2RLZXkgPSBudWxsOwogICAgbGV0IHByb3RvID0gbnVsbDsKCgogICAgbGV0IGJob3BLbmlmZUVuYWJsZWQgPSBmYWxzZTsKICAgIGxldCBzcGFjZVZpZDsKICAgIGxldCBmYWRlVm9sdW1lSW50ZXJ2YWw7CiAgICBsZXQgc3BhY2VIZWxkID0gZmFsc2U7CiAgICBsZXQgYmlnSGVhZHNFbmFibGVkID0gZmFsc2U7CiAgICBsZXQgYW50aUJhbkVuYWJsZWQgPSBmYWxzZTsKCgogICAgY29uc3Qgc2Nhbm5lZENodW5rcyA9IG5ldyBTZXQoKTsKICAgIGxldCBjaHVua0RhdGFGaWVsZCA9IG51bGw7CgogICAgLy8gRVRDCiAgICBsZXQgcGxheWVyS2V5ID0gbnVsbDsKICAgIGxldCBtb3ZlU3RhdGUgPSBudWxsOwogICAgbGV0IHBoeXNTdGF0ZSA9IG51bGw7CiAgICBsZXQgaHVtYW5vaWRNZXNobGlzdCA9IG51bGw7CiAgICBsZXQgcGxheWVyRW50aXR5ID0gbnVsbDsKICAgIGxldCBza3lib3hFbnRpdHkgPSBudWxsOwogICAgbGV0IHNreWJveE1lc2ggPSBudWxsOwogICAgbGV0IGJpZ0hlYWRzSW50ZXJ2YWwgPSBudWxsOwogICAgbGV0IHNjYWZmb2xkSW50ZXJ2YWxJZCA9IG51bGw7CiAgICBsZXQgdGFyZ2V0RmluZGVySWQgPSBudWxsOwogICAgbGV0IHNldEhlYWx0aEJhciA9IG51bGw7CiAgICBsZXQgcGxheWVySW52ZW50b3J5UGFyZW50ID0gbnVsbDsKCgogICAgLy8gVmFyaWFibGVzIGFuZCBoZWxwZXIgZnVuY3Rpb25zIG91dHNpZGUgdGhlIG9iamVjdAogICAgbGV0IGRpc3RhbmNlID0gMC4xOwogICAgbGV0IG1vdmVJbnRlcnZhbCA9IG51bGw7CiAgICBsZXQgbGFzdFVwVGltZSA9IDA7CgoKCiAgICB2YXIgUyA9IHsKICAgICAgICBub3JtYWxpemVWZWN0b3IodCkgeyBsZXQgZSA9IHRbMF0gKiB0WzBdICsgdFsxXSAqIHRbMV0gKyB0WzJdICogdFsyXTsgaWYgKGUgPiAwKSB7IGxldCBpID0gMSAvIE1hdGguc3FydChlKTsgcmV0dXJuIFt0WzBdICogaSwgdFsxXSAqIGksIHRbMl0gKiBpXSB9IHJldHVybiB0IH0sCiAgICAgICAgZGlzdGFuY2VCZXR3ZWVuKHQsIGUpIHsgbGV0IGkgPSBlWzBdIC0gdFswXSwgbyA9IGVbMV0gLSB0WzFdLCBzID0gZVsyXSAtIHRbMl07IHJldHVybiBpICogaSArIG8gKiBvICsgcyAqIHMgfSwKICAgICAgICBkaXN0YW5jZUJldHdlZW5TcXJ0KHQsIGUpIHsgcmV0dXJuIE1hdGguc3FydCh0aGlzLmRpc3RhbmNlQmV0d2Vlbih0LCBlKSkgfSwKICAgICAgICBsZXJwKHQsIGUsIGkpIHsgcmV0dXJuIHQgKyAoZSAtIHQpICogaSB9CiAgICB9OwogICAgdmFyIEQgPSB7CiAgICAgICAgZmFrZU1vdXNlRXZlbnQodCkgewogICAgICAgICAgICBsZXQgZSA9IHsgYnV0dG9uOiAwLCBidXR0b25zOiAxLCBjbGllbnRYOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5OTkgKyAxKSwgY2xpZW50WTogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOTk5ICsgMSksIHNjcmVlblg6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDk5OSArIDEpLCBzY3JlZW5ZOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA5OTkgKyAxKSwgdGFyZ2V0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIjbm9hLWNvbnRhaW5lciIpLCB0eXBlOiB0LCBpc1RydXN0ZWQ6ICEwLCB2aWV3OiB3aW5kb3csIGJ1YmJsZXM6ICEwLCBjYW5jZWxhYmxlOiAhMCwgdGltZVN0YW1wOiBwZXJmb3JtYW5jZS5ub3coKSB9OwogICAgICAgICAgICByZXR1cm4gZS5wcm90b3R5cGUgPSBNb3VzZUV2ZW50LnByb3RvdHlwZSwgZQogICAgICAgIH0KICAgIH07CiAgICB2YXIgQyA9IHsKICAgICAgICB3cFJlcXVpcmU6IG51bGwsIF9jYWNoZWROb2E6IG51bGwsCiAgICAgICAgZ2V0IG5vYSgpIHsgcmV0dXJuIHRoaXM/Ll9jYWNoZWROb2EgfHwgKHRoaXMuX2NhY2hlZE5vYSA9IHIudmFsdWVzKHRoaXMuYmxveGRQcm9wcykuZmluZCh0ID0+IHQ/LmVudGl0aWVzKSksIHRoaXMuX2NhY2hlZE5vYSB9LAogICAgICAgIGluaXQoKSB7CiAgICAgICAgICAgIGxldCB0ID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMod2luZG93KSwgZSA9IE9iamVjdC5rZXlzKHQpLmZpbmQocyA9PiB0W3NdPy5zZXQ/LnRvU3RyaW5nKCkuaW5jbHVkZXMoIisrIikpLCBpID0gd2luZG93W2VdID0gd2luZG93W2VdLCBvID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOTk5OTk5OSArIDEpOwogICAgICAgICAgICBpLnB1c2goWyBbb10sIHt9LCBzID0+IHRoaXMud3BSZXF1aXJlID0gcyBdKSwgdGhpcy5ibG94ZFByb3BzID0gci52YWx1ZXModGhpcy5maW5kTW9kdWxlKCJub25CbG9ja3NDbGllbnQ6IikpLmZpbmQocyA9PiB0eXBlb2YgcyA9PSAib2JqZWN0IikKICAgICAgICB9LAogICAgICAgIGZpbmRNb2R1bGUodCkgeyBsZXQgZSA9IHRoaXMud3BSZXF1aXJlLm07IGZvciAobGV0IGkgaW4gZSkgeyBsZXQgbyA9IGVbaV07IGlmIChvICYmIG8udG9TdHJpbmcoKS5pbmNsdWRlcyh0KSkgcmV0dXJuIHRoaXMud3BSZXF1aXJlKGkpIH0gcmV0dXJuIG51bGwgfQogICAgfSwgbCA9IEM7CiAgICB2YXIgSSA9IHsKICAgICAgICBnZXRQb3NpdGlvbih0KSB7IHJldHVybiBsLm5vYS5lbnRpdGllcy5nZXRTdGF0ZSh0LCAicG9zaXRpb24iKS5wb3NpdGlvbiB9LAogICAgICAgIGdldCBnZXRNb3ZlU3RhdGUoKSB7IHJldHVybiByLnZhbHVlcyhsLm5vYS5lbnRpdGllcylbMzZdIH0sCiAgICAgICAgZ2V0UGh5c2ljc0JvZHkodCkgeyByZXR1cm4gbC5ub2EuZW50aXRpZXMuZ2V0U3RhdGUodCwgInBoeXNpY3MiKS5ib2R5IH0sCiAgICAgICAgZ2V0IHJlZ2lzdHJ5KCkgeyByZXR1cm4gci52YWx1ZXMobC5ub2EpWzE3XSB9LAogICAgICAgIGdldCBnZXRCbG9ja1NvbGlkaXR5KCkgeyByZXR1cm4gci52YWx1ZXModGhpcy5yZWdpc3RyeSlbNV0gfSwKICAgICAgICBnZXQgZ2V0QmxvY2tJRCgpIHsgcmV0dXJuIGwubm9hLmJsb3hkW09iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGwubm9hLmJsb3hkLmNvbnN0cnVjdG9yLnByb3RvdHlwZSlbM11dLmJpbmQobC5ub2EuYmxveGQpIH0sCiAgICAgICAgZ2V0IGdldEhlbGRJdGVtKCkgeyByZXR1cm4gci52YWx1ZXMobC5ub2EuZW50aXRpZXMpLmZpbmQodCA9PiB0Py5sZW5ndGggPT0gMSAmJiB0Py50b1N0cmluZygpPy5sZW5ndGggPCAxMyAmJiB0Py50b1N0cmluZygpLmluY2x1ZGVzKCIpLiIpKSB9LAogICAgICAgIHNhZmVHZXRIZWxkSXRlbSh0KSB7IGxldCBlOyB0cnkgeyBlID0gdGhpcy5nZXRIZWxkSXRlbSh0KSB9IGNhdGNoIHt9IHJldHVybiBlIH0sCiAgICAgICAgZ2V0IHBsYXllckxpc3QoKSB7IHJldHVybiByLnZhbHVlcyhsLm5vYS5ibG94ZC5nZXRQbGF5ZXJJZHMoKSkuZmlsdGVyKHQgPT4gdCAhPT0gMSAmJiB0aGlzLnNhZmVHZXRIZWxkSXRlbSh0KSkubWFwKHQgPT4gcGFyc2VJbnQodCkpIH0sCiAgICAgICAgZ2V0IGRvQXR0YWNrKCkgeyBsZXQgdCA9IHRoaXMuc2FmZUdldEhlbGRJdGVtKDEpOyByZXR1cm4gKHQ/LmRvQXR0YWNrIHx8IHQuYnJlYWtpbmdJdGVtLmRvQXR0YWNrKS5iaW5kKHQpIH0sCiAgICAgICAgc2V0VmVsb2NpdHkodCA9IG51bGwsIGUgPSBudWxsLCBpID0gbnVsbCkgeyBsZXQgbyA9IHRoaXMuZ2V0UGh5c2ljc0JvZHkoMSksIHMgPSByLnZhbHVlcyhvKVsxNl07IHQgIT09IG51bGwgJiYgKHNbMF0gPSB0KSwgZSAhPT0gbnVsbCAmJiAoc1sxXSA9IGUpLCBpICE9PSBudWxsICYmIChzWzJdID0gaSkgfSwKICAgICAgICBpc0FsaXZlKHQpIHsgcmV0dXJuIHIudmFsdWVzKGwubm9hLmVudGl0aWVzKVszN10odCkuaXNBbGl2ZSB9LAogICAgICAgIHRvdWNoaW5nV2FsbCgpIHsgbGV0IHQgPSB0aGlzLmdldFBvc2l0aW9uKDEpLCBlID0gLjM1LCBpID0gWyBbMCwgMCwgMF0sIFtlLCAwLCAwXSwgWy1lLCAwLCAwXSwgWzAsIDAsIGVdLCBbMCwgMCwgLWVdLCBbZSwgMCwgZV0sIFtlLCAwLCAtZV0sIFstZSwgMCwgZV0sIFstZSwgMCwgLWVdIF0sIG8gPSBbMCwgMSwgMl07IGZvciAobGV0IFtzLCBjLCBkXSBvZiBpKSBmb3IgKGxldCB1IG9mIG8pIHsgbGV0IG0gPSBNYXRoLmZsb29yKHRbMF0gKyBzKSwgaCA9IE1hdGguZmxvb3IodFsxXSArIGMgKyB1KSwgRSA9IE1hdGguZmxvb3IodFsyXSArIGQpLCBNID0gdGhpcy5nZXRCbG9ja0lEKG0sIGgsIEUpOyBpZiAodGhpcy5nZXRCbG9ja1NvbGlkaXR5KE0pKSByZXR1cm4gITAgfSByZXR1cm4gITEgfQogICAgfTsKICAgIHZhciBuID0geyBub2E6IEksIG1vdXNlOiBEIH07CgogICAgdmFyIHIgPSB7IC8vV0FORwogICAgICAgIGtleXMoZSkgewogICAgICAgICAgICB2YXIgdCA9IFtdLAogICAgICAgICAgICAgICAgbyA9IDA7CiAgICAgICAgICAgIGZvciAodmFyIHMgaW4gZSkgZSAhPSBudWxsICYmICh0W29dID0gcywgbysrKTsKICAgICAgICAgICAgcmV0dXJuIHQKICAgICAgICB9LAogICAgICAgIHZhbHVlcyhlKSB7CiAgICAgICAgICAgIGZvciAodmFyIHQgPSB0aGlzLmtleXMoZSksIG8gPSBbXSwgcyA9IDAsIGkgPSAwOyBzIDwgdC5sZW5ndGg7KSB7CiAgICAgICAgICAgICAgICB2YXIgbCA9IHRbc10sCiAgICAgICAgICAgICAgICAgICAgZCA9IGVbbF07CiAgICAgICAgICAgICAgICBvW2ldID0gZCwgaSsrLCBzKysKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbwogICAgICAgIH0sCiAgICAgICAgYXNzaWduKGUsIC4uLnQpIHsKICAgICAgICAgICAgbGV0IG8gPSBPYmplY3QoZSk7CiAgICAgICAgICAgIGZvciAobGV0IHMgPSAwOyBzIDwgdC5sZW5ndGg7IHMrKykgewogICAgICAgICAgICAgICAgbGV0IGkgPSB0W3NdOwogICAgICAgICAgICAgICAgaWYgKGkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBsIGluIGkpIG9bbF0gPSBpW2xdCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG8KICAgICAgICB9CiAgICB9OwoKCgogICAgZnVuY3Rpb24gZmFkZVZvbHVtZShmcm9tLCB0bywgZHVyYXRpb24pIHsKICAgICAgICBjb25zdCBzdGVwcyA9IDMwOwogICAgICAgIGNvbnN0IHN0ZXBUaW1lID0gZHVyYXRpb24gLyBzdGVwczsKICAgICAgICBsZXQgY3VycmVudCA9IDA7CgogICAgICAgIGlmIChmYWRlVm9sdW1lSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoZmFkZVZvbHVtZUludGVydmFsKTsKCiAgICAgICAgZmFkZVZvbHVtZUludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICBjdXJyZW50Kys7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudCAvIHN0ZXBzOwogICAgICAgICAgICBzcGFjZVZpZC52b2x1bWUgPSBmcm9tICsgKHRvIC0gZnJvbSkgKiBwcm9ncmVzczsKCiAgICAgICAgICAgIGlmIChjdXJyZW50ID49IHN0ZXBzKSB7CiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGZhZGVWb2x1bWVJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBmYWRlVm9sdW1lSW50ZXJ2YWwgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfSwgc3RlcFRpbWUgKiAxMDAwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbktleURvd24oZSkgewogICAgICAgIGlmIChlLmNvZGUgPT09ICdTcGFjZScgJiYgIXNwYWNlSGVsZCkgewogICAgICAgICAgICBzcGFjZUhlbGQgPSB0cnVlOwogICAgICAgICAgICBzcGFjZVZpZC5zdHlsZS5vcGFjaXR5ID0gJzEnOwogICAgICAgICAgICBzcGFjZVZpZC5wbGF5KCk7CiAgICAgICAgICAgIGZhZGVWb2x1bWUoc3BhY2VWaWQudm9sdW1lLCAwLjEsIDIuNSk7IC8vIGZhZGUgaW4gdG8gMC44IG92ZXIgMiBzZWNvbmRzCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG9uS2V5VXAoZSkgewogICAgICAgIGlmIChlLmNvZGUgPT09ICdTcGFjZScpIHsKICAgICAgICAgICAgc3BhY2VIZWxkID0gZmFsc2U7CiAgICAgICAgICAgIHNwYWNlVmlkLnN0eWxlLm9wYWNpdHkgPSAnMCc7CiAgICAgICAgICAgIGZhZGVWb2x1bWUoc3BhY2VWaWQudm9sdW1lLCAwLjEsIDIuNSk7IC8vCiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFzcGFjZUhlbGQpIHNwYWNlVmlkLnBhdXNlKCk7CiAgICAgICAgICAgIH0sIDUwMCk7CiAgICAgICAgfQogICAgfQoKCiAgICBmdW5jdGlvbiBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKG1lc3NhZ2UsIGR1cmF0aW9uID0gMTUwMCkgewogICAgICAgIGNvbnN0IGRlZmF1bHRCYWNrR3JvdW5kQ29sb3IgPSAncmdiYSgwLCAwLCAwLCAwLjUpJzsgLy8gc2VtaS10cmFuc3BhcmVudCBibGFjawogICAgICAgIGNvbnN0IGRlZmF1bHRCYWNrR3JvdW5kQmx1ciA9IDk7CiAgICAgICAgY29uc3QgZGVmYXVsdEFjY2VudCA9ICIjRkYwMDAwIjsgLy8gSEVYIGFjY2VudCBjb2xvcgoKICAgICAgICAvLyBDcmVhdGUgYSBub3RpZmljYXRpb24gY29udGFpbmVyIGlmIGl0IGRvZXNuJ3QgZXhpc3QKICAgICAgICBsZXQgbm90aWZpY2F0aW9uQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25vdGlmaWNhdGlvbi1jb250YWluZXInKTsKICAgICAgICBpZiAoIW5vdGlmaWNhdGlvbkNvbnRhaW5lcikgewogICAgICAgICAgICBub3RpZmljYXRpb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgbm90aWZpY2F0aW9uQ29udGFpbmVyLmlkID0gJ25vdGlmaWNhdGlvbi1jb250YWluZXInOwogICAgICAgICAgICBub3RpZmljYXRpb25Db250YWluZXIuc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnOwogICAgICAgICAgICBub3RpZmljYXRpb25Db250YWluZXIuc3R5bGUuYm90dG9tID0gJzIwcHgnOwogICAgICAgICAgICBub3RpZmljYXRpb25Db250YWluZXIuc3R5bGUucmlnaHQgPSAnMjBweCc7CiAgICAgICAgICAgIG5vdGlmaWNhdGlvbkNvbnRhaW5lci5zdHlsZS56SW5kZXggPSAnMTMyJzsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub3RpZmljYXRpb25Db250YWluZXIpOwogICAgICAgIH0KCiAgICAgICAgLy8gQ3JlYXRlIG5vdGlmaWNhdGlvbiBlbGVtZW50CiAgICAgICAgY29uc3Qgbm90aWZpY2F0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgbm90aWZpY2F0aW9uLnRleHRDb250ZW50ID0gbWVzc2FnZTsKCiAgICAgICAgLy8gU3R5bGUgdGhlIG5vdGlmaWNhdGlvbgogICAgICAgIG5vdGlmaWNhdGlvbi5zdHlsZS5wYWRkaW5nID0gJzEycHgnOwogICAgICAgIG5vdGlmaWNhdGlvbi5zdHlsZS5jb2xvciA9ICcjZmZmJzsKICAgICAgICBub3RpZmljYXRpb24uc3R5bGUuYm9yZGVyUmFkaXVzID0gJzRweCc7CiAgICAgICAgbm90aWZpY2F0aW9uLnN0eWxlLmJveFNoYWRvdyA9ICcwIDRweCA4cHggcmdiYSgwLCAwLCAwLCAwLjIpJzsKICAgICAgICBub3RpZmljYXRpb24uc3R5bGUudHJhbnNpdGlvbiA9ICdvcGFjaXR5IDAuNXMgZWFzZS1pbi1vdXQsIHRyYW5zZm9ybSAwLjVzIGVhc2UtaW4tb3V0JzsKICAgICAgICBub3RpZmljYXRpb24uc3R5bGUub3BhY2l0eSA9ICcwJzsKICAgICAgICBub3RpZmljYXRpb24uc3R5bGUudHJhbnNmb3JtID0gJ3RyYW5zbGF0ZVkoMjBweCknOwogICAgICAgIG5vdGlmaWNhdGlvbi5zdHlsZS5tYXJnaW5Cb3R0b20gPSAnMTBweCc7CiAgICAgICAgbm90aWZpY2F0aW9uLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGRlZmF1bHRCYWNrR3JvdW5kQ29sb3I7CiAgICAgICAgbm90aWZpY2F0aW9uLnN0eWxlLmJhY2tkcm9wRmlsdGVyID0gYGJsdXIoJHtkZWZhdWx0QmFja0dyb3VuZEJsdXJ9cHgpYDsKCiAgICAgICAgLy8gQm9yZGVyIHVzaW5nIGFjY2VudCBjb2xvcgogICAgICAgIG5vdGlmaWNhdGlvbi5zdHlsZS5ib3JkZXIgPSBgMnB4IHNvbGlkICR7ZGVmYXVsdEFjY2VudH1gOwoKICAgICAgICAvLyBPcHRpb25hbDogZ2l2ZSBpdCBhIHNsaWdodCBncmFkaWVudCBpbm5lciBnbG93IChpZiB5b3Ugd2FudCBpdCBmYW5jaWVyKQogICAgICAgIC8vIG5vdGlmaWNhdGlvbi5zdHlsZS5ib3hTaGFkb3cgPSBgMCAwIDEycHggJHtkZWZhdWx0QWNjZW50fSwgMCA0cHggOHB4IHJnYmEoMCwwLDAsMC4yKWA7CgogICAgICAgIC8vIEFkZCB0byBjb250YWluZXIKICAgICAgICBub3RpZmljYXRpb25Db250YWluZXIuYXBwZW5kQ2hpbGQobm90aWZpY2F0aW9uKTsKCiAgICAgICAgLy8gVHJpZ2dlciB0aGUgZmFkZS1pbiBlZmZlY3QKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgbm90aWZpY2F0aW9uLnN0eWxlLm9wYWNpdHkgPSAnMSc7CiAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5zdHlsZS50cmFuc2Zvcm0gPSAndHJhbnNsYXRlWSgwKSc7CiAgICAgICAgfSwgMTApOwoKICAgICAgICAvLyBTZXQgdXAgdGhlIGZhZGUtb3V0IGFuZCByZW1vdmFsCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5zdHlsZS5vcGFjaXR5ID0gJzAnOwogICAgICAgICAgICAvLyBObyB0cmFuc2xhdGVZKC0yMHB4KSBiZWNhdXNlIHlvdSBkaXNsaWtlZCB0aGF0CgogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbi5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIGlmIChub3RpZmljYXRpb25Db250YWluZXIuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uQ29udGFpbmVyLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0sIGR1cmF0aW9uKTsKICAgIH0KCiAgICBmdW5jdGlvbiBjbGVhckVTUEJveGVzKCkgewogICAgICAgIGZvciAoY29uc3Qga2V5IGluIGNoZXN0Qm94ZXMpIHsKICAgICAgICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgICAgICAgICAgICAgbWVzaCwKICAgICAgICAgICAgICAgICAgICBpZAogICAgICAgICAgICAgICAgfSBvZiBjaGVzdEJveGVzW2tleV0pIHsKICAgICAgICAgICAgICAgIG1lc2guZGlzcG9zZSgpOwogICAgICAgICAgICAgICAgRnV4bnkuZW50aXRpZXMuZGVsZXRlRW50aXR5KGlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzY2FubmVkQ2h1bmtzLmNsZWFyKCk7CiAgICAgICAgY2hlc3RCb3hlcyA9IHt9OwogICAgfQoKICAgIGZ1bmN0aW9uIHJldmVyc2VJbmRleChpLCBzdHJpZGUpIHsKICAgICAgICBjb25zdCB4ID0gTWF0aC5mbG9vcihpIC8gc3RyaWRlWzBdKTsKICAgICAgICBjb25zdCByZW1YID0gaSAlIHN0cmlkZVswXTsKICAgICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcihyZW1YIC8gc3RyaWRlWzFdKTsKICAgICAgICBjb25zdCB6ID0gcmVtWCAlIHN0cmlkZVsxXTsKICAgICAgICByZXR1cm4gW3gsIHksIHpdOwogICAgfQoKICAgIGZ1bmN0aW9uIGdldENodW5rS2V5KGNodW5rKSB7CiAgICAgICAgY29uc3QgW3d4LCB3eSwgd3pdID0gY2h1bmsucG9zIHx8IFswLCAwLCAwXTsKICAgICAgICBjb25zdCBjeCA9IE1hdGguZmxvb3Iod3ggLyAzMik7CiAgICAgICAgY29uc3QgY3kgPSBNYXRoLmZsb29yKHd5IC8gMzIpOwogICAgICAgIGNvbnN0IGN6ID0gTWF0aC5mbG9vcih3eiAvIDMyKTsKICAgICAgICByZXR1cm4gYCR7Y3h9fCR7Y3l9fCR7Y3p9fG92ZXJ3b3JsZGA7CiAgICB9CgogICAgZnVuY3Rpb24gc2NhbkNodW5rKGNodW5rLCBibG9ja0lEcykgewogICAgICAgIGNvbnN0IGJsb2NrRGF0YSA9IGNodW5rW2NodW5rRGF0YUZpZWxkXTsKICAgICAgICBpZiAoIWJsb2NrRGF0YSkgcmV0dXJuOwoKICAgICAgICBjb25zdCB7CiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIHN0cmlkZQogICAgICAgIH0gPSBibG9ja0RhdGE7CgogICAgICAgIGNvbnN0IHBvcyA9IGNodW5rLnBvcyB8fCBbMCwgMCwgMF07CiAgICAgICAgaWYgKCFkYXRhIHx8ICFzdHJpZGUpIHJldHVybjsKCiAgICAgICAgY29uc3QgY2h1bmtLZXkgPSBnZXRDaHVua0tleShjaHVuayk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGJsb2NrSUQgPSBkYXRhW2ldOwogICAgICAgICAgICBpZiAoIWJsb2NrSURzLmluY2x1ZGVzKGJsb2NrSUQpKSBjb250aW51ZTsKCgoKCiAgICAgICAgICAgIGNvbnN0IFt4LCB5LCB6XSA9IHJldmVyc2VJbmRleChpLCBzdHJpZGUpOwogICAgICAgICAgICBjb25zdCB3b3JsZFggPSBwb3NbMF0gKyB4ICsgMC41OwogICAgICAgICAgICBjb25zdCB3b3JsZFkgPSBwb3NbMV0gKyB5ICsgMC41OwogICAgICAgICAgICBjb25zdCB3b3JsZFogPSBwb3NbMl0gKyB6ICsgMC41OwoKICAgICAgICAgICAgY29uc3QgbWVzaCA9IEZ1eG55Lkxpb24uTWVzaC5DcmVhdGVCb3goImVzcGJveCIsIDAuNSwgZmFsc2UsIDEsIEZ1eG55Lkxpb24uc2NlbmUpOwogICAgICAgICAgICBtZXNoLnBvc2l0aW9uLnNldCh3b3JsZFgsIHdvcmxkWSwgd29ybGRaKTsKICAgICAgICAgICAgbWVzaC5yZW5kZXJpbmdHcm91cElkID0gMTsKCiAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwgPSBuZXcgRnV4bnkuTGlvbi5TdGFuZGFyZE1hdGVyaWFsKCJtYXQiLCBGdXhueS5MaW9uLnNjZW5lKQoKICAgICAgICAgICAgY29uc3QgaWQgPSBGdXhueS5lbnRpdGllcy5hZGQoW3dvcmxkWCwgd29ybGRZLCB3b3JsZFpdLCBudWxsLCBudWxsLCBtZXNoKTsKICAgICAgICAgICAgaWYgKCFjaGVzdEJveGVzW2NodW5rS2V5XSkgY2hlc3RCb3hlc1tjaHVua0tleV0gPSBbXTsKICAgICAgICAgICAgY2hlc3RCb3hlc1tjaHVua0tleV0ucHVzaCh7CiAgICAgICAgICAgICAgICBtZXNoLAogICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgfSk7CgoKICAgICAgICAgICAgaWYgKFsyMDQsIDIwNSwgMjA2LCAyMDddLmluY2x1ZGVzKGJsb2NrSUQpKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRk9VTkRDSEVTVCIpCgogICAgICAgICAgICAgICAgbWVzaC5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBuZXcgRnV4bnkuTGlvbi5Db2xvcjMoMSwgMC41LCAwKTsgLy8gb3JhbmdlCiAgICAgICAgICAgICAgICBtZXNoLm1hdGVyaWFsLmVtaXNzaXZlQ29sb3IgPSBuZXcgRnV4bnkuTGlvbi5Db2xvcjMoMSwgMC41LCAwKTsgLy8gbWFrZXMgaXQgZ2xvdyBvcmFuZ2UKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoYmxvY2tJRCA9PT0gNDUpIHsKICAgICAgICAgICAgICAgIG1lc2gubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gbmV3IEZ1eG55Lkxpb24uQ29sb3IzKDAsIDAsIDEpOyAvLyBibHVlCiAgICAgICAgICAgICAgICBtZXNoLm1hdGVyaWFsLmVtaXNzaXZlQ29sb3IgPSBuZXcgRnV4bnkuTGlvbi5Db2xvcjMoMCwgMCwgMSk7IC8vIG1ha2VzIGl0IGdsb3cgYmx1ZQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYmxvY2tJRCA9PT0gNDY1KSB7CiAgICAgICAgICAgICAgICBtZXNoLm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IG5ldyBGdXhueS5MaW9uLkNvbG9yMygwLjcsIDAuNSwgMSk7IC8vIHBhbGUgcHVycGxlCiAgICAgICAgICAgICAgICBtZXNoLm1hdGVyaWFsLmVtaXNzaXZlQ29sb3IgPSBuZXcgRnV4bnkuTGlvbi5Db2xvcjMoMC43LCAwLjUsIDEpOyAvLyBtYWtlcyBpdCBnbG93IHBhbGUgcHVycGxlCiAgICAgICAgICAgIH0KCgoKCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNjYW5BbGxDaHVua3MoKSB7CiAgICAgICAgaWYgKCFGdXhueT8ud29ybGQgfHwgIUZ1eG55Py53b3JsZD8uW0Z1eG55LmltcEtleV0/Lmhhc2gpIHJldHVybjsKICAgICAgICBjb25zdCBjaHVua0hhc2ggPSBGdXhueS53b3JsZFtGdXhueS5pbXBLZXldLmhhc2g7CiAgICAgICAgLy8gU3RlcCAxOiBSZW1vdmUgYm94ZXMgZm9yIGNodW5rcyBubyBsb25nZXIgbG9hZGVkCiAgICAgICAgZm9yIChjb25zdCBzY2FubmVkS2V5IG9mIHNjYW5uZWRDaHVua3MpIHsKICAgICAgICAgICAgaWYgKCEoc2Nhbm5lZEtleSBpbiBjaGVzdEJveGVzKSkgY29udGludWU7CgogICAgICAgICAgICBpZiAoIU9iamVjdC52YWx1ZXMoY2h1bmtIYXNoKS5zb21lKGNodW5rID0+IGdldENodW5rS2V5KGNodW5rKSA9PT0gc2Nhbm5lZEtleSkpIHsKICAgICAgICAgICAgICAgIC8vIERlbGV0ZSBhbGwgbWVzaGVzIGZvciB0aGlzIGNodW5rCiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWVzaCwKICAgICAgICAgICAgICAgICAgICAgICAgaWQKICAgICAgICAgICAgICAgICAgICB9IG9mIGNoZXN0Qm94ZXNbc2Nhbm5lZEtleV0pIHsKICAgICAgICAgICAgICAgICAgICBtZXNoLmRpc3Bvc2UoKTsgLy8gcmVtb3ZlIGZyb20gc2NlbmUKICAgICAgICAgICAgICAgICAgICBGdXhueS5lbnRpdGllcy5kZWxldGVFbnRpdHkoaWQpOyAvLyByZW1vdmUgZnJvbSBlbnRpdHkgc3lzdGVtIGlmIG5lZWRlZAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVsZXRlIGNoZXN0Qm94ZXNbc2Nhbm5lZEtleV07CiAgICAgICAgICAgICAgICBzY2FubmVkQ2h1bmtzLmRlbGV0ZShzY2FubmVkS2V5KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gU3RlcCAyOiBTY2FuIG5ld2x5IGxvYWRlZCBjaHVua3MKICAgICAgICBmb3IgKGNvbnN0IGNodW5rS2V5IGluIGNodW5rSGFzaCkgewoKICAgICAgICAgICAgY29uc3QgY2h1bmsgPSBjaHVua0hhc2hbY2h1bmtLZXldOwogICAgICAgICAgICBpZiAoIWNodW5rRGF0YUZpZWxkKSB7CiAgICAgICAgICAgICAgICBhdXRvRGV0ZWN0Q2h1bmtEYXRhRmllbGQoY2h1bmspOwogICAgICAgICAgICAgICAgaWYgKCFjaHVua0RhdGFGaWVsZCkgY29udGludWU7IC8vIFNraXAgaWYgc3RpbGwgbm90IGZvdW5kCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnN0IGJsb2NrRGF0YSA9IGNodW5rW2NodW5rRGF0YUZpZWxkXTsKICAgICAgICAgICAgaWYgKCFibG9ja0RhdGE/LmRhdGEgfHwgIWJsb2NrRGF0YS5zdHJpZGUgfHwgIWNodW5rLnBvcykgY29udGludWU7CgoKICAgICAgICAgICAgY29uc3Qga2V5ID0gZ2V0Q2h1bmtLZXkoY2h1bmspOwogICAgICAgICAgICBpZiAoc2Nhbm5lZENodW5rcy5oYXMoa2V5KSkgY29udGludWU7CiAgICAgICAgICAgIHNjYW5uZWRDaHVua3MuYWRkKGtleSk7CiAgICAgICAgICAgIGlmIChjaGVzdEVTUEVuYWJsZWQpIHNjYW5DaHVuayhjaHVuaywgWzIwNCwgMjA1LCAyMDYsIDIwN10pOwogICAgICAgICAgICBpZiAob3JlRVNQRW5hYmxlZCkgc2NhbkNodW5rKGNodW5rLCBbNDQsIDQ1LCA0NjUsIDUwXSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0b3BNb3ZpbmcoKSB7CiAgICAgICAgaWYgKG1vdmVJbnRlcnZhbCkgewogICAgICAgICAgICBjbGVhckludGVydmFsKG1vdmVJbnRlcnZhbCk7CiAgICAgICAgICAgIG1vdmVJbnRlcnZhbCA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHN0YXJ0TW92aW5nKCkgewogICAgICAgIGlmIChtb3ZlSW50ZXJ2YWwpIHJldHVybjsgLy8gQWxyZWFkeSBtb3ZpbmcKCiAgICAgICAgbW92ZUludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICBsZXQgcG9zID0gRnV4bnkuZW50aXRpZXMuZ2V0U3RhdGUoMSwgJ3Bvc2l0aW9uJykucG9zaXRpb247CiAgICAgICAgICAgIGxldCBoID0gRnV4bnkuY2FtZXJhLmhlYWRpbmc7CiAgICAgICAgICAgIGxldCBwID0gRnV4bnkuY2FtZXJhLnBpdGNoOwoKICAgICAgICAgICAgbGV0IG5ld1ggPSBwb3NbMF07CiAgICAgICAgICAgIGxldCBuZXdZID0gcG9zWzFdOwogICAgICAgICAgICBsZXQgbmV3WiA9IHBvc1syXTsKCiAgICAgICAgICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CgogICAgICAgICAgICBpZiAocCA8IC0xKSB7CiAgICAgICAgICAgICAgICAvLyBMb29raW5nIHVwOiBtb3ZlIHVwIG9ubHkgaWYgNTAwbXMgaGF2ZSBwYXNzZWQKICAgICAgICAgICAgICAgIGlmIChub3cgLSBsYXN0VXBUaW1lID49IDUwMCkgewogICAgICAgICAgICAgICAgICAgIG5ld1kgKz0gZGlzdGFuY2UgKyAwLjk7CiAgICAgICAgICAgICAgICAgICAgbGFzdFVwVGltZSA9IG5vdzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChwID4gMSkgewogICAgICAgICAgICAgICAgLy8gTG9va2luZyBkb3duOiBtb3ZlIGRvd24KICAgICAgICAgICAgICAgIG5ld1kgLT0gZGlzdGFuY2U7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBNb3ZlIGZvcndhcmQgaG9yaXpvbnRhbGx5CiAgICAgICAgICAgICAgICBuZXdYICs9IE1hdGguc2luKGgpICogZGlzdGFuY2U7CiAgICAgICAgICAgICAgICBuZXdaICs9IE1hdGguY29zKGgpICogZGlzdGFuY2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEZ1eG55LmVudGl0aWVzLnNldFBvc2l0aW9uKDEsIG5ld1gsIG5ld1ksIG5ld1opOwogICAgICAgIH0sIDIwKTsKICAgIH0KCiAgICBmdW5jdGlvbiBkdW1wQWxsRnVuY3Rpb25zKG9iaiwgaW5jbHVkZVByb3RvdHlwZSA9IGZhbHNlKSB7CiAgICAgICAgY29uc3Qgc2VlbiA9IG5ldyBTZXQoKTsKICAgICAgICBsZXQgY3VycmVudCA9IG9iajsKICAgICAgICBsZXQgaW5kZXggPSAxOwoKICAgICAgICBjb25zb2xlLmdyb3VwKGDwn5OmIEZ1bmN0aW9uIER1bXBgKTsKCiAgICAgICAgZG8gewogICAgICAgICAgICBjb25zdCBwcm9wcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGN1cnJlbnQpOwogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBwcm9wcykgewogICAgICAgICAgICAgICAgaWYgKHNlZW4uaGFzKGtleSkpIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgc2Vlbi5hZGQoa2V5KTsKCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IG9ialtrZXldOwogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoYPCflLkgWyR7aW5kZXgrK31dICR7a2V5fSgpYCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHZhbC50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyBDb3VsZCBub3QgYWNjZXNzIGZ1bmN0aW9uICcke2tleX0nOmAsIGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdXJyZW50ID0gaW5jbHVkZVByb3RvdHlwZSA/IE9iamVjdC5nZXRQcm90b3R5cGVPZihjdXJyZW50KSA6IG51bGw7CgogICAgICAgIH0gd2hpbGUgKGN1cnJlbnQgJiYgY3VycmVudCAhPT0gT2JqZWN0LnByb3RvdHlwZSk7CgogICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWFyY2hGb3JUZXJtKG9iaiwgdGVybSkgewogICAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTsKICAgICAgICBjb25zdCB2aXNpdGVkID0gbmV3IFdlYWtTZXQoKTsKCiAgICAgICAgZnVuY3Rpb24gcmVjdXJzZShjdXJyZW50LCBwYXRoID0gW10pIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50ICE9PSAnb2JqZWN0JyB8fCBjdXJyZW50ID09PSBudWxsKSByZXR1cm47CgogICAgICAgICAgICBpZiAodmlzaXRlZC5oYXMoY3VycmVudCkpIHJldHVybjsKICAgICAgICAgICAgdmlzaXRlZC5hZGQoY3VycmVudCk7CgogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBjdXJyZW50KSB7CiAgICAgICAgICAgICAgICBpZiAoIU9iamVjdC5oYXNPd24oY3VycmVudCwga2V5KSkgY29udGludWU7CgogICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBjdXJyZW50W2tleV07CiAgICAgICAgICAgICAgICBjb25zdCBrZXlNYXRjaCA9IGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0udG9Mb3dlckNhc2UoKSk7CiAgICAgICAgICAgICAgICBjb25zdCB2YWxNYXRjaCA9ICgKICAgICAgICAgICAgICAgICAgICB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnIHx8CiAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyB8fAogICAgICAgICAgICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nCiAgICAgICAgICAgICAgICApICYmIFN0cmluZyh2YWx1ZSkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh0ZXJtLnRvTG93ZXJDYXNlKCkpOwoKICAgICAgICAgICAgICAgIGlmIChrZXlNYXRjaCB8fCB2YWxNYXRjaCkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IFsuLi5wYXRoLCBrZXldLmpvaW4oJy4nKSwKICAgICAgICAgICAgICAgICAgICAgICAga2V5OiBrZXksCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmVjdXJzZSh2YWx1ZSwgWy4uLnBhdGgsIGtleV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZWN1cnNlKG9iaik7CiAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICB9CgogICAgZnVuY3Rpb24gbWF0Y2hlc0FsbFBhdHRlcm5zKGZuKSB7CiAgICAgICAgY29uc3QgcGF0dGVybnMgPSBbInRoaXMubmFtZXMucG9zaXRpb24iLCAiLmJhc2VbMF0iXS5tYXAocCA9PiBwLnJlcGxhY2UoL1xzKy9nLCAnJykpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IHNyYyA9IGZuLnRvU3RyaW5nKCkucmVwbGFjZSgvXHMrL2csICcnKTsKICAgICAgICAgICAgcmV0dXJuIHBhdHRlcm5zLmV2ZXJ5KHAgPT4gc3JjLmluY2x1ZGVzKHApKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBmaW5kQ2xhc3NDb25zdHJ1Y3RvcihvYmopIHsKICAgICAgICBsZXQgY3VycmVudCA9IG9iajsKICAgICAgICB3aGlsZSAoY3VycmVudCkgewogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBSZWZsZWN0Lm93bktleXMoY3VycmVudCkpIHsKICAgICAgICAgICAgICAgIGxldCB2YWw7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGN1cnJlbnQsIGtleSk7CiAgICAgICAgICAgICAgICAgICAgdmFsID0gZGVzYz8udmFsdWUgPz8gY3VycmVudFtrZXldOwogICAgICAgICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gImZ1bmN0aW9uIiAmJiBtYXRjaGVzQWxsUGF0dGVybnModmFsKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3VycmVudCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihjdXJyZW50KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgZnVuY3Rpb24gZmluZEdoTWV0aG9kKGNsc0NvbnN0cnVjdG9yKSB7CiAgICAgICAgY29uc3QgcHJvdG9Mb2NhbCA9IGNsc0NvbnN0cnVjdG9yPy5wcm90b3R5cGU7CiAgICAgICAgaWYgKCFwcm90b0xvY2FsKSByZXR1cm4gbnVsbDsKCiAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgUmVmbGVjdC5vd25LZXlzKHByb3RvTG9jYWwpKSB7CiAgICAgICAgICAgIGlmIChrZXkgPT09ICJjb25zdHJ1Y3RvciIpIGNvbnRpbnVlOwogICAgICAgICAgICBjb25zdCBmbiA9IHByb3RvTG9jYWxba2V5XTsKICAgICAgICAgICAgaWYgKHR5cGVvZiBmbiA9PT0gImZ1bmN0aW9uIiAmJiBtYXRjaGVzQWxsUGF0dGVybnMoZm4pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICAgIGZuLAogICAgICAgICAgICAgICAgICAgIGtleQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBjb25zdCB0b2dnbGVCbGluayA9IChpbnRlcnZhbCA9IDAsIG5vUGFja2V0ID0gZmFsc2UpID0+IHsKICAgICAgICBibGlua1N0YXRlLmVuYWJsZWQgPSAhYmxpbmtTdGF0ZS5lbmFibGVkOwogICAgICAgIGJsaW5rU3RhdGUuaW50ZXJ2YWwgPSBpbnRlcnZhbDsKICAgICAgICBibGlua1N0YXRlLm5vUGFja2V0ID0gbm9QYWNrZXQ7CgogICAgICAgIGlmIChibGlua1N0YXRlLmVuYWJsZWQpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFtCbGlua10gRU5BQkxFRCDigJQgaW50ZXJ2YWw6ICR7aW50ZXJ2YWx9LCBub1BhY2tldDogJHtub1BhY2tldH1gKTsKCiAgICAgICAgICAgIGNvbHlSb29tW3NlbmRCeXRlc05hbWVdID0gKC4uLmFyZ3MpID0+IHsKCiAgICAgICAgICAgICAgICBjb25zdCBbSiwgVF0gPSBhcmdzOwogICAgICAgICAgICAgICAgY29uc3Qgc2VuZCA9ICgpID0+IGJsaW5rU3RhdGUub3JpZ2luYWxTZW5kQnl0ZXMuY2FsbChjb2x5Um9vbSwgSiwgVCk7CgogICAgICAgICAgICAgICAgaWYgKGludGVydmFsID4gMCkgewogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoc2VuZCwgaW50ZXJ2YWwpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBibGlua1N0YXRlLnF1ZXVlZC5wdXNoKFtKLCBUXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYFtCbGlua10gRElTQUJMRUQg4oCUIHNlbmRpbmcgJHtibGlua1N0YXRlLnF1ZXVlZC5sZW5ndGh9IHBhY2tldHMuYCk7CgogICAgICAgICAgICBmb3IgKGNvbnN0IFtKLCBUXSBvZiBibGlua1N0YXRlLnF1ZXVlZCkgewogICAgICAgICAgICAgICAgYmxpbmtTdGF0ZS5vcmlnaW5hbFNlbmRCeXRlcy5jYWxsKGNvbHlSb29tLCBKLCBUKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29seVJvb21bc2VuZEJ5dGVzTmFtZV0gPSBibGlua1N0YXRlLm9yaWdpbmFsU2VuZEJ5dGVzOwogICAgICAgICAgICBibGlua1N0YXRlLnF1ZXVlZCA9IFtdOwogICAgICAgIH0KICAgIH07CgogICAgZnVuY3Rpb24gd2FuZ1BsYWNlKHBvc2l0aW9uKSB7CgogICAgICAgIGxldCBoZWxkQmxvY2sgPSByLnZhbHVlcyhGdXhueS5ub2EuZW50aXRpZXNbRnV4bnkuaW1wS2V5XSlbMjJdLmxpc3RbMF0uX2Jsb2NrSXRlbTsKICAgICAgICBsZXQgd29ybGRJbnN0YW5jZUtleSA9IE9iamVjdC5rZXlzKGhlbGRCbG9jaylbMF07CiAgICAgICAgbGV0IHdvcmxkSW5zdGFuY2UgPSBPYmplY3QudmFsdWVzKGhlbGRCbG9jaylbMF07CiAgICAgICAgbGV0IHRhcmdldGVkQmxvY2tLZXkgPSBPYmplY3Qua2V5cyh3b3JsZEluc3RhbmNlKVsyNV07CiAgICAgICAgbGV0IHRhcmdldGVkQmxvY2sgPSB3b3JsZEluc3RhbmNlW3RhcmdldGVkQmxvY2tLZXldOwoKICAgICAgICBmdW5jdGlvbiBzcG9vZlRhcmdldGVkQmxvY2socG9zaXRpb24pIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh7fSwgewogICAgICAgICAgICAgICAgZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocHJvcCA9PT0gd29ybGRJbnN0YW5jZUtleSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFByb3h5KHdvcmxkSW5zdGFuY2UsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldChpbm5lciwga2V5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gdGFyZ2V0ZWRCbG9ja0tleSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3Bvb2ZlZFRhcmdldGVkQmxvY2sgPSBzdHJ1Y3R1cmVkQ2xvbmUodGFyZ2V0ZWRCbG9jaykgfHwge307CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwb29mZWRUYXJnZXRlZEJsb2NrLnBvc2l0aW9uID0gcG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzcG9vZmVkVGFyZ2V0ZWRCbG9jazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdvcmxkSW5zdGFuY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3AgPT0gImNoZWNrVGFyZ2V0ZWRCbG9ja0NhbkJlUGxhY2VkT3ZlciIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGhlbGRCbG9ja1twcm9wXSA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoZWxkQmxvY2tbcHJvcF0uYmluZChoZWxkQmxvY2spOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBoZWxkQmxvY2tbcHJvcF07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBoZWxkQmxvY2sucGxhY2VCbG9jay5jYWxsKHNwb29mVGFyZ2V0ZWRCbG9jayhwb3NpdGlvbikpOwogICAgfQoKICAgIGZ1bmN0aW9uIHBsYWNlVG9QbGF5ZXIocG9zaXRpb24pIHsKCiAgICAgICAgLy8gQ29udmVydCB0byBibG9jayBjb29yZGluYXRlcyBieSBmbG9vcmluZyBlYWNoIGNvbXBvbmVudAogICAgICAgIGNvbnN0IGJsb2NrWCA9IE1hdGguZmxvb3IocG9zaXRpb25bMF0pOwogICAgICAgIGNvbnN0IGJsb2NrWSA9IE1hdGguZmxvb3IocG9zaXRpb25bMV0pOwogICAgICAgIGNvbnN0IGJsb2NrWiA9IE1hdGguZmxvb3IocG9zaXRpb25bMl0pOwogICAgICAgIGlmIChwbGF5ZXJFbnRpdHkuY2hlY2tUYXJnZXRlZEJsb2NrQ2FuQmVQbGFjZWRPdmVyKFtibG9ja1gsIGJsb2NrWSAtIDMsIGJsb2NrWl0pIHx8IHIudmFsdWVzKEZ1eG55LndvcmxkKVs0N10uY2FsbChGdXhueS53b3JsZCwgYmxvY2tYLCBibG9ja1kgLSAzLCBibG9ja1opID09PSAwKSB7CiAgICAgICAgICAgIHdhbmdQbGFjZShbYmxvY2tYLCBibG9ja1kgLSAzLCBibG9ja1pdKQogICAgICAgIH0KICAgICAgICBpZiAocGxheWVyRW50aXR5LmNoZWNrVGFyZ2V0ZWRCbG9ja0NhbkJlUGxhY2VkT3ZlcihbYmxvY2tYLCBibG9ja1kgLSAyLCBibG9ja1pdKSB8fCByLnZhbHVlcyhGdXhueS53b3JsZClbNDddLmNhbGwoRnV4bnkud29ybGQsIGJsb2NrWCwgYmxvY2tZIC0gMiwgYmxvY2taKSA9PT0gMCkgewogICAgICAgICAgICB3YW5nUGxhY2UoW2Jsb2NrWCwgYmxvY2tZIC0gMiwgYmxvY2taXSkKICAgICAgICB9CiAgICAgICAgaWYgKHBsYXllckVudGl0eS5jaGVja1RhcmdldGVkQmxvY2tDYW5CZVBsYWNlZE92ZXIoW2Jsb2NrWCwgYmxvY2tZIC0gMSwgYmxvY2taXSkgfHwgci52YWx1ZXMoRnV4bnkud29ybGQpWzQ3XS5jYWxsKEZ1eG55LndvcmxkLCBibG9ja1gsIGJsb2NrWSAtIDEsIGJsb2NrWikgPT09IDApIHsKICAgICAgICAgICAgd2FuZ1BsYWNlKFtibG9ja1gsIGJsb2NrWSAtIDEsIGJsb2NrWl0pCiAgICAgICAgfQogICAgICAgIGlmIChwbGF5ZXJFbnRpdHkuY2hlY2tUYXJnZXRlZEJsb2NrQ2FuQmVQbGFjZWRPdmVyKFtibG9ja1gsIGJsb2NrWSwgYmxvY2taXSkgfHwgci52YWx1ZXMoRnV4bnkud29ybGQpWzQ3XS5jYWxsKEZ1eG55LndvcmxkLCBibG9ja1gsIGJsb2NrWSwgYmxvY2taKSA9PT0gMCkgewogICAgICAgICAgICB3YW5nUGxhY2UoW2Jsb2NrWCwgYmxvY2tZLCBibG9ja1pdKQogICAgICAgIH0KCiAgICB9CgogICAgZnVuY3Rpb24gcGxhY2VTcGlrZShwb3NpdGlvbikgewoKICAgICAgICAvLyBDb252ZXJ0IHRvIGJsb2NrIGNvb3JkaW5hdGVzIGJ5IGZsb29yaW5nIGVhY2ggY29tcG9uZW50CiAgICAgICAgY29uc3QgYmxvY2tYID0gTWF0aC5mbG9vcihwb3NpdGlvblswXSk7CiAgICAgICAgY29uc3QgYmxvY2tZID0gTWF0aC5mbG9vcihwb3NpdGlvblsxXSk7CiAgICAgICAgY29uc3QgYmxvY2taID0gTWF0aC5mbG9vcihwb3NpdGlvblsyXSk7CiAgICAgICAgaWYgKHBsYXllckVudGl0eS5jaGVja1RhcmdldGVkQmxvY2tDYW5CZVBsYWNlZE92ZXIoW2Jsb2NrWCwgYmxvY2tZICsgMSwgYmxvY2taXSkgfHwgci52YWx1ZXMoRnV4bnkud29ybGQpWzQ3XS5jYWxsKEZ1eG55LndvcmxkLCBibG9ja1gsIGJsb2NrWSArIDEsIGJsb2NrWikgPT09IDApIHsKICAgICAgICAgICAgd2FuZ1BsYWNlKFtibG9ja1gsIGJsb2NrWSArIDEsIGJsb2NrWl0pCiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIG1vdmVJdGVtKGl0ZW1OYW1lLCBkZXNpcmVkU2xvdCkgewogICAgICAgIGlmICghcGxheWVySW52ZW50b3J5UGFyZW50IHx8ICFwbGF5ZXJJbnZlbnRvcnlQYXJlbnQucGxheWVySW52ZW50b3J5Py5pdGVtcykgewogICAgICAgICAgICBjb25zb2xlLndhcm4oIuKdjCBwbGF5ZXJJbnZlbnRvcnlQYXJlbnQgaXMgbm90IHNldC4gUnVuIGZpbmRBbmRTYXZlUGxheWVySW52ZW50b3J5UGFyZW50KCkgZmlyc3QuIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaXRlbXMgPSBwbGF5ZXJJbnZlbnRvcnlQYXJlbnQucGxheWVySW52ZW50b3J5Lml0ZW1zOwogICAgICAgIGxldCBvbGRTbG90ID0gbnVsbDsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBpdGVtc1tpXTsKCiAgICAgICAgICAgIGlmICghaXRlbSB8fCB0eXBlb2YgaXRlbS5uYW1lICE9PSAnc3RyaW5nJykgY29udGludWU7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSBpdGVtLm5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgaWYgKG5hbWUuaW5jbHVkZXMoaXRlbU5hbWUpKSB7CgoKICAgICAgICAgICAgICAgIG9sZFNsb3QgPSBpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG9sZFNsb3QgPT09IG51bGwpIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKGDinYwgTm8gJHtpdGVtTmFtZX0gZm91bmQgaW4gc2xvdCAxMCBvciBoaWdoZXIuYCk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgY29uc29sZS5sb2coYPCflIEgU3dhcHBpbmcgJHtpdGVtTmFtZX0gZnJvbSBzbG90ICR7b2xkU2xvdH0gd2l0aCBzbG90ICR7ZGVzaXJlZFNsb3R9YCk7CiAgICAgICAgcGxheWVySW52ZW50b3J5UGFyZW50LnN3YXBQb3NDbGllbnQob2xkU2xvdCwgZGVzaXJlZFNsb3QsIG51bGwpOwogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIHNsZWVwKG1zKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpOwogICAgfQoKICAgIGZ1bmN0aW9uIGJ1bm55SG9wKCkgewogICAgICAgIGlmICghcGh5c1N0YXRlLmlzT25Hcm91bmQ/LigpIHx8IG1vdmVTdGF0ZS5jcm91Y2hpbmcgfHwgbW92ZVN0YXRlLnNwZWVkIDwgMC4wNSkgcmV0dXJuOwogICAgICAgIG1vdmVTdGF0ZS5qdW1waW5nID0gdHJ1ZTsKICAgICAgICBwaHlzU3RhdGUuX2hhZEp1bXBJbnB1dFByZXZUaWNrID0gZmFsc2U7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIG1vdmVTdGF0ZS5qdW1waW5nID0gZmFsc2U7CiAgICAgICAgfSwgMjApOwogICAgfQoKICAgIGZ1bmN0aW9uIHdhaXRGb3JFbGVtZW50KHNlbGVjdG9yLCBjYWxsYmFjaykgewogICAgICAgIGlmIChhbHJlYWR5Q29ubmVjdGVkKSB7CiAgICAgICAgICAgIGluamVjdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICBpbmplY3RCdXR0b24udGV4dENvbnRlbnQgPSAiQ2xpY2sgaWYgZ2FtZSBsb2FkZWQuIgogICAgICAgICAgICBzdGFydFdlYlNvY2tldFdhdGNoZXIoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHsKICAgICAgICAgICAgZm9yIChjb25zdCBtdXRhdGlvbiBvZiBtdXRhdGlvbnMpIHsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBtdXRhdGlvbi5hZGRlZE5vZGVzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEgJiYgbm9kZS5tYXRjaGVzKHNlbGVjdG9yKSkgewogICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5kaXNjb25uZWN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5vZGUpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIG9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuYm9keSwgewogICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsCiAgICAgICAgICAgIHN1YnRyZWU6IHRydWUKICAgICAgICB9KTsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBhdXRvU1coKSB7CiAgICAgICAgaWYgKGxhc3RDbG9zZXN0SWQgJiYgdGFyZ2V0RW50aXR5RGlzdGFuY2UgPD0gMzYpIHsgLy8gcGxhY2Ugd2ViIHRoZW4gc3Bpa2VzCgogICAgICAgICAgICBpZiAobW92ZUl0ZW0oIm5ldCIsIHdlYlNsb3QpIHx8IG1vdmVJdGVtKCJ3ZWIiLCB3ZWJTbG90KSkgewogICAgICAgICAgICAgICAgbGV0IGVuZW15UG9zID0gRnV4bnkuZW50aXRpZXMuZ2V0U3RhdGUobGFzdENsb3Nlc3RJZCwgJ3Bvc2l0aW9uJykucG9zaXRpb247CgogICAgICAgICAgICAgICAgRnV4bnkubm9hLmlucHV0cy5kb3duWydfZXZlbnRzJ11bYEhvdEJhclNsb3Qke3dlYlNsb3QgKyAxfWBdKCk7CgogICAgICAgICAgICAgICAgcGxhY2VUb1BsYXllcihlbmVteVBvcyk7CgogICAgICAgICAgICAgICAgYXdhaXQgc2xlZXAoNTApOyAvLyBkZWxheSBiZWZvcmUgc3dpdGNoaW5nIHRvIHNwaWtlcwoKICAgICAgICAgICAgICAgIGlmIChtb3ZlSXRlbSgic3Bpa2VzIiwgc3Bpa2VTbG90KSkgewogICAgICAgICAgICAgICAgICAgIEZ1eG55Lm5vYS5pbnB1dHMuZG93blsnX2V2ZW50cyddW2BIb3RCYXJTbG90JHtzcGlrZVNsb3QgKyAxfWBdKCk7CiAgICAgICAgICAgICAgICAgICAgcGxhY2VTcGlrZShlbmVteVBvcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7IC8vIGp1c3QgcGxhY2Ugc3Bpa2VzCiAgICAgICAgICAgICAgICBpZiAobW92ZUl0ZW0oInNwaWtlcyIsIHNwaWtlU2xvdCkpIHsKICAgICAgICAgICAgICAgICAgICBGdXhueS5ub2EuaW5wdXRzLmRvd25bJ19ldmVudHMnXVtgSG90QmFyU2xvdCR7c3Bpa2VTbG90ICsgMX1gXSgpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNsZWVwKDUwKTsKCiAgICAgICAgICAgICAgICAgICAgbGV0IGVuZW15UG9zID0gRnV4bnkuZW50aXRpZXMuZ2V0U3RhdGUobGFzdENsb3Nlc3RJZCwgJ3Bvc2l0aW9uJykucG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgcGxhY2VUb1BsYXllcihlbmVteVBvcyk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJubyBzcGlrZXMgb3Igd2VicyEiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBGdXhueS5ub2EuaW5wdXRzLmRvd25bJ19ldmVudHMnXS5Ib3RCYXJTbG90MSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJObyB0YXJnZXQgb3IgdG9vIGZhciIpOwogICAgICAgIH0KICAgICAgICBpZiAoIWV2ZXJFbmFibGVkLmF1dG9TV1VzZWQpIHsKICAgICAgICAgICAgZXZlckVuYWJsZWQuYXV0b1NXVXNlZCA9IHRydWUKICAgICAgICB9OwogICAgfQoKZnVuY3Rpb24gdHJpZ2dlclhQRHVwZXIoKSB7CiAgICBpZiAoIWluamVjdGVkQm9vbCkgewogICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIuKdjCBJbmplY3QgZmlyc3QhIik7CiAgICAgICAgcmV0dXJuOwogICAgfQogICAgdHJ5IHsKICAgICAgICBjb25zdCBzZW5kUGFja2V0TW9kdWxlID0gRnV4bnkuZmluZE1vZHVsZSgicHVzaCh7bWVzc2FnZSIpOwogICAgICAgIGNvbnN0IHNlbmRQYWNrZXQgPSBPYmplY3QudmFsdWVzKHNlbmRQYWNrZXRNb2R1bGUpLmZpbmQoZm4gPT4gZm4/LnRvU3RyaW5nKCkuaW5jbHVkZXMoIndpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiKSk7CgogICAgICAgIGlmICghc2VuZFBhY2tldCkgewogICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCLinYwgQ291bGQgbm90IGZpbmQgc2VuZFBhY2tldCBmdW5jdGlvbi4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgaW52ZW50b3J5ID0gRnV4bnkubm9hLmVudGl0aWVzLmdldFN0YXRlKDEsICJpbnZlbnRvcnkiKS5pbnZlbnRvcnk7CiAgICAgICAgaWYgKCFpbnZlbnRvcnkpIHsKICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigi4p2MIENvdWxkIG5vdCBmaW5kIGludmVudG9yeS4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc2VuZFBhY2tldCgyMCwgewogICAgICAgICAgICAienkiOiBpbnZlbnRvcnkuX3NlbGVjdGVkU2xvdEksCiAgICAgICAgICAgICJ4eSI6IDAKICAgICAgICB9KTsKCiAgICAgICAgaW52ZW50b3J5LnBpY2tVcEl0ZW0oewogICAgICAgICAgICAibmFtZSI6ICJBdXJhIFhQIEZyYWdtZW50IiwKICAgICAgICAgICAgInR5cGVPYmoiOiAgRnV4bnkubm9hLmJsb3hkLmdldEl0ZW1UeXBlT2JqKCJBdXJhIFhQIEZyYWdtZW50IiksCiAgICAgICAgICAgICJhbW91bnQiOiA0LAogICAgICAgICAgICAiYXR0cmlidXRlcyI6IHt9CiAgICAgICAgfSk7CgogICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIuKcqCBYUCBEdXBlciB0cmlnZ2VyZWQhIik7CgogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJbWFBEdXBlcl0gRXJyb3I6IiwgZXJyb3IpOwogICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIuKdjCBYUCBEdXBlciBmYWlsZWQuIFNlZSBjb25zb2xlLiIpOwogICAgfQp9CgogICAgZnVuY3Rpb24gbWFrZUhpdGJveGVzKCkgewogICAgICAgIGlmICghaW5qZWN0ZWRCb29sIHx8ICFGdXhueS5yZW5kZXJpbmcpIHJldHVybjsKCiAgICAgICAgY29uc3QgcmVuZGVyaW5nID0gci52YWx1ZXMoRnV4bnkucmVuZGVyaW5nKVsxOF07CiAgICAgICAgaWYgKCFyZW5kZXJpbmcpIHJldHVybjsKCiAgICAgICAgY29uc3QgcGxheWVySWRzID0gbi5ub2EucGxheWVyTGlzdDsKICAgICAgICBpZiAoIXBsYXllcklkcykgcmV0dXJuOwoKICAgICAgICBjb25zdCBhY3RpdmVFSWRzID0gbmV3IFNldChwbGF5ZXJJZHMpOwoKICAgICAgICAvLyBDcmVhdGUgaGl0Ym94ZXMgZm9yIG5ldyBwbGF5ZXJzCiAgICAgICAgZm9yIChjb25zdCBwbGF5ZXJJZCBvZiBwbGF5ZXJJZHMpIHsKICAgICAgICAgICAgaWYgKGhpdGJveGVzW3BsYXllcklkXSkgY29udGludWU7IC8vIFNraXAgaWYgaGl0Ym94IGFscmVhZHkgZXhpc3RzCgogICAgICAgICAgICBsZXQgbmV3Qm94XzAwID0gRnV4bnkuTGlvbi5NZXNoLkNyZWF0ZUJveCgiaGl0Ym94X21lc2hfIiArIHBsYXllcklkLCAxLCBmYWxzZSwgMSwgRnV4bnkuTGlvbi5zY2VuZSk7CiAgICAgICAgICAgIG5ld0JveF8wMC5yZW5kZXJpbmdHcm91cElkID0gMjsKCiAgICAgICAgICAgIG5ld0JveF8wMC5tYXRlcmlhbCA9IG5ldyBGdXhueS5MaW9uLlN0YW5kYXJkTWF0ZXJpYWwoIm1hdCIsIEZ1eG55Lkxpb24uc2NlbmUpOwogICAgICAgICAgICBuZXdCb3hfMDAubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gbmV3IEZ1eG55Lkxpb24uQ29sb3IzKDEsIDEsIDEpOwogICAgICAgICAgICBuZXdCb3hfMDAubWF0ZXJpYWwuZW1pc3NpdmVDb2xvciA9IG5ldyBGdXhueS5MaW9uLkNvbG9yMygxLCAxLCAxKTsKICAgICAgICAgICAgbmV3Qm94XzAwLm5hbWUgPSAnX2hpdGJveCc7CiAgICAgICAgICAgIG5ld0JveF8wMC5pZCA9ICdfX2hpdGJveF8nICsgcGxheWVySWQ7CgogICAgICAgICAgICBsZXQgZGVmYXVsdFBvc2l0aW9uID0gbmV3IG5ld0JveF8wMC5wb3NpdGlvbi5jb25zdHJ1Y3RvcigwLCAwLjMyLCAwKTsKICAgICAgICAgICAgbmV3Qm94XzAwLnBvc2l0aW9uID0gZGVmYXVsdFBvc2l0aW9uLmNsb25lKCk7CiAgICAgICAgICAgIG5ld0JveF8wMC5fc2NhbGluZy5feSA9IDIuMjsKICAgICAgICAgICAgbmV3Qm94XzAwLm1hdGVyaWFsLmFscGhhID0gMC41OwogICAgICAgICAgICBuZXdCb3hfMDAuaXNWaXNpYmxlID0gaGl0Qm94RW5hYmxlZDsKCiAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybU5vZGVLZXkgPSBwbGF5ZXJJZC50b1N0cmluZygpOwogICAgICAgICAgICByZW5kZXJpbmcuYXR0YWNoVHJhbnNmb3JtTm9kZShuZXdCb3hfMDAsIHRyYW5zZm9ybU5vZGVLZXksIDEzKTsKICAgICAgICAgICAgci52YWx1ZXMoRnV4bnkucmVuZGVyaW5nKVsyN10uY2FsbChGdXhueS5yZW5kZXJpbmcsIG5ld0JveF8wMCk7CgogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3Qm94XzAwLl9ub2RlRGF0YVN0b3JhZ2UsICdfaXNFbmFibGVkJywgewogICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlLAogICAgICAgICAgICAgICAgc2V0OiAodikgPT4ge30sCiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IGZhbHNlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaGl0Ym94ZXNbcGxheWVySWRdID0gbmV3Qm94XzAwOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2xlYW51cCBoaXRib3hlcyBmb3IgcGxheWVycyB3aG8gaGF2ZSBsZWZ0CiAgICAgICAgZm9yIChjb25zdCBlSWQgaW4gaGl0Ym94ZXMpIHsKICAgICAgICAgICAgaWYgKCFhY3RpdmVFSWRzLmhhcyhwYXJzZUludChlSWQpKSkgewogICAgICAgICAgICAgICAgaGl0Ym94ZXNbZUlkXT8uZGlzcG9zZSgpOwogICAgICAgICAgICAgICAgZGVsZXRlIGhpdGJveGVzW2VJZF07CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFRvZ2dsZSB2aXNpYmlsaXR5IGZvciBhbGwgYWN0aXZlIGhpdGJveGVzCiAgICAgICAgZm9yIChjb25zdCBlSWQgaW4gaGl0Ym94ZXMpIHsKICAgICAgICAgICAgaWYgKGhpdGJveGVzW2VJZF0pIHsKICAgICAgICAgICAgICAgIGhpdGJveGVzW2VJZF0uaXNWaXNpYmxlID0gaGl0Qm94RW5hYmxlZDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBzdGFydEhlYWx0aFdhdGNoZXIoKSB7CiAgICAgICAgaWYgKGhlYWx0aFdhdGNoZXJJbnRlcnZhbCkgY2xlYXJJbnRlcnZhbChoZWFsdGhXYXRjaGVySW50ZXJ2YWwpOwoKICAgICAgICBoZWFsdGhXYXRjaGVySW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgIGlmICghaW5qZWN0ZWRCb29sIHx8ICFsYXN0Q2xvc2VzdElkKSB7CiAgICAgICAgICAgICAgICBzZXRIZWFsdGhCYXIoMTAwLCBmYWxzZSk7IC8vIEhpZGUgYmFyIGlmIG5vIHRhcmdldAogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBzdGF0ZSA9IEZ1eG55LmVudGl0aWVzLmdldFN0YXRlKGxhc3RDbG9zZXN0SWQsICJnZW5lcmljTGlmZWZvcm1TdGF0ZSIpOwogICAgICAgICAgICBpZiAoIXN0YXRlIHx8ICFzdGF0ZS5pc0FsaXZlKSB7CiAgICAgICAgICAgICAgICBzZXRIZWFsdGhCYXIoMTAwLCBmYWxzZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFRoaXMgaXMgYW4gYXNzdW1wdGlvbiBiYXNlZCBvbiBjb21tb24gZ2FtZSBlbmdpbmUgcGF0dGVybnMuCiAgICAgICAgICAgIC8vIFRoZSBvbGQgbWV0aG9kIHdhcyBvYmZ1c2NhdGVkIGFuZCBoYXMgYnJva2VuLgogICAgICAgICAgICBjb25zdCBoZWFsdGggPSBzdGF0ZS5oZWFsdGg7CiAgICAgICAgICAgIGNvbnN0IG1heEhlYWx0aCA9IHN0YXRlLm1heEhlYWx0aDsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgaGVhbHRoID09PSAnbnVtYmVyJyAmJiB0eXBlb2YgbWF4SGVhbHRoID09PSAnbnVtYmVyJyAmJiBtYXhIZWFsdGggPiAwKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gKGhlYWx0aCAvIG1heEhlYWx0aCkgKiAxMDA7CiAgICAgICAgICAgICAgICBzZXRIZWFsdGhCYXIocGVyY2VudCwgdHJ1ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZXRIZWFsdGhCYXIoMTAwLCBmYWxzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwgMzAwKTsKICAgIH0KCiAgICAoKCkgPT4gewogICAgICAgIC8vIFJlbW92ZSBpZiBhbHJlYWR5IHByZXNlbnQKICAgICAgICBjb25zdCBvbGQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidmVydGljYWwtaGVhbHRoLWJhciIpOwogICAgICAgIGlmIChvbGQpIG9sZC5yZW1vdmUoKTsKCiAgICAgICAgLy8gQ3JlYXRlIGJhciBjb250YWluZXIKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICBjb250YWluZXIuaWQgPSAidmVydGljYWwtaGVhbHRoLWJhciI7CiAgICAgICAgT2JqZWN0LmFzc2lnbihjb250YWluZXIuc3R5bGUsIHsKICAgICAgICAgICAgcG9zaXRpb246ICJmaXhlZCIsCiAgICAgICAgICAgIGxlZnQ6ICJjYWxjKDUwJSAtIDIwMHB4KSIsIC8vIDEwMHB4IGxlZnQgb2YgY2VudGVyCiAgICAgICAgICAgIHRvcDogIjUwJSIsCiAgICAgICAgICAgIHRyYW5zZm9ybTogInRyYW5zbGF0ZVkoLTUwJSkiLAogICAgICAgICAgICB3aWR0aDogIjRweCIsCiAgICAgICAgICAgIGhlaWdodDogIjIwMHB4IiwKICAgICAgICAgICAgYmFja2dyb3VuZDogIiMwMDAiLAogICAgICAgICAgICBib3JkZXI6ICIycHggc29saWQgYmxhY2siLAogICAgICAgICAgICB6SW5kZXg6IDEyMCwKICAgICAgICAgICAgcG9pbnRlckV2ZW50czogIm5vbmUiLAogICAgICAgICAgICBkaXNwbGF5OiAiZmxleCIsCiAgICAgICAgICAgIGFsaWduSXRlbXM6ICJmbGV4LWVuZCIsCiAgICAgICAgICAgIG92ZXJmbG93OiAiaGlkZGVuIgogICAgICAgIH0pOwoKICAgICAgICAvLyBDcmVhdGUgZmlsbCBlbGVtZW50CiAgICAgICAgY29uc3QgZmlsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIE9iamVjdC5hc3NpZ24oZmlsbC5zdHlsZSwgewogICAgICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgICAgYmFja2dyb3VuZDogImxpbWVncmVlbiIsCiAgICAgICAgICAgIHRyYW5zZm9ybTogInNjYWxlWSgxKSIsCiAgICAgICAgICAgIHRyYW5zZm9ybU9yaWdpbjogImJvdHRvbSIsCiAgICAgICAgICAgIHRyYW5zaXRpb246ICJ0cmFuc2Zvcm0gMC4ycyBlYXNlLCBiYWNrZ3JvdW5kIDAuMnMgZWFzZSIsIC8vIDwtLSBhZGQgY29tbWEgaGVyZQogICAgICAgIH0pOwoKICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZmlsbCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpOwoKICAgICAgICAvLyBGdW5jdGlvbiB0byBjb21wdXRlIHNtb290aCBncmFkaWVudCBjb2xvciBmcm9tIGdyZWVuIOKGkiByZWQKICAgICAgICBmdW5jdGlvbiBnZXRIZWFsdGhDb2xvcihoZWFsdGgpIHsKICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBoZWFsdGggLyAxMDA7CgogICAgICAgICAgICBpZiAocmF0aW8gPiAwLjUpIHsKICAgICAgICAgICAgICAgIC8vIEJyaWdodCBncmVlbiDihpIgb3JhbmdlCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gKHJhdGlvIC0gMC41KSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCByID0gTWF0aC5yb3VuZCgyNTUgKiAoMSAtIHQpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGcgPSAyNTU7CiAgICAgICAgICAgICAgICByZXR1cm4gYHJnYigke3J9LCAke2d9LCAwKWA7IC8vIGdyZWVuIHRvIHllbGxvdyB0byBvcmFuZ2UKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIE9yYW5nZSDihpIgcmVkCiAgICAgICAgICAgICAgICBjb25zdCB0ID0gcmF0aW8gKiAyOwogICAgICAgICAgICAgICAgY29uc3QgciA9IDI1NTsKICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBNYXRoLnJvdW5kKDI1NSAqIHQpOwogICAgICAgICAgICAgICAgcmV0dXJuIGByZ2IoJHtyfSwgJHtnfSwgMClgOyAvLyBvcmFuZ2UgdG8gcmVkCiAgICAgICAgICAgIH0KICAgICAgICB9CgoKICAgICAgICAvLyBHbG9iYWwgaGVhbHRoIHNldHRlciBhbmQgc2hvdy9oaWRlIHRvZ2dsZQogICAgICAgIHNldEhlYWx0aEJhciA9IGZ1bmN0aW9uKGhlYWx0aCwgc2hvdyA9IHRydWUpIHsKICAgICAgICAgICAgY29uc3QgY2xhbXBlZCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGhlYWx0aCwgMTAwKSk7CiAgICAgICAgICAgIGZpbGwuc3R5bGUudHJhbnNmb3JtID0gYHNjYWxlWSgke2NsYW1wZWQgLyAxMDB9KWA7CiAgICAgICAgICAgIGZpbGwuc3R5bGUuYmFja2dyb3VuZCA9IGdldEhlYWx0aENvbG9yKGNsYW1wZWQpOwogICAgICAgICAgICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9IHNob3cgPyAiZmxleCIgOiAibm9uZSI7CiAgICAgICAgfTsKICAgICAgICBzZXRIZWFsdGhCYXIoMTAwLCBmYWxzZSkKICAgIH0pKCk7CgoKICAgIGZ1bmN0aW9uIHBlcmZvcm1JbmplY3Rpb24oKSB7CiAgICAgICAgbC5pbml0KCk7CiAgICAgICAgZnVuY3Rpb24gaW5qZWN0KCkgewogICAgICAgICAgICBsZXQgd2luRGVzY3JpcHRvcnMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh3aW5kb3cpOwogICAgICAgICAgICBsZXQgd3BOYW1lID0gT2JqZWN0LmtleXMod2luRGVzY3JpcHRvcnMpLmZpbmQoa2V5ID0+IHdpbkRlc2NyaXB0b3JzW2tleV0/LnNldD8udG9TdHJpbmcoKS5pbmNsdWRlcygiKysiKSk7CiAgICAgICAgICAgIGxldCB3cEluc3RhbmNlID0gd2luZG93W3dwTmFtZV0gPSB3aW5kb3dbd3BOYW1lXTsKCiAgICAgICAgICAgIC8vIEhJTE9DQVRPUiBwdXNoCiAgICAgICAgICAgIHdwSW5zdGFuY2UucHVzaChbCiAgICAgICAgICAgICAgICBbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogOTAwMDApICsgMTAwMDBdLCB7fSwKICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHdwUmVxdWlyZSkgewogICAgICAgICAgICAgICAgICAgIEZ1eG55LmZpbmRNb2R1bGUgPSAoY29kZSkgPT4gd3BSZXF1aXJlKE9iamVjdC5rZXlzKHdwUmVxdWlyZS5tKVtPYmplY3QudmFsdWVzKHdwUmVxdWlyZS5tKS5maW5kSW5kZXgobSA9PiBtLnRvU3RyaW5nKCkuaW5jbHVkZXMoY29kZSkpXSk7CiAgICAgICAgICAgICAgICAgICAgRnV4bnkuUHJvcHMgPSBPYmplY3QudmFsdWVzKEZ1eG55LmZpbmRNb2R1bGUoIm5vbkJsb2Nrc0NsaWVudDoiKSkuZmluZChwcm9wID0+IHR5cGVvZiBwcm9wID09ICJvYmplY3QiKTsKICAgICAgICAgICAgICAgICAgICBGdXhueS5ub2EgPSBPYmplY3QudmFsdWVzKEZ1eG55LlByb3BzKS5maW5kKHByb3AgPT4gcHJvcD8uZW50aXRpZXMpOwogICAgICAgICAgICAgICAgICAgIC8vQ3JlZGl0cyB0bywgeW91IGd1ZXNzZWQgaXQgd2FuZyEKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgXSk7CgoKICAgICAgICAgICAgY29uc3QgdGFyZ2V0VmFsdWUgPSByLnZhbHVlcyhGdXhueS5ub2EuZW50aXRpZXMpWzJdOwogICAgICAgICAgICBjb25zdCBlbnRpdHlFbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoRnV4bnkubm9hLmVudGl0aWVzKTsKICAgICAgICAgICAgRnV4bnkuaW1wS2V5ID0gZW50aXR5RW50cmllcy5maW5kKChbXywgdmFsXSkgPT4gdmFsID09PSB0YXJnZXRWYWx1ZSk/LlswXTsKICAgICAgICAgICAgRnV4bnkucmVnaXN0cnkgPSByLnZhbHVlcyhGdXhueS5ub2EpWzE3XQogICAgICAgICAgICBGdXhueS5yZW5kZXJpbmcgPSByLnZhbHVlcyhGdXhueS5ub2EpWzEyXQogICAgICAgICAgICBGdXhueS5lbnRpdGllcyA9IEZ1eG55Lm5vYS5lbnRpdGllczsKCgogICAgICAgICAgICBGdXhueS5FQ1MgPSByLnZhbHVlcyhGdXhueS5ub2EpWzE5XQoKICAgICAgICAgICAgaWYgKEZ1eG55LmltcEtleSkgewogICAgICAgICAgICAgICAgY29uc29sZS5sb2coImltcG9ydGFudExpc3QgaWRlbnRpZmllZDoiLCBGdXhueS5pbXBLZXkpOwoKICAgICAgICAgICAgICAgIC8vIEF0dGVtcHQgdG8gZmluZCBCSE9QIHJlZmVyZW5jZXMKICAgICAgICAgICAgICAgIGNvbnN0IGtleSA9IEZ1eG55LmltcEtleTsKICAgICAgICAgICAgICAgIGlmIChrZXkpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBlbnRpdHkgPSBGdXhueS5ub2EuZW50aXRpZXM/LltrZXldOwogICAgICAgICAgICAgICAgICAgIGlmIChlbnRpdHk/Lm1vdmVTdGF0ZT8ubGlzdD8uWzBdICYmIGVudGl0eT8ubW92ZW1lbnQ/Lmxpc3Q/LlswXSkgewogICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJLZXkgPSBrZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1vdmVTdGF0ZSA9IGVudGl0eS5tb3ZlU3RhdGUubGlzdFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgcGh5c1N0YXRlID0gZW50aXR5Lm1vdmVtZW50Lmxpc3RbMF07CiAgICAgICAgICAgICAgICAgICAgICAgIGNhY2hlZEJIT1BQYXJlbnQgPSBlbnRpdHk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCLinIUgQ2FjaGVkIEJIT1AgZW50aXR5IGRhdGEiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIuKaoO+4jyBGb3VuZCBrZXkgYnV0IG1pc3NpbmcgQkhPUCBjb21wb25lbnRzIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIuKdjCBCSE9QIHBsYXllciBrZXkgbm90IGZvdW5kIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGZpbmRlSWRLZXkoKSB7CgogICAgICAgICAgICAgICAgY29uc3QgcmVuZGVyaW5nID0gci52YWx1ZXMoRnV4bnkucmVuZGVyaW5nKVsxOF07CiAgICAgICAgICAgICAgICBjb25zdCBvYmplY3REYXRhID0gcmVuZGVyaW5nPy5vYmplY3REYXRhOwogICAgICAgICAgICAgICAgaWYgKCFvYmplY3REYXRhKSByZXR1cm47CgogICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlID0gb2JqZWN0RGF0YVsxXTsKICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIHNhbXBsZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChzYW1wbGVba2V5XSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBlSWRLZXkgPSBrZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmluZGVJZEtleSgpOwoKICAgICAgICAgICAgbGV0IG1lc2ggPSByLnZhbHVlcyhGdXhueS5yZW5kZXJpbmcpWzddLm1lc2hlc1swXTsKICAgICAgICAgICAgbGV0IHNjZW5lID0gci52YWx1ZXMoRnV4bnkucmVuZGVyaW5nKVs3XTsKICAgICAgICAgICAgbGV0IGVuZ2luZSA9IHNjZW5lLmdldEVuZ2luZSgpOwogICAgICAgICAgICBsZXQgU3RhbmRhcmRNYXRlcmlhbCA9IG1lc2gubWF0ZXJpYWwuY29uc3RydWN0b3I7CiAgICAgICAgICAgIGxldCBDb2xvcjMgPSBtZXNoLm1hdGVyaWFsLmRpZmZ1c2VDb2xvci5jb25zdHJ1Y3RvcjsKICAgICAgICAgICAgbGV0IHNjZW5lTG9hZGVyTW9kID0gRnV4bnkuZmluZE1vZHVsZSgiZ2V0RW5naW5lKCkuZGlzcGxheUxvYWRpbmdVSSgpIik7CiAgICAgICAgICAgIGNvbnN0IGFkZEtleSA9IHIudmFsdWVzKEZ1eG55LmVudGl0aWVzKVsxMF0KICAgICAgICAgICAgY29uc3QgYWRkQ29tcG9uZW50ID0gRnV4bnkubm9hLmVudGl0aWVzW2FkZEtleV07CiAgICAgICAgICAgIEZ1eG55LndvcmxkID0gci52YWx1ZXMoRnV4bnkubm9hKVsxMV0KICAgICAgICAgICAgRnV4bnkucGh5c2ljcyA9IEZ1eG55Lm5vYS5waHlzaWNzCiAgICAgICAgICAgIEZ1eG55LmNhbWVyYSA9IEZ1eG55Lm5vYS5jYW1lcmEKICAgICAgICAgICAgRnV4bnkuYmxveGQgPSBGdXhueS5ub2EuYmxveGQKICAgICAgICAgICAgRnV4bnkuY2xpZW50T3B0aW9ucyA9IHIudmFsdWVzKEZ1eG55Lm5vYSlbMjldCiAgICAgICAgICAgIEZ1eG55Lkxpb24gPSB7CiAgICAgICAgICAgICAgICBzY2VuZSwKICAgICAgICAgICAgICAgIGVuZ2luZSwKICAgICAgICAgICAgICAgIEluc3RhbmNlZE1lc2g6IG1lc2guY29uc3RydWN0b3IsCiAgICAgICAgICAgICAgICBNZXNoOiBtZXNoLmNvbnN0cnVjdG9yLAogICAgICAgICAgICAgICAgU2NlbmU6IHNjZW5lLmNvbnN0cnVjdG9yLAogICAgICAgICAgICAgICAgRW5naW5lOiBlbmdpbmUuY29uc3RydWN0b3IsCiAgICAgICAgICAgICAgICBzY2VuZUxvYWRlcjogT2JqZWN0LnZhbHVlcyhzY2VuZUxvYWRlck1vZCkuZmluZChtb2QgPT4gdHlwZW9mIG1vZC5JbXBvcnRNZXNoID09PSAiZnVuY3Rpb24iKSwKICAgICAgICAgICAgICAgIENvbG9yMywKICAgICAgICAgICAgICAgIFN0YW5kYXJkTWF0ZXJpYWwsCiAgICAgICAgICAgICAgICBhZGRDb21wb25lbnQsCiAgICAgICAgICAgICAgICBhZGRLZXkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcGxheWVySW52ZW50b3J5UGFyZW50ID0gRnV4bnkuZW50aXRpZXNbRnV4bnkuaW1wS2V5XS5pbnZlbnRvcnkubGlzdFswXS5vcFdyYXBwZXIKCiAgICAgICAgICAgIGZ1bmN0aW9uIGF1dG9EZXRlY3RDaHVua0RhdGFGaWVsZChjaHVuaykgewogICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgT2JqZWN0LmtleXMoY2h1bmspKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gY2h1bmtba2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXZhbCkgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIHZhbCA9PT0gIm9iamVjdCIgJiYKICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXkuaXNBcnJheSh2YWwuc3RyaWRlKSAmJgogICAgICAgICAgICAgICAgICAgICAgICB2YWwuc3RyaWRlLmxlbmd0aCA9PT0gMyAmJgogICAgICAgICAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KHZhbC5kYXRhKSB8fAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXlCdWZmZXIuaXNWaWV3KHZhbC5kYXRhKSAvLyBjb3ZlcnMgVWludDE2QXJyYXkgZXRjLgogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCLinIUgRGV0ZWN0ZWQgY2h1bmsgZGF0YSBmaWVsZDoiLCBrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICBjaHVua0RhdGFGaWVsZCA9IGtleTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCLinYwgRmFpbGVkIHRvIGF1dG8tZGV0ZWN0IGNodW5rIGRhdGEgZmllbGQiKTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhdXRvRGV0ZWN0Q2h1bmtEYXRhRmllbGQoT2JqZWN0LnZhbHVlcyhGdXhueS53b3JsZFtGdXhueS5pbXBLZXldLmhhc2gpWzBdKTsKCgogICAgICAgICAgICBjb25zdCBtYXliZUVudGl0eSA9IHIudmFsdWVzKHIudmFsdWVzKEZ1eG55LmVudGl0aWVzW0Z1eG55LmltcEtleV0pWzIyXS5saXN0WzBdKVsxXTsKCiAgICAgICAgICAgIGNvbnN0IGhhc0RvQXR0YWNrRGlyZWN0ID0gdHlwZW9mIG1heWJlRW50aXR5Py5kb0F0dGFjayA9PT0gJ2Z1bmN0aW9uJzsKICAgICAgICAgICAgY29uc3QgaGFzRG9BdHRhY2tCcmVha2luZ0l0ZW0gPSB0eXBlb2YgbWF5YmVFbnRpdHk/LmJyZWFraW5nSXRlbT8uZG9BdHRhY2sgPT09ICdmdW5jdGlvbic7CgogICAgICAgICAgICBpZiAoaGFzRG9BdHRhY2tEaXJlY3QpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJtYXliZUVudGl0eSBoYXMgZG9BdHRhY2siKTsKICAgICAgICAgICAgICAgIHBsYXllckVudGl0eSA9IG1heWJlRW50aXR5OwogICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0RvQXR0YWNrQnJlYWtpbmdJdGVtKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygibWF5YmVFbnRpdHkuYnJlYWtpbmdJdGVtIGhhcyBkb0F0dGFjayIpOwogICAgICAgICAgICAgICAgcGxheWVyRW50aXR5ID0gbWF5YmVFbnRpdHkuYnJlYWtpbmdJdGVtOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJOZWl0aGVyIG1heWJlRW50aXR5IG5vciBpdHMgYnJlYWtpbmdJdGVtIGhhcyBkb0F0dGFjayIpOwogICAgICAgICAgICAgICAgcGxheWVyRW50aXR5ID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZmluZE9ubHlzZW5kQnl0ZXMob2JqKSB7CiAgICAgICAgICAgICAgICBpZiAoIW9iaikgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2Fybigi4p2MIFByb3ZpZGVkIG9iamVjdCBpcyBudWxsIG9yIHVuZGVmaW5lZC4iKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBwcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopOwogICAgICAgICAgICAgICAgY29uc3QgcHJvcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhwcm90byk7CgogICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2YgcHJvcHMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnY29uc3RydWN0b3InKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gcHJvdG9ba2V5XTsKICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdHIgPSB2YWwudG9TdHJpbmcoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExvb3NlciBidXQgZWZmZWN0aXZlIHBhdHRlcm4gZGV0ZWN0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGxvb2tzTGlrZXNlbmRCeXRlcyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWwubGVuZ3RoID09PSAyICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvUHJvdG9jb2xcLlJPT01fREFUQV9CWVRFUy9pLnRlc3Qoc3RyKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyLmluY2x1ZGVzKCdVaW50OEFycmF5JykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC90eXBlb2YvLnRlc3Qoc3RyKSAmJiAvLyBqdXN0IGNoZWNrIGFueSB0eXBlb2YgdXNhZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0ci5pbmNsdWRlcygnLmVuY29kZScpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAoc3RyLmluY2x1ZGVzKCcuYnl0ZUxlbmd0aCcpIHx8IHN0ci5pbmNsdWRlcygnLmxlbmd0aCcpKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyLmluY2x1ZGVzKCcuc2V0Jyk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9va3NMaWtlc2VuZEJ5dGVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFJlYWwgc2VuZEJ5dGVzIGZvdW5kOiAke2tleX1gKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCLinYwgc2VuZEJ5dGVzIGZ1bmN0aW9uIG5vdCBmb3VuZC4iKTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBVc2FnZQogICAgICAgICAgICBjb2x5Um9vbSA9IHIudmFsdWVzKEZ1eG55LmJsb3hkLmNsaWVudC5tc2dIYW5kbGVyKVswXTsKICAgICAgICAgICAgc2VuZEJ5dGVzTmFtZSA9IGZpbmRPbmx5c2VuZEJ5dGVzKGNvbHlSb29tKTsKCiAgICAgICAgICAgIGlmICghY29seVJvb20gfHwgdHlwZW9mIGNvbHlSb29tW3NlbmRCeXRlc05hbWVdICE9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIltCbGlua10gY29seVJvb20gb3Igc2VuZEJ5dGVzIG5vdCByZWFkeS4iKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYmxpbmtTdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGVuYWJsZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgb3JpZ2luYWxTZW5kQnl0ZXM6IGNvbHlSb29tW3NlbmRCeXRlc05hbWVdLAogICAgICAgICAgICAgICAgcXVldWVkOiBbXSwKICAgICAgICAgICAgICAgIGludGVydmFsOiAwLAogICAgICAgICAgICAgICAgbm9QYWNrZXQ6IGZhbHNlCiAgICAgICAgICAgIH07CgoKCgogICAgICAgICAgICBjYWNoZWROYW1lVGFnUGFyZW50ID0gRnV4bnkuTGlvbi5zY2VuZQoKCiAgICAgICAgICAgIGluamVjdGVkQm9vbCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzZXR1cEtpbGxBdXJhQm94KCkgewoKCiAgICAgICAgICAgIG5ld0JveCA9IEZ1eG55Lkxpb24uTWVzaC5DcmVhdGVCb3goIm1lc2giLCAxLCBmYWxzZSwgMSwgRnV4bnkuTGlvbi5zY2VuZSk7CiAgICAgICAgICAgIG5ld0JveC5yZW5kZXJpbmdHcm91cElkID0gMTsKICAgICAgICAgICAgbmV3Qm94SWQgPSBGdXhueS5lbnRpdGllcy5hZGQoWzAsIDEwLCAwXSwgbnVsbCwgbnVsbCwgbmV3Qm94KTsKCiAgICAgICAgICAgIC8vbmV3Qm94LkRhID0gdHJ1ZTsKICAgICAgICAgICAgbmV3Qm94Lm1hdGVyaWFsID0gbmV3IEZ1eG55Lkxpb24uU3RhbmRhcmRNYXRlcmlhbCgibWF0IiwgRnV4bnkuTGlvbi5zY2VuZSk7CiAgICAgICAgICAgIG5ld0JveC5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBuZXcgRnV4bnkuTGlvbi5Db2xvcjMoMSwgMSwgMSk7CiAgICAgICAgICAgIG5ld0JveC5tYXRlcmlhbC5lbWlzc2l2ZUNvbG9yID0gbmV3IEZ1eG55Lkxpb24uQ29sb3IzKDEsIDEsIDEpOwogICAgICAgICAgICBuZXdCb3gubmFtZSA9ICdCb2R5TWVzaCc7CiAgICAgICAgICAgIG5ld0JveC5pZCA9ICdCb2R5TWVzaCc7CiAgICAgICAgICAgIG5ld0JveC5pc1Zpc2libGUgPSBmYWxzZTsKCiAgICAgICAgICAgIC8vIEZpbmQgbnVsbCBrZXkKICAgICAgICAgICAgX19udWxsS2V5ID0gbnVsbDsKICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gbmV3Qm94KSB7CiAgICAgICAgICAgICAgICBpZiAoa2V5Lmxlbmd0aCA9PT0gMiAmJiBuZXdCb3hba2V5XSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIF9fbnVsbEtleSA9IGtleTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoX19udWxsS2V5KSB7CiAgICAgICAgICAgICAgICBuZXdCb3hbX19udWxsS2V5XSA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBGdXhueS5lbnRpdHlMaXN0ID0gci52YWx1ZXMoRnV4bnkubm9hKVszMF0KCiAgICAgICAgICAgIGh1bWFub2lkTWVzaGxpc3QgPSBGdXhueS5lbnRpdGllc1tGdXhueS5pbXBLZXldPy5odW1hbm9pZE1lc2g/Lmxpc3Q7CiAgICAgICAgICAgIF9fc3RyaW5nS2V5ID0gbnVsbDsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaHVtYW5vaWRNZXNobGlzdCkpIHsKICAgICAgICAgICAgICAgIG91dGVyTG9vcDogZm9yIChjb25zdCBvYmogb2YgaHVtYW5vaWRNZXNobGlzdCkgewogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIG9ialtrZXldID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX19zdHJpbmdLZXkgPSBrZXk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayBvdXRlckxvb3A7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCLinYwgSW52YWxpZCBodW1hbm9pZE1lc2hsaXN0IHBhdGguIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEZvbGxvdyBsb29wCiAgICAgICAgICAgIGZ1bmN0aW9uIGZvbGxvd0hlYWRMb29wKCkgewogICAgICAgICAgICAgICAgaWYgKG5ld0JveCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBsYXllcklkID0gMTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJQb3NTdGF0ZSA9IEZ1eG55LmVudGl0aWVzLmdldFN0YXRlKHBsYXllcklkLCAicG9zaXRpb24iKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHBsYXllclBvc1N0YXRlICYmIEFycmF5LmlzQXJyYXkocGxheWVyUG9zU3RhdGUucG9zaXRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFt4LCB5LCB6XSA9IHBsYXllclBvc1N0YXRlLnBvc2l0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdQb3MgPSBbeCwgeSArIDEuNSwgel07CiAgICAgICAgICAgICAgICAgICAgICAgIEZ1eG55LmVudGl0aWVzLnNldFBvc2l0aW9uKG5ld0JveElkLCBuZXdQb3MpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlBsYXllciBwb3NpdGlvbiBub3QgZm91bmQgb3IgaW52YWxpZCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBhbmltYXRpb25GcmFtZUlkID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZvbGxvd0hlYWRMb29wKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gU3RhcnQgdGhlIGxvb3AKICAgICAgICAgICAgYW5pbWF0aW9uRnJhbWVJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShmb2xsb3dIZWFkTG9vcCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBzdGFydFRhcmdldEZpbmRlcigpIHsKICAgICAgICAgICAgaWYgKHRhcmdldEZpbmRlcklkKSBjbGVhckludGVydmFsKHRhcmdldEZpbmRlcklkKTsKCiAgICAgICAgICAgIHRhcmdldEZpbmRlcklkID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFpbmplY3RlZEJvb2wgfHwgIUZ1eG55LmVudGl0aWVzKSByZXR1cm47CgogICAgICAgICAgICAgICAgaWYgKCFGdXhueS5lbnRpdGllcy5nZXRTdGF0ZShteUlkLCAiZ2VuZXJpY0xpZmVmb3JtU3RhdGUiKT8uaXNBbGl2ZSkgewogICAgICAgICAgICAgICAgICAgIGxhc3RDbG9zZXN0SWQgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBteVBvcyA9IEZ1eG55LmVudGl0aWVzLmdldFN0YXRlKG15SWQsICdwb3NpdGlvbicpPy5wb3NpdGlvbjsKICAgICAgICAgICAgICAgIGlmICghbXlQb3MpIHJldHVybjsKCiAgICAgICAgICAgICAgICBjb25zdCBwbGF5ZXJJZHMgPSBuLm5vYS5wbGF5ZXJMaXN0OwogICAgICAgICAgICAgICAgaWYgKCFwbGF5ZXJJZHMpIHJldHVybjsKCiAgICAgICAgICAgICAgICBsZXQgY2xvc2VzdElkID0gbnVsbDsKICAgICAgICAgICAgICAgIGxldCBtaW5EaXN0ID0gMTAwOyAvLyBNYXggZGlzdGFuY2Ugc3F1YXJlZCAoMTAgYmxvY2tzKQoKICAgICAgICAgICAgICAgIGZvciAoY29uc3QgcGxheWVySWQgb2YgcGxheWVySWRzKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zID0gRnV4bnkuZW50aXRpZXMuZ2V0U3RhdGUocGxheWVySWQsICdwb3NpdGlvbicpPy5wb3NpdGlvbjsKICAgICAgICAgICAgICAgICAgICBpZiAoIXBvcykgY29udGludWU7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXRlID0gRnV4bnkuZW50aXRpZXMuZ2V0U3RhdGUocGxheWVySWQsICJnZW5lcmljTGlmZWZvcm1TdGF0ZSIpOwogICAgICAgICAgICAgICAgICAgIGlmICghc3RhdGUgfHwgIXN0YXRlLmlzQWxpdmUpIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gUy5kaXN0YW5jZUJldHdlZW4obXlQb3MsIHBvcyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGRpc3QgPCBtaW5EaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1pbkRpc3QgPSBkaXN0OwogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0SWQgPSBwbGF5ZXJJZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGxhc3RDbG9zZXN0SWQgIT09IGNsb3Nlc3RJZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChoaXRib3hlc1tsYXN0Q2xvc2VzdElkXSkgeyAvLyBSZXZlcnQgb2xkIHRhcmdldCBjb2xvcgogICAgICAgICAgICAgICAgICAgICAgICAgaGl0Ym94ZXNbbGFzdENsb3Nlc3RJZF0ubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gbmV3IEZ1eG55Lkxpb24uQ29sb3IzKDEsIDEsIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgaGl0Ym94ZXNbbGFzdENsb3Nlc3RJZF0ubWF0ZXJpYWwuZW1pc3NpdmVDb2xvciA9IG5ldyBGdXhueS5MaW9uLkNvbG9yMygxLCAxLCAxKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGhpdGJveGVzW2Nsb3Nlc3RJZF0pIHsgLy8gSGlnaGxpZ2h0IG5ldyB0YXJnZXQKICAgICAgICAgICAgICAgICAgICAgICAgaGl0Ym94ZXNbY2xvc2VzdElkXS5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBuZXcgRnV4bnkuTGlvbi5Db2xvcjMoMSwgMCwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhpdGJveGVzW2Nsb3Nlc3RJZF0ubWF0ZXJpYWwuZW1pc3NpdmVDb2xvciA9IG5ldyBGdXhueS5MaW9uLkNvbG9yMygxLCAwLCAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbGFzdENsb3Nlc3RJZCA9IGNsb3Nlc3RJZDsKCiAgICAgICAgICAgIH0sIDIwMCk7CiAgICAgICAgfQogICAgICAgIGluamVjdCgpOwogICAgICAgIHNldHVwS2lsbEF1cmFCb3goKTsKICAgICAgICBzdGFydFRhcmdldEZpbmRlcigpOwogICAgICAgIHNldEludGVydmFsKG1ha2VIaXRib3hlcywgMTAwMCk7CiAgICB9CgogICAgd2FpdEZvckVsZW1lbnQoJ2Rpdi5NYWluTG9hZGluZ1N0YXRlLkZ1bGx5RmFuY3lUZXh0JywgKGVsKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coJ1RhcmdldCBkaXYgYXBwZWFyZWQ6JywgZWwpOwogICAgICAgIHBlcmZvcm1JbmplY3Rpb24oKTsKICAgICAgICBpZiAoIWluamVjdGVkQm9vbCkgewogICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCJpbmplY3Rpb24gZmFpbGVkIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiaW5qZWN0aW9uIHN1Y2Nlc3NmdWwiKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvL19fRU5EX19IQUNLX0NPREVfRlJPTV9QT1RURVJZMDA5X1RYVF9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXwoKCiAgICAvLyAtLS0gSUNPTlMgKEx1Y2lkZSBzdHlsZSBTVkdzKSAtLS0KICAgIGNvbnN0IGljb25zID0gewogICAgICAgIG1haW46IGA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGQ9Ik0xMiAydjIwTTIgMTJoMjAiLz48L3N2Zz5gLAogICAgICAgIHZpc3VhbHM6IGA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjkiLz48cGF0aCBkPSJNMTIgM3Y5aDkiLz48L3N2Zz5gLAogICAgICAgIGV4cGVyaW1lbnRhbDogYDxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iY3VycmVudENvbG9yIiBzdHJva2Utd2lkdGg9IjIiIHZpZXdCb3g9IjAgMCAyNCAyNCI+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMTAiLz48cGF0aCBkPSJNMTIgNnY2bDQgMiIvPjwvc3ZnPmAsCiAgICAgICAgc2V0dGluZ3M6IGA8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjE4IiBoZWlnaHQ9IjE4IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjMiLz48cGF0aCBkPSJNMTkuNCAxNWExLjY1IDEuNjUgMCAwIDAgLjMzIDEuODJsLjA2LjA2YTIgMiAwIDAgMS0yLjgzIDIuODNsLS4wNi0uMDZhMS42NSAxLjY1IDAgMCAwLTEuODItLjMzIDEuNjUgMS42NSAwIDAgMC0xIDEuNTFWMjFhMiAyIDAgMCAxLTQgMHYtLjA5YTEuNjUgMS42NSAwIDAgMC0xLTEuNTEgMS42NSAxLjY1IDAgMCAwLTEuODIuMzNsLS4wNi4wNmEyIDIgMCAxIDEtMi44My0yLjgzbC4wNi0uMDZhMS42NSAxLjY1IDAgMCAwIC4zMy0xLjgyIDEuNjUgMS42NSAwIDAgMC0xLjUxLTFIM2EyIDIgMCAwIDEgMC00aC4wOWExLjY1IDEuNjUgMCAwIDAgMS41MS0xIDEuNjUgMS42NSAwIDAgMC0uMzMtMS44MmwtLjA2LS4wNmEyIDIgMCAxIDEgMi44My0yLjgzbC4wNi4wNmMuNDYuNDYgMS4xNC42MSAxLjgyLjMzaC4wMWExLjY1IDEuNjUgMCAwIDAgMS0xLjUxVjNhMiAyIDAgMCAxIDQgMHYuMDljMCAuNjYuMzkgMS4yNSAxIDEuNTEuNjguMjggMS4zNi4xMyAxLjgyLS4zM2wuMDYtLjA2YTIgMiAwIDEgMSAyLjgzIDIuODNsLS4wNi4wNmMtLjQ2LjQ2LS42MSAxLjE0LS4zMyAxLjgyLjI2LjYxLjg1IDEgMS41MSAxSDIxYTIgMiAwIDAgMSAwIDRoLS4wOWMtLjY2IDAtMS4yNS4zOS0xLjUxIDF6Ii8+PC9zdmc+YAogICAgfTsKCiAgICAvLyAtLS0gU1RZTEVTIC0tLQogICAgY29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzdHlsZSIpOwogICAgc3R5bGUudGV4dENvbnRlbnQgPSBgCiAgICAgICAgLyogQmFja2dyb3VuZCAqLwogICAgICAgIGJvZHk6OmJlZm9yZSB7CiAgICAgICAgICAgIGNvbnRlbnQ6ICIiOwogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICAgICAgICAgIHRvcDogMDsgbGVmdDogMDsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7IGhlaWdodDogMTAwJTsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmFkaWFsLWdyYWRpZW50KGNpcmNsZSBhdCBjZW50ZXIsICMwMDAgMCUsICMwYTBhMGYgMTAwJSk7CiAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgiaHR0cHM6Ly93d3cudHJhbnNwYXJlbnR0ZXh0dXJlcy5jb20vcGF0dGVybnMvc3RhcmR1c3QucG5nIik7CiAgICAgICAgICAgIHotaW5kZXg6IC0xOwogICAgICAgIH0KCiAgICAgICAgLyogTWFpbiBjb250YWluZXIgKi8KICAgICAgICAjc3BlY3RyYS11aSB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgdG9wOiA1MCU7CiAgICAgICAgICAgIGxlZnQ6IDUwJTsKICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgICAgICAgICAgIHdpZHRoOiA1MjBweDsKICAgICAgICAgICAgbWF4LXdpZHRoOiA5NSU7CiAgICAgICAgICAgIGhlaWdodDogMzIwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMTUsIDE1LCAyMCwgMC45Mik7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC4xKTsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBmb250LWZhbWlseTogIlNlZ29lIFVJIiwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDI1cHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjIpOyAvKiBXaGl0ZSBHbG93ICovCiAgICAgICAgICAgIHotaW5kZXg6IDk5OTk5OTsKICAgICAgICB9CgogICAgICAgIC8qIFVJIENvbnRyb2xzICovCiAgICAgICAgI3NwZWN0cmEtZXhpdC1idG4gewogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgICAgICAgIHRvcDogOHB4OwogICAgICAgICAgICByaWdodDogMTJweDsKICAgICAgICAgICAgZm9udC1zaXplOiAyMHB4OwogICAgICAgICAgICBjb2xvcjogI2FhYTsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICB0cmFuc2l0aW9uOiBjb2xvciAwLjJzOwogICAgICAgICAgICB6LWluZGV4OiAxMDsKICAgICAgICB9CiAgICAgICAgI3NwZWN0cmEtZXhpdC1idG46aG92ZXIgewogICAgICAgICAgICBjb2xvcjogI2ZmZjsKICAgICAgICB9CiAgICAgICAgI3NwZWN0cmEtcmVvcGVuLWJ0biB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgdG9wOiAyMHB4OwogICAgICAgICAgICBsZWZ0OiAyMHB4OwogICAgICAgICAgICB3aWR0aDogNDBweDsKICAgICAgICAgICAgaGVpZ2h0OiA0MHB4OwogICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDMwLCAzMCwgMzUsIDAuOSk7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICAgICAgICBkaXNwbGF5OiBub25lOyAvKiBIaWRkZW4gYnkgZGVmYXVsdCAqLwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZm9udC1zaXplOiAyNHB4OwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgei1pbmRleDogMTAwMDAwMDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDE1cHggcmdiYSgwLDAsMCwwLjUpOwogICAgICAgIH0KCiAgICAgICAgLyogU2lkZWJhciAqLwogICAgICAgICNzcGVjdHJhLXNpZGViYXIgewogICAgICAgICAgICB3aWR0aDogMTUwcHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxODBkZWcsICMxMTEsICMxOTE5MTkpOwogICAgICAgICAgICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCByZ2JhKDI1NSwyNTUsMjU1LDAuMDgpOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICAgICAgICBhbGlnbi1pdGVtczogc3RyZXRjaDsKICAgICAgICAgICAgcGFkZGluZzogMTJweCAwOwogICAgICAgIH0KCiAgICAgICAgLyogTG9nbyBibGVuZCAqLwogICAgICAgICNzcGVjdHJhLXNpZGViYXIgLmxvZ28td3JhcCB7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBwYWRkaW5nOiA4cHggMCAxNnB4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMnB4OwogICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEpOwogICAgICAgIH0KICAgICAgICAjc3BlY3RyYS1zaWRlYmFyIGltZyB7CiAgICAgICAgICAgIHdpZHRoOiA2NXB4OwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxMHB4OwogICAgICAgICAgICAvKiBSZW1vdmVkIHRoZSBib3gtc2hhZG93IGZvciB0aGUgbG9nbyAqLwogICAgICAgIH0KCiAgICAgICAgLyogVGFicyB3aXRoIGljb25zICovCiAgICAgICAgLnNwZWN0cmEtdGFiIHsKICAgICAgICAgICAgcGFkZGluZzogMTBweCAxNHB4OwogICAgICAgICAgICBtYXJnaW46IDRweCA4cHg7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGdhcDogOHB4OwogICAgICAgICAgICBjb2xvcjogI2RkZDsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzLCBjb2xvciAwLjJzOwogICAgICAgIH0KICAgICAgICAuc3BlY3RyYS10YWIgc3ZnIHsKICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7CiAgICAgICAgfQogICAgICAgIC5zcGVjdHJhLXRhYiBzcGFuIHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICB9CiAgICAgICAgLnNwZWN0cmEtdGFiOmhvdmVyIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTsKICAgICAgICAgICAgY29sb3I6ICNmZmY7CiAgICAgICAgfQogICAgICAgIC5zcGVjdHJhLXRhYi5hY3RpdmUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoOTBkZWcsIHJnYmEoMjU1LCAyNTUsIDI1NSwgMC4yKSwgcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjA1KSk7IC8qIFdoaXRlIEFjdGl2ZSBUYWIgKi8KICAgICAgICAgICAgY29sb3I6ICNmZmY7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA2MDA7CiAgICAgICAgfQoKICAgICAgICAvKiBDb250ZW50IGFyZWEgKi8KICAgICAgICAjc3BlY3RyYS1jb250ZW50IHsKICAgICAgICAgICAgZmxleDogMTsKICAgICAgICAgICAgcGFkZGluZzogMTZweDsKICAgICAgICAgICAgb3ZlcmZsb3cteTogYXV0bzsKICAgICAgICB9CiAgICAgICAgLnNwZWN0cmEtY2F0ZWdvcnktdGl0bGUgewogICAgICAgICAgICBmb250LXNpemU6IDE1cHg7CiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4OwogICAgICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEyKTsKICAgICAgICAgICAgcGFkZGluZy1ib3R0b206IDRweDsKICAgICAgICB9CgogICAgICAgIC8qIFRvZ2dsZXMgKi8KICAgICAgICAuc3BlY3RyYS10b2dnbGUgewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4wNCk7CiAgICAgICAgICAgIHBhZGRpbmc6IDhweCAxMnB4OwogICAgICAgICAgICBtYXJnaW46IDVweCAwOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIHRyYW5zaXRpb246IGJhY2tncm91bmQgMC4yczsKICAgICAgICB9CiAgICAgICAgLnNwZWN0cmEtYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogcmdiYSgyNTUsMjU1LDI1NSwwLjA0KTsKICAgICAgICAgICAgcGFkZGluZzogOHB4IDEycHg7CiAgICAgICAgICAgIG1hcmdpbjogNXB4IDA7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgdHJhbnNpdGlvbjogYmFja2dyb3VuZCAwLjJzOwogICAgICAgICAgICBjb2xvcjogd2hpdGU7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgyNTUsMjU1LDI1NSwwLjEpOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgfQogICAgICAgIC5zcGVjdHJhLWJ1dHRvbjpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7CiAgICAgICAgfQogICAgICAgIC5zcGVjdHJhLXRvZ2dsZTpob3ZlciB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMjU1LDI1NSwyNTUsMC4wOCk7CiAgICAgICAgfQogICAgICAgIC5zcGVjdHJhLXRvZ2dsZSBsYWJlbCB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICB9CiAgICAgICAgLnNwZWN0cmEtdG9nZ2xlIGlucHV0IHsKICAgICAgICAgICAgYXBwZWFyYW5jZTogbm9uZTsKICAgICAgICAgICAgd2lkdGg6IDM0cHg7CiAgICAgICAgICAgIGhlaWdodDogMThweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzQ0NDsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMjBweDsKICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIHRyYW5zaXRpb246IDAuM3M7CiAgICAgICAgfQogICAgICAgIC5zcGVjdHJhLXRvZ2dsZSBpbnB1dDpjaGVja2VkIHsKICAgICAgICAgICAgYmFja2dyb3VuZDogIzRDQUY1MDsgLyogR3JlZW4gVG9nZ2xlICovCiAgICAgICAgfQogICAgICAgIC5zcGVjdHJhLXRvZ2dsZSBpbnB1dDo6YmVmb3JlIHsKICAgICAgICAgICAgY29udGVudDogIiI7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgdG9wOiAycHg7IGxlZnQ6IDJweDsKICAgICAgICAgICAgd2lkdGg6IDE0cHg7IGhlaWdodDogMTRweDsKICAgICAgICAgICAgYmFja2dyb3VuZDogYmxhY2s7CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsKICAgICAgICAgICAgdHJhbnNpdGlvbjogMC4zczsKICAgICAgICB9CiAgICAgICAgLnNwZWN0cmEtdG9nZ2xlIGlucHV0OmNoZWNrZWQ6OmJlZm9yZSB7CiAgICAgICAgICAgIGxlZnQ6IDE4cHg7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgICAgICAgfQoKICAgICAgICAuaGlkZGVuIHsgZGlzcGxheTogbm9uZTsgfQogICAgYDsKICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpOwoKICAgIC8vIC0tLSBVSSAtLS0KICAgIGNvbnN0IHVpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICB1aS5pZCA9ICJzcGVjdHJhLXVpIjsKICAgIHVpLmlubmVySFRNTCA9IGAKICAgICAgICA8ZGl2IGlkPSJzcGVjdHJhLWV4aXQtYnRuIj7inJY8L2Rpdj4KICAgICAgICA8ZGl2IGlkPSJzcGVjdHJhLXNpZGViYXIiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2dvLXdyYXAiPgogICAgICAgICAgICAgICAgPGltZyBzcmM9Imh0dHBzOi8vZmlsZS5nYXJkZW4vYUtQMDRuUEotMEgwWDNIRS8xMDAwMzMzOTY1LXJlbW92ZWJnLXByZXZpZXcucG5nIiBhbHQ9IlNwZWN0cmEgTG9nbyI+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLXRhYiBhY3RpdmUiIGRhdGEtdGFiPSJtYWluIj4ke2ljb25zLm1haW59PHNwYW4+TWFpbjwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10YWIiIGRhdGEtdGFiPSJ2aXN1YWxzIj4ke2ljb25zLnZpc3VhbHN9PHNwYW4+VmlzdWFsczwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10YWIiIGRhdGEtdGFiPSJleHBlcmltZW50YWwiPiR7aWNvbnMuZXhwZXJpbWVudGFsfTxzcGFuPkV4cGVyaW1lbnRhbDwvc3Bhbj48L2Rpdj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10YWIiIGRhdGEtdGFiPSJzZXR0aW5ncyI+JHtpY29ucy5zZXR0aW5nc308c3Bhbj5TZXR0aW5nczwvc3Bhbj48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGlkPSJzcGVjdHJhLWNvbnRlbnQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLWNhdGVnb3J5IiBkYXRhLXRhYi1jb250ZW50PSJtYWluIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtY2F0ZWdvcnktdGl0bGUiPk1haW48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+S2lsbGF1cmE8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2sta2lsbGF1cmEiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5TcGlkZXI8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stc3BpZGVyIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+SmVzdXM8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stamVzdXMiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5CSE9QPC9sYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJoYWNrLWJob3AiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5TY2FmZm9sZDwvbGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iaGFjay1zY2FmZm9sZCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLXRvZ2dsZSI+PGxhYmVsPldhbGxqdW1wPC9sYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJoYWNrLXdhbGxqdW1wIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+V2F0ZXJqdW1wPC9sYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJoYWNrLXdhdGVyanVtcCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLXRvZ2dsZSI+PGxhYmVsPk5vY2xpcCBNb3ZlPC9sYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJoYWNrLW5vY2xpcC1tb3ZlIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+S2lsbCBTb2Z0bHk8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2sta2lsbC1zb2Z0bHkiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5CSE9QIEtuaWZlPC9sYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJoYWNrLWJob3Ata25pZmUiPjwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ic3BlY3RyYS1idXR0b24iIGlkPSJoYWNrLWF1dG8tc3ciPkF1dG8gU1c8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InNwZWN0cmEtYnV0dG9uIiBpZD0iaGFjay1ub2NsaXAtcGxhY2UiPk5vY2xpcCBQbGFjZTwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ic3BlY3RyYS1idXR0b24iIGlkPSJoYWNrLWhpZ2gtanVtcCI+SGlnaCBKdW1wPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJzcGVjdHJhLWJ1dHRvbiIgaWQ9ImhhY2steHAtZHVwZXIiPlhQIER1cGVyPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS1jYXRlZ29yeSBoaWRkZW4iIGRhdGEtdGFiLWNvbnRlbnQ9InZpc3VhbHMiPgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS1jYXRlZ29yeS10aXRsZSI+VmlzdWFsczwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5FU1A8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stZXNwIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+Q2hlc3QgRVNQPC9sYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJoYWNrLWNoZXN0LWVzcCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLXRvZ2dsZSI+PGxhYmVsPk9yZSBFU1A8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stb3JlLWVzcCI+PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLXRvZ2dsZSI+PGxhYmVsPkhpdGJveGVzPC9sYWJlbD48aW5wdXQgdHlwZT0iY2hlY2tib3giIGlkPSJoYWNrLWhpdGJveGVzIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+TmFtZXRhZ3M8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stbmFtZXRhZ3MiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5FbmVteSBIZWFsdGg8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stZW5lbXktaGVhbHRoIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+TmlnaHQ8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stbmlnaHQiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5CaWdoZWFkczwvbGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iaGFjay1iaWdoZWFkcyI+PC9kaXY+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS1jYXRlZ29yeSBoaWRkZW4iIGRhdGEtdGFiLWNvbnRlbnQ9ImV4cGVyaW1lbnRhbCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLWNhdGVnb3J5LXRpdGxlIj5FeHBlcmltZW50YWw8L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+Qmxpbms8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stYmxpbmsiPjwvZGl2PgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS10b2dnbGUiPjxsYWJlbD5QaWNrdXAgUmVhY2g8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stcGlja3VwLXJlYWNoIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtdG9nZ2xlIj48bGFiZWw+QW50aS1TcGlrZTwvbGFiZWw+PGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iaGFjay1hbnRpLXNwaWtlIj48L2Rpdj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InNwZWN0cmEtYnV0dG9uIiBpZD0iaGFjay1zcGF3bi10ZWxlcG9ydCI+L3NwYXduIFRlbGVwb3J0PC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJzcGVjdHJhLWJ1dHRvbiIgaWQ9ImhhY2stYW50aS13ZWIiPkFudGktV2ViPC9idXR0b24+CiAgICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgICAgPGRpdiBjbGFzcz0ic3BlY3RyYS1jYXRlZ29yeSBoaWRkZW4iIGRhdGEtdGFiLWNvbnRlbnQ9InNldHRpbmdzIj4KICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwZWN0cmEtY2F0ZWdvcnktdGl0bGUiPlNldHRpbmdzPC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcGVjdHJhLXRvZ2dsZSI+PGxhYmVsPkFudGktQmFuIChTYWZlcik8L2xhYmVsPjxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9ImhhY2stYW50aS1iYW4iPjwvZGl2PgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ic3BlY3RyYS1idXR0b24iIGlkPSJoYWNrLWhlYWx0aC1jb2xvciI+U2V0IEhlYWx0aCBDb2xvcjwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ic3BlY3RyYS1idXR0b24iIGlkPSJoYWNrLXJhbmtzIj5TcG9vZiBSYW5rczwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ic3BlY3RyYS1idXR0b24iIGlkPSJoYWNrLXBsYXllci1jb29yZHMiPlNob3cgUGxheWVyIENvb3JkczwvYnV0dG9uPgogICAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ic3BlY3RyYS1idXR0b24iIGlkPSJoYWNrLXB1cmdlLWNvb2tpZXMiPlB1cmdlIENvb2tpZXMgJiBSZWxvYWQ8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDxidXR0b24gY2xhc3M9InNwZWN0cmEtYnV0dG9uIiBpZD0iaGFjay1kaXNjb3JkIj5EaXNjb3JkPC9idXR0b24+CiAgICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJzcGVjdHJhLWJ1dHRvbiIgaWQ9ImhhY2stdW5iYW4iPkF0dGVtcHQgVW5iYW4gKFJlbG9hZCk8L2J1dHRvbj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICBgOwogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh1aSk7CgogICAgLy8gLS0tIENyZWF0ZSBhbmQgYXBwZW5kIHRoZSBmbG9hdGluZyByZW9wZW4gYnV0dG9uIC0tLQogICAgY29uc3QgcmVvcGVuQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICByZW9wZW5CdG4uaWQgPSAic3BlY3RyYS1yZW9wZW4tYnRuIjsKICAgIHJlb3BlbkJ0bi5pbm5lckhUTUwgPSAn4piwJzsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVvcGVuQnRuKTsKCiAgICAvLyAtLS0gU2lkZWJhciBsb2dpYyAtLS0KICAgIGNvbnN0IHRhYnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCIuc3BlY3RyYS10YWIiKTsKICAgIGNvbnN0IGNvbnRlbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiW2RhdGEtdGFiLWNvbnRlbnRdIik7CgogICAgdGFicy5mb3JFYWNoKCh0YWIpID0+IHsKICAgICAgICB0YWIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgIHRhYnMuZm9yRWFjaCgodCkgPT4gdC5jbGFzc0xpc3QucmVtb3ZlKCJhY3RpdmUiKSk7CiAgICAgICAgICAgIHRhYi5jbGFzc0xpc3QuYWRkKCJhY3RpdmUiKTsKCiAgICAgICAgICAgIGNvbnN0IHRhcmdldCA9IHRhYi5nZXRBdHRyaWJ1dGUoImRhdGEtdGFiIik7CiAgICAgICAgICAgIGNvbnRlbnRzLmZvckVhY2goKGMpID0+IHsKICAgICAgICAgICAgICAgIGMuY2xhc3NMaXN0LmFkZCgiaGlkZGVuIik7CiAgICAgICAgICAgICAgICBpZiAoYy5nZXRBdHRyaWJ1dGUoImRhdGEtdGFiLWNvbnRlbnQiKSA9PT0gdGFyZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgYy5jbGFzc0xpc3QucmVtb3ZlKCJoaWRkZW4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyAtLS0gVUkgQ29udHJvbHMgTG9naWMgLS0tCiAgICBjb25zdCBleGl0QnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNwZWN0cmEtZXhpdC1idG4iKTsKICAgIGNvbnN0IG1haW5VSSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzcGVjdHJhLXVpIik7CgogICAgaWYgKGV4aXRCdG4gJiYgcmVvcGVuQnRuICYmIG1haW5VSSkgewogICAgICAgIC8vIEV2ZW50IHRvIGhpZGUgdGhlIG1haW4gVUkgYW5kIHNob3cgdGhlIHJlb3BlbiBidXR0b24KICAgICAgICBleGl0QnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgICBtYWluVUkuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgICAgICAgcmVvcGVuQnRuLnN0eWxlLmRpc3BsYXkgPSAiZmxleCI7IC8vIFVzZSAnZmxleCcgdG8gY2VudGVyIHRoZSBpY29uCiAgICAgICAgfSk7CgogICAgICAgIC8vIEV2ZW50IHRvIHNob3cgdGhlIG1haW4gVUkgYW5kIGhpZGUgdGhlIHJlb3BlbiBidXR0b24KICAgICAgICByZW9wZW5CdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICAgIHJlb3BlbkJ0bi5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgICBtYWluVUkuc3R5bGUuZGlzcGxheSA9ICJmbGV4IjsgLy8gUmVzdG9yZSBvcmlnaW5hbCBkaXNwbGF5IHByb3BlcnR5CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gLS0tIE5FVyBIQUNLIE1PRFVMRVMgLS0tCiAgICBjbGFzcyBNb2R1bGUgewogICAgICAgIGNvbnN0cnVjdG9yKG5hbWUpIHsgdGhpcy5uYW1lID0gbmFtZTsgdGhpcy5pc0VuYWJsZWQgPSBmYWxzZTsgfQogICAgICAgIG9uRW5hYmxlKCkge30KICAgICAgICBvbkRpc2FibGUoKSB7fQogICAgICAgIGVuYWJsZSgpIHsgdGhpcy5pc0VuYWJsZWQgPSB0cnVlOyB0aGlzLm9uRW5hYmxlKCk7IH0KICAgICAgICBkaXNhYmxlKCkgeyB0aGlzLmlzRW5hYmxlZCA9IGZhbHNlOyB0aGlzLm9uRGlzYWJsZSgpOyB9CiAgICAgICAgdG9nZ2xlKCkgeyB0aGlzLmlzRW5hYmxlZCA/IHRoaXMuZGlzYWJsZSgpIDogdGhpcy5lbmFibGUoKTsgfQogICAgfQoKICAgIGNsYXNzIEFudGlTcGlrZSBleHRlbmRzIE1vZHVsZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7IHN1cGVyKCJBbnRpU3Bpa2UiKTsgfQogICAgICAgIG9uRW5hYmxlKCkgewogICAgICAgICAgICBsZXQgaXRlbXMgPSByLnZhbHVlcyhyLnZhbHVlcyhsLmZpbmRNb2R1bGUoIkd1bjpjbGFzcyIpKS5maW5kKG8gPT4gdHlwZW9mIG8gPT0gIm9iamVjdCIpKTsKICAgICAgICAgICAgbGV0IHJlZ2lzdHJ5S2V5ID0gci5rZXlzKG4ubm9hLnJlZ2lzdHJ5KVsxMl07CiAgICAgICAgICAgIGl0ZW1zLmZpbHRlcihvID0+IG8ubmFtZS5pbmNsdWRlcygiU3Bpa2VzIikpLmZvckVhY2gobyA9PiB7IG4ubm9hLnJlZ2lzdHJ5W3JlZ2lzdHJ5S2V5XVtvLmlkXSA9IHRydWU7IH0pOwogICAgICAgIH0KICAgICAgICBvbkRpc2FibGUoKSB7CiAgICAgICAgICAgIGxldCBpdGVtcyA9IHIudmFsdWVzKHIudmFsdWVzKGwuZmluZE1vZHVsZSgiR3VuOmNsYXNzIikpLmZpbmQobyA9PiB0eXBlb2YgbyA9PSAib2JqZWN0IikpOwogICAgICAgICAgICBsZXQgcmVnaXN0cnlLZXkgPSByLmtleXMobi5ub2EucmVnaXN0cnkpWzEyXTsKICAgICAgICAgICAgaXRlbXMuZmlsdGVyKG8gPT4gby5uYW1lLmluY2x1ZGVzKCJTcGlrZXMiKSkuZm9yRWFjaChvID0+IHsgbi5ub2EucmVnaXN0cnlbcmVnaXN0cnlLZXldW28uaWRdID0gZmFsc2U7IH0pOwogICAgICAgIH0KICAgIH0KCiAgICBjbGFzcyBTcGlkZXIgZXh0ZW5kcyBNb2R1bGUgewogICAgICAgIGNvbnN0cnVjdG9yKCkgeyBzdXBlcigiU3BpZGVyIik7IH0KICAgICAgICBvblJlbmRlcigpIHsKICAgICAgICAgICAgaWYgKGwubm9hLmlucHV0cy5zdGF0ZS5qdW1wICYmIG4ubm9hLnRvdWNoaW5nV2FsbCgpKSB7CiAgICAgICAgICAgICAgICBuLm5vYS5zZXRWZWxvY2l0eShudWxsLCA1LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBjbGFzcyBLaWxsYXVyYSBleHRlbmRzIE1vZHVsZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7CiAgICAgICAgICAgIHN1cGVyKCJLaWxsYXVyYSIpOwogICAgICAgICAgICB0aGlzLmxhc3RFeGVjdXRpb25UaW1lID0gMDsKICAgICAgICAgICAgdGhpcy5kZWxheSA9IDEwMDsKICAgICAgICB9CiAgICAgICAgb25SZW5kZXIoKSB7CiAgICAgICAgICAgIGxldCBub3cgPSBEYXRlLm5vdygpOwogICAgICAgICAgICBpZiAobm93IC0gdGhpcy5sYXN0RXhlY3V0aW9uVGltZSA+PSB0aGlzLmRlbGF5KSB7CiAgICAgICAgICAgICAgICB0aGlzLmxhc3RFeGVjdXRpb25UaW1lID0gbm93OwogICAgICAgICAgICAgICAgdGhpcy50cnlLaWxsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdHJ5S2lsbCgpIHsKICAgICAgICAgICAgbGV0IG15UG9zID0gbi5ub2EuZ2V0UG9zaXRpb24oMSk7CiAgICAgICAgICAgIGNvbnN0IGtpbGxSYWRpdXMgPSBhbnRpQmFuRW5hYmxlZCA/IDQuNSA6IDc7CiAgICAgICAgICAgIG4ubm9hLnBsYXllckxpc3QuZm9yRWFjaChwbGF5ZXJJZCA9PiB7CiAgICAgICAgICAgICAgICBsZXQgZW5lbXlQb3MgPSBuLm5vYS5nZXRQb3NpdGlvbihwbGF5ZXJJZCk7CiAgICAgICAgICAgICAgICBpZiAoZW5lbXlQb3MgJiYgUy5kaXN0YW5jZUJldHdlZW5TcXJ0KG15UG9zLCBlbmVteVBvcykgPD0ga2lsbFJhZGl1cykgewogICAgICAgICAgICAgICAgICAgIGxldCB2ZWN0b3IgPSBTLm5vcm1hbGl6ZVZlY3RvcihbZW5lbXlQb3NbMF0gLSBteVBvc1swXSwgZW5lbXlQb3NbMV0gLSBteVBvc1sxXSwgZW5lbXlQb3NbMl0gLSBteVBvc1syXV0pOwogICAgICAgICAgICAgICAgICAgIG4ubm9hLmRvQXR0YWNrKHZlY3RvciwgcGxheWVySWQudG9TdHJpbmcoKSwgIkJvZHlNZXNoIik7CiAgICAgICAgICAgICAgICAgICAgbi5ub2EuZ2V0SGVsZEl0ZW0oMSk/LnRyeVN3aW5nQmxvY2s/LigpOwogICAgICAgICAgICAgICAgICAgIG4ubm9hLmdldE1vdmVTdGF0ZSgxKT8uc2V0QXJtc0FyZVN3aW5naW5nPy4oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIGNsYXNzIEplc3VzIGV4dGVuZHMgTW9kdWxlIHsKICAgICAgICBjb25zdHJ1Y3RvcigpIHsgc3VwZXIoIkplc3VzIik7IH0KICAgICAgICBvbkVuYWJsZSgpIHsKICAgICAgICAgICAgbGV0IGl0ZW1zID0gci52YWx1ZXMoci52YWx1ZXMobC5maW5kTW9kdWxlKCJHdW46Y2xhc3MiKSkuZmluZChvID0+IHR5cGVvZiBvID09ICJvYmplY3QiKSk7CiAgICAgICAgICAgIGxldCByZWdpc3RyeUtleSA9IHIua2V5cyhuLm5vYS5yZWdpc3RyeSlbMTJdOwogICAgICAgICAgICBuLm5vYS5yZWdpc3RyeVtyZWdpc3RyeUtleV1baXRlbXMuZmluZChvID0+IG8ubmFtZSA9PSAiV2F0ZXIiKS5pZF0gPSB0cnVlOwogICAgICAgICAgICBuLm5vYS5yZWdpc3RyeVtyZWdpc3RyeUtleV1baXRlbXMuZmluZChvID0+IG8ubmFtZSA9PSAiTGF2YSIpLmlkXSA9IHRydWU7CiAgICAgICAgfQogICAgICAgIG9uRGlzYWJsZSgpIHsKICAgICAgICAgICAgbGV0IGl0ZW1zID0gci52YWx1ZXMoci52YWx1ZXMobC5maW5kTW9kdWxlKCJHdW46Y2xhc3MiKSkuZmluZChvID0+IHR5cGVvZiBvID09ICJvYmplY3QiKSk7CiAgICAgICAgICAgIGxldCByZWdpc3RyeUtleSA9IHIua2V5cyhuLm5vYS5yZWdpc3RyeSlbMTJdOwogICAgICAgICAgICBuLm5vYS5yZWdpc3RyeVtyZWdpc3RyeUtleV1baXRlbXMuZmluZChvID0+IG8ubmFtZSA9PSAiV2F0ZXIiKS5pZF0gPSBmYWxzZTsKICAgICAgICAgICAgbi5ub2EucmVnaXN0cnlbcmVnaXN0cnlLZXldW2l0ZW1zLmZpbmQobyA9PiBvLm5hbWUgPT0gIkxhdmEiKS5pZF0gPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgY2xhc3MgVW5iYW4gZXh0ZW5kcyBNb2R1bGUgewogICAgICAgIGNvbnN0cnVjdG9yKCkgeyBzdXBlcigiVW5iYW4iKTsgfQogICAgICAgIG9uRW5hYmxlKCkgewogICAgICAgICAgICBkb2N1bWVudC5jb29raWUuc3BsaXQoIjsiKS5mb3JFYWNoKGZ1bmN0aW9uKGMpIHsgZG9jdW1lbnQuY29va2llID0gYy5yZXBsYWNlKC9eICsvLCAiIikucmVwbGFjZSgvPS4qLywgIj07ZXhwaXJlcz0iICsgbmV3IERhdGUoKS50b1VUQ1N0cmluZygpICsgIjtwYXRoPS8iKTsgfSk7CiAgICAgICAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgICAgIH0KICAgIH0KCiAgICBjbGFzcyBIaWdoSnVtcCBleHRlbmRzIE1vZHVsZSB7CiAgICAgICAgY29uc3RydWN0b3IoKSB7IHN1cGVyKCJIaWdoSnVtcCIpOyB9CiAgICAgICAgb25FbmFibGUoKSB7CiAgICAgICAgICAgIG4ubm9hLnNldFZlbG9jaXR5KG51bGwsIDQwLCBudWxsKTsKICAgICAgICB9CiAgICB9CgogICAgY29uc3QgbmV3SGFja3MgPSB7CiAgICAgICAgYW50aVNwaWtlOiBuZXcgQW50aVNwaWtlKCksCiAgICAgICAgc3BpZGVyOiBuZXcgU3BpZGVyKCksCiAgICAgICAga2lsbGF1cmE6IG5ldyBLaWxsYXVyYSgpLAogICAgICAgIGplc3VzOiBuZXcgSmVzdXMoKSwKICAgICAgICB1bmJhbjogbmV3IFVuYmFuKCksCiAgICAgICAgaGlnaEp1bXA6IG5ldyBIaWdoSnVtcCgpCiAgICB9OwoKICAgIC8vIC0tLSBIQUNLIExPR0lDICYgV0lSSU5HIC0tLQogICAgZnVuY3Rpb24gc2V0dXBIYWNrRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGVuc3VyZSBpbmplY3Rpb24gYmVmb3JlIGFjdGl2YXRpb24KICAgICAgICBjb25zdCBwcmVDaGVjayA9IChmZWF0dXJlTmFtZSwgY2hlY2tib3hFbGVtZW50KSA9PiB7CiAgICAgICAgICAgIGlmICghaW5qZWN0ZWRCb29sKSB7CiAgICAgICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKGDinYwgSW5qZWN0IGZpcnN0IHRvIHVzZSAke2ZlYXR1cmVOYW1lfSFgKTsKICAgICAgICAgICAgICAgIGlmIChjaGVja2JveEVsZW1lbnQpIGNoZWNrYm94RWxlbWVudC5jaGVja2VkID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfTsKCiAgICAgICAgLy8gLS0tIEFic3RyYWN0aW9uIGZvciBUb2dnbGVzL0J1dHRvbnMgLS0tCiAgICAgICAgY29uc3Qgc2V0dXBSZW5kZXJUb2dnbGUgPSAoaWQsIG1vZHVsZSkgPT4gewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gewogICAgICAgICAgICAgICAgaWYgKCFwcmVDaGVjayhtb2R1bGUubmFtZSwgZS50YXJnZXQpKSByZXR1cm47CiAgICAgICAgICAgICAgICBtb2R1bGUuaXNFbmFibGVkID0gZS50YXJnZXQuY2hlY2tlZDsKICAgICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZHVsZS5vbkVuYWJsZSkgbW9kdWxlLm9uRW5hYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1vZHVsZS5vblJlbmRlciAmJiAhbW9kdWxlc1RvUmVuZGVyLmluY2x1ZGVzKG1vZHVsZSkpIG1vZHVsZXNUb1JlbmRlci5wdXNoKG1vZHVsZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGlmIChtb2R1bGUub25EaXNhYmxlKSBtb2R1bGUub25EaXNhYmxlKCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBtb2R1bGVzVG9SZW5kZXIuaW5kZXhPZihtb2R1bGUpOwogICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+IC0xKSBtb2R1bGVzVG9SZW5kZXIuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oYCR7bW9kdWxlLm5hbWV9ICR7bW9kdWxlLmlzRW5hYmxlZCA/ICdlbmFibGVkJyA6ICdkaXNhYmxlZCd9YCk7CiAgICAgICAgICAgIH0pOwogICAgICAgIH07CgogICAgICAgIGNvbnN0IHNldHVwU2ltcGxlVG9nZ2xlID0gKGlkLCBtb2R1bGUpID0+IHsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHsKICAgICAgICAgICAgICAgIGlmICghcHJlQ2hlY2sobW9kdWxlLm5hbWUsIGUudGFyZ2V0KSkgcmV0dXJuOwogICAgICAgICAgICAgICAgbW9kdWxlLnRvZ2dsZSgpOwogICAgICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbihgJHttb2R1bGUubmFtZX0gJHttb2R1bGUuaXNFbmFibGVkID8gJ2VuYWJsZWQnIDogJ2Rpc2FibGVkJ31gKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfTsKCiAgICAgICAgY29uc3Qgc2V0dXBCdXR0b24gPSAoaWQsIG1vZHVsZSkgPT4gewogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFwcmVDaGVjayhtb2R1bGUubmFtZSkpIHJldHVybjsKICAgICAgICAgICAgICAgIG1vZHVsZS5lbmFibGUoKTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oYCR7bW9kdWxlLm5hbWV9IHRyaWdnZXJlZGApOwogICAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICAvLyAtLS0gV2lyZSB1cCBOZXcgSGFja3MgLS0tCiAgICAgICAgc2V0dXBSZW5kZXJUb2dnbGUoJ2hhY2sta2lsbGF1cmEnLCBuZXdIYWNrcy5raWxsYXVyYSk7CiAgICAgICAgc2V0dXBSZW5kZXJUb2dnbGUoJ2hhY2stc3BpZGVyJywgbmV3SGFja3Muc3BpZGVyKTsKICAgICAgICBzZXR1cFNpbXBsZVRvZ2dsZSgnaGFjay1qZXN1cycsIG5ld0hhY2tzLmplc3VzKTsKICAgICAgICBzZXR1cFNpbXBsZVRvZ2dsZSgnaGFjay1hbnRpLXNwaWtlJywgbmV3SGFja3MuYW50aVNwaWtlKTsKICAgICAgICBzZXR1cEJ1dHRvbignaGFjay1oaWdoLWp1bXAnLCBuZXdIYWNrcy5oaWdoSnVtcCk7CiAgICAgICAgc2V0dXBCdXR0b24oJ2hhY2stdW5iYW4nLCBuZXdIYWNrcy51bmJhbik7CgogICAgICAgIC8vIC0tLSBXaXJlIHVwIE9sZCBIYWNrcyAtLS0KICAgICAgICAvLyBOb3RlOiBUaGUgb2xkICJLaWxsIEF1cmEiIGlzIHJlcGxhY2VkIGJ5IHRoZSBuZXcgb25lLgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLWJob3AnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgIGlmICghcHJlQ2hlY2soIkJIT1AiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgIGJob3BJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoYnVubnlIb3AsIDEwKTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIkJIT1AgZW5hYmxlZCIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChiaG9wSW50ZXJ2YWxJZCk7CiAgICAgICAgICAgICAgICBiaG9wSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCJCSE9QIGRpc2FibGVkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hhY2stc2NhZmZvbGQnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgIGlmICghcHJlQ2hlY2soIlNjYWZmb2xkIiwgZS50YXJnZXQpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICBzY2FmZm9sZEludGVydmFsSWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zID0gRnV4bnkuZW50aXRpZXMuZ2V0U3RhdGUoMSwgJ3Bvc2l0aW9uJykucG9zaXRpb247CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwb3MgfHwgIXBsYXllckVudGl0eSB8fCBwbGF5ZXJFbnRpdHkuaGVsZEl0ZW1TdGF0ZS5oZWxkVHlwZSAhPT0gIkN1YmVCbG9jayIpIHJldHVybjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBleGFjdFggPSBwb3NbMF0sIGV4YWN0WiA9IHBvc1syXTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9ja1ggPSBNYXRoLmZsb29yKGV4YWN0WCksIGJsb2NrWSA9IE1hdGguZmxvb3IocG9zWzFdKSwgYmxvY2taID0gTWF0aC5mbG9vcihleGFjdFopOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoZWNrUGxhY2UgPSAoeCwgeSwgeikgPT4gKHBsYXllckVudGl0eS5jaGVja1RhcmdldGVkQmxvY2tDYW5CZVBsYWNlZE92ZXIoW3gsIHksIHpdKSB8fCByLnZhbHVlcyhGdXhueS53b3JsZClbNDddLmNhbGwoRnV4bnkud29ybGQsIHgsIHksIHopID09PSAwKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tQbGFjZShibG9ja1gsIGJsb2NrWSAtIDEsIGJsb2NrWikpIHsgd2FuZ1BsYWNlKFtibG9ja1gsIGJsb2NrWSAtIDEsIGJsb2NrWl0pOyByZXR1cm47IH0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IGV4YWN0WCAtIGJsb2NrWCwgZHogPSBleGFjdFogLSBibG9ja1o7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0cyA9IFtdOwogICAgICAgICAgICAgICAgICAgIGlmIChkeCA8IDAuMykgb2Zmc2V0cy5wdXNoKFstMSwgMF0pOyBpZiAoZHggPiAwLjcpIG9mZnNldHMucHVzaChbMSwgMF0pOwogICAgICAgICAgICAgICAgICAgIGlmIChkeiA8IDAuMykgb2Zmc2V0cy5wdXNoKFswLCAtMV0pOyBpZiAoZHogPiAwLjcpIG9mZnNldHMucHVzaChbMCwgMV0pOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgW294LCBvel0gb2Ygb2Zmc2V0cykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBueCA9IGJsb2NrWCArIG94LCBueiA9IGJsb2NrWiArIG96OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hlY2tQbGFjZShueCwgYmxvY2tZIC0gMSwgbnopKSB7IHdhbmdQbGFjZShbbngsIGJsb2NrWSAtIDEsIG56XSk7IHJldHVybjsgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDUwKTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIlNjYWZmb2xkIGVuYWJsZWQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoc2NhZmZvbGRJbnRlcnZhbElkKTsKICAgICAgICAgICAgICAgIHNjYWZmb2xkSW50ZXJ2YWxJZCA9IG51bGw7CiAgICAgICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCJTY2FmZm9sZCBkaXNhYmxlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLXdhbGxqdW1wJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJXYWxsanVtcCIsIGUudGFyZ2V0KSkgcmV0dXJuOwogICAgICAgICAgICBjb25zdCBjbGllbnQgPSBGdXhueT8uY2xpZW50T3B0aW9ucywgYm9keSA9IEZ1eG55Py5waHlzaWNzPy5ib2RpZXM/LlswXTsKICAgICAgICAgICAgaWYgKCFjbGllbnQgfHwgIWJvZHkpIHJldHVybjsKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHsKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjbGllbnQsICJhaXJKdW1wQ291bnQiLCB7IGdldDogKCkgPT4geyBpZiAoIWJvZHkucmVzdGluZykgcmV0dXJuIDA7IGNvbnN0IFtyeCwgLCByel0gPSBib2R5LnJlc3Rpbmc7IHJldHVybiAocnggPT09IDEgfHwgcnggPT09IC0xIHx8IHJ6ID09PSAxIHx8IHJ6ID09PSAtMSkgPyA5OTkgOiAwOyB9LCBzZXQoXykge30sIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIldhbGxqdW1wIGVuYWJsZWQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjbGllbnQsICJhaXJKdW1wQ291bnQiLCB7IHZhbHVlOiAwLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiV2FsbGp1bXAgZGlzYWJsZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay13YXRlcmp1bXAnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJXYXRlcmp1bXAiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgIGNvbnN0IGMgPSBGdXhueT8uZW50aXRpZXM/LltGdXhueS5pbXBLZXldPy5tb3ZlbWVudD8ubGlzdD8uWzBdOwogICAgICAgICAgICAgaWYgKCFjKSByZXR1cm47CiAgICAgICAgICAgICBpZihlLnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAiaW5BaXJGcm9tV2F0ZXIiLCB7IGdldDogKCkgPT4gZmFsc2UsIHNldDogKCkgPT4ge30sIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYywgIl9qdW1wQ291bnQiLCB7IGdldDogKCkgPT4gMCwgc2V0OiAoKSA9PiB7fSwgY29uZmlndXJhYmxlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAiX3RpY2tzT3V0T2ZXYXRlciIsIHsgZ2V0OiAoKSA9PiAzNDYsIHNldDogKCkgPT4ge30sIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYywgImlzT25JY2UiLCB7IGdldDogKCkgPT4gdHJ1ZSwgc2V0OiAoKSA9PiB7fSwgY29uZmlndXJhYmxlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIldhdGVyanVtcCBlbmFibGVkIik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5lcnJvcigiRXJyb3IgZW5hYmxpbmcgd2F0ZXJqdW1wOiIsIGVycik7IH0KICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAiaW5BaXJGcm9tV2F0ZXIiLCB7IHZhbHVlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYywgIl9qdW1wQ291bnQiLCB7IHZhbHVlOiAwLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShjLCAiX3RpY2tzT3V0T2ZXYXRlciIsIHsgdmFsdWU6IDAsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSk7CiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGMsICJpc09uSWNlIiwgeyB2YWx1ZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSk7CiAgICAgICAgICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiV2F0ZXJqdW1wIGRpc2FibGVkIik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5lcnJvcigiRXJyb3IgZGlzYWJsaW5nIHdhdGVyanVtcDoiLCBlcnIpOyB9CiAgICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLW5vY2xpcC1tb3ZlJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJOb2NsaXAgTW92ZSIsIGUudGFyZ2V0KSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2hlY2tlZCkgeyBzdGFydE1vdmluZygpOyBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCJOb2NsaXAgTW92ZSBlbmFibGVkIik7IH0KICAgICAgICAgICAgZWxzZSB7IHN0b3BNb3ZpbmcoKTsgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiTm9jbGlwIE1vdmUgZGlzYWJsZWQiKTsgfQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1raWxsLXNvZnRseScpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHsKICAgICAgICAgICAgaWYgKCFwcmVDaGVjaygiS2lsbCBTb2Z0bHkiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmNoZWNrZWQpIHsgcGxheWVyRW50aXR5LmhlbGRJdGVtU3RhdGUuc3dpbmdEdXJhdGlvbiA9IDE1MDA7IHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIktpbGwgU29mdGx5IGVuYWJsZWQiKTsgfQogICAgICAgICAgICBlbHNlIHsgcGxheWVyRW50aXR5LmhlbGRJdGVtU3RhdGUuc3dpbmdEdXJhdGlvbiA9IDIwMDsgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiS2lsbCBTb2Z0bHkgZGlzYWJsZWQiKTsgfQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1iaG9wLWtuaWZlJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJCSE9QIEtuaWZlIiwgZS50YXJnZXQpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICBiaG9wS25pZmVFbmFibGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHNwYWNlVmlkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKTsKICAgICAgICAgICAgICAgIHNwYWNlVmlkLnNyYyA9ICdodHRwczovL2ZpbGVzLmNhdGJveC5tb2UvNnRtNGU3LndlYm0nOwogICAgICAgICAgICAgICAgc3BhY2VWaWQucHJlbG9hZCA9ICdhdXRvJzsgc3BhY2VWaWQubG9vcCA9IHRydWU7IHNwYWNlVmlkLm11dGVkID0gZmFsc2U7IHNwYWNlVmlkLnZvbHVtZSA9IDA7IHNwYWNlVmlkLnBsYXliYWNrUmF0ZSA9IDE7IHNwYWNlVmlkLnBsYXlzSW5saW5lID0gdHJ1ZTsKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oc3BhY2VWaWQuc3R5bGUsIHsgcG9zaXRpb246ICdmaXhlZCcsIHRvcDogJzUwJScsIGxlZnQ6ICc1MCUnLCB3aWR0aDogJzEwMHZ3JywgaGVpZ2h0OiAnMTAwdmgnLCBvYmplY3RGaXQ6ICdjb3ZlcicsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgtNTAlLCAtNTAlKSBzY2FsZVgoMS40KScsIHpJbmRleDogMjEsIHBvaW50ZXJFdmVudHM6ICdub25lJywgb3BhY2l0eTogJzAnLCB0cmFuc2l0aW9uOiAnb3BhY2l0eSAyLjVzIGVhc2UnLCB9KTsKICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoc3BhY2VWaWQpOwogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleURvd24pOwogICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgb25LZXlVcCk7CiAgICAgICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCJCSE9QIEtuaWZlIGVuYWJsZWQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJob3BLbmlmZUVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgb25LZXlEb3duKTsKICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXl1cCcsIG9uS2V5VXApOwogICAgICAgICAgICAgICAgaWYgKHNwYWNlVmlkKSB7IHNwYWNlVmlkLnBhdXNlKCk7IGlmIChzcGFjZVZpZC5wYXJlbnROb2RlKSBzcGFjZVZpZC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHNwYWNlVmlkKTsgc3BhY2VWaWQgPSBudWxsOyB9CiAgICAgICAgICAgICAgICBzcGFjZUhlbGQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmIChmYWRlVm9sdW1lSW50ZXJ2YWwpIGNsZWFySW50ZXJ2YWwoZmFkZVZvbHVtZUludGVydmFsKTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIkJIT1AgS25pZmUgZGlzYWJsZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1hdXRvLXN3Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBpZiAocHJlQ2hlY2soIkF1dG8gU1ciKSkgYXV0b1NXKCk7IH0pOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLXhwLWR1cGVyJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyB0cmlnZ2VyWFBEdXBlcigpOyB9KTsKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1ub2NsaXAtcGxhY2UnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGlmICghcHJlQ2hlY2soIk5vY2xpcCBQbGFjZSIpKSByZXR1cm47CiAgICAgICAgICAgIGxldCBwb3MgPSBGdXhueS5lbnRpdGllcy5nZXRTdGF0ZSgxLCAncG9zaXRpb24nKS5wb3NpdGlvbjsKICAgICAgICAgICAgRnV4bnkuZW50aXRpZXMuc2V0UG9zaXRpb24oMSwgcG9zWzBdLCBwb3NbMV0sIHBvc1syXSArIDEpOwogICAgICAgICAgICBsZXQgcGxheWVyRW50aXR5ID0gci52YWx1ZXMoRnV4bnkuZW50aXRpZXNbRnV4bnkuaW1wS2V5XSlbMjJdLmxpc3RbMF07CiAgICAgICAgICAgIHBsYXllckVudGl0eS5fYmxvY2tJdGVtLnBsYWNlQmxvY2soKTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gLS0tIFZpc3VhbHMgLS0tCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hhY2stZXNwJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJFU1AiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgZXNwRW5hYmxlZCA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgICAgICAgIGNvbnN0IGdyb3VwSWQgPSBlc3BFbmFibGVkID8gMiA6IDA7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHIudmFsdWVzKEZ1eG55LnJlbmRlcmluZylbMThdLnRoaW5NZXNoZXMpKSB7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHRoaW5NZXNoIG9mIHIudmFsdWVzKEZ1eG55LnJlbmRlcmluZylbMThdLnRoaW5NZXNoZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodGhpbk1lc2g/Lm1lc2ggJiYgdHlwZW9mIHRoaW5NZXNoLm1lc2gucmVuZGVyaW5nR3JvdXBJZCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpbk1lc2gubWVzaC5yZW5kZXJpbmdHcm91cElkID0gZ3JvdXBJZDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbihgRVNQICR7ZXNwRW5hYmxlZCA/ICdlbmFibGVkJyA6ICdkaXNhYmxlZCd9YCk7CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLWNoZXN0LWVzcCcpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHsKICAgICAgICAgICAgaWYgKCFwcmVDaGVjaygiQ2hlc3QgRVNQIiwgZS50YXJnZXQpKSByZXR1cm47CiAgICAgICAgICAgIGNoZXN0RVNQRW5hYmxlZCA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgICAgICAgIGlmIChjaGVzdEVTUEVuYWJsZWQgfHwgb3JlRVNQRW5hYmxlZCkgewogICAgICAgICAgICAgICAgaWYgKCFjaGVzdE9yZUludGVydmFsKSB7IGNoZXN0T3JlSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChzY2FuQWxsQ2h1bmtzLCA1MDAwKTsgfQogICAgICAgICAgICAgICAgc2NhbkFsbENodW5rcygpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGNoZXN0T3JlSW50ZXJ2YWwpIHsgY2xlYXJJbnRlcnZhbChjaGVzdE9yZUludGVydmFsKTsgY2hlc3RPcmVJbnRlcnZhbCA9IG51bGw7IH0KICAgICAgICAgICAgICAgIGNsZWFyRVNQQm94ZXMoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKGBDaGVzdCBFU1AgJHtjaGVzdEVTUEVuYWJsZWQgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApOwogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1vcmUtZXNwJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJPcmUgRVNQIiwgZS50YXJnZXQpKSByZXR1cm47CiAgICAgICAgICAgIG9yZUVTUEVuYWJsZWQgPSBlLnRhcmdldC5jaGVja2VkOwogICAgICAgICAgICBpZiAoY2hlc3RFU1BFbmFibGVkIHx8IG9yZUVTUEVuYWJsZWQpIHsKICAgICAgICAgICAgICAgIGlmICghY2hlc3RPcmVJbnRlcnZhbCkgeyBjaGVzdE9yZUludGVydmFsID0gc2V0SW50ZXJ2YWwoc2NhbkFsbENodW5rcywgNTAwMCk7IH0KICAgICAgICAgICAgICAgIHNjYW5BbGxDaHVua3MoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChjaGVzdE9yZUludGVydmFsKSB7IGNsZWFySW50ZXJ2YWwoY2hlc3RPcmVJbnRlcnZhbCk7IGNoZXN0T3JlSW50ZXJ2YWwgPSBudWxsOyB9CiAgICAgICAgICAgICAgICBjbGVhckVTUEJveGVzKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbihgT3JlIEVTUCAke29yZUVTUEVuYWJsZWQgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApOwogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1oaXRib3hlcycpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHsKICAgICAgICAgICAgaWYgKCFwcmVDaGVjaygiSGl0Ym94ZXMiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgaGl0Qm94RW5hYmxlZCA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgICAgICAgIGZvciAoY29uc3QgZUlkIGluIGhpdGJveGVzKSB7CiAgICAgICAgICAgICAgICBjb25zdCBib3ggPSBoaXRib3hlc1tlSWRdOwogICAgICAgICAgICAgICAgaWYgKGJveCkgYm94LmlzVmlzaWJsZSA9IGhpdEJveEVuYWJsZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbihgSGl0Ym94ZXMgJHtoaXRCb3hFbmFibGVkID8gJ2VuYWJsZWQnIDogJ2Rpc2FibGVkJ31gKTsKICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hhY2stbmFtZXRhZ3MnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgIGlmICghcHJlQ2hlY2soIk5hbWV0YWdzIiwgZS50YXJnZXQpKSByZXR1cm47CiAgICAgICAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICBuYW1lVGFnc0VuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgaWYgKCFjYWNoZWROYW1lVGFnUGFyZW50KSB7IG5hbWVUYWdzRW5hYmxlZCA9IGZhbHNlOyByZXR1cm47IH0KICAgICAgICAgICAgICAgIG5hbWVUYWdQYXJlbnQgPSBjYWNoZWROYW1lVGFnUGFyZW50OwogICAgICAgICAgICAgICAgbmFtZVRhZ3NJbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVudGl0eUxpc3QgPSBGdXhueS5lbnRpdHlMaXN0OwogICAgICAgICAgICAgICAgICAgIGlmICghZW50aXR5TGlzdCkgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qgc3ViR3JvdXAgb2YgT2JqZWN0LnZhbHVlcyhlbnRpdHlMaXN0KSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN1Ykdyb3VwKSBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBvYmogb2YgT2JqZWN0LnZhbHVlcyhzdWJHcm91cCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmo/LmxvYmJ5TGVhZGVyYm9hcmRWYWx1ZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCAnaGFzUHJpb3JpdHlOYW1ldGFnJywgeyBnZXQ6ICgpID0+IHRydWUsIHNldCh2KXt9LCBjb25maWd1cmFibGU6IHRydWUgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosICdjYW5TZWUnLCB7IGdldDogKCkgPT4gdHJ1ZSwgc2V0KHYpe30sIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG5hbWVUYWdQYXJlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFnID0gbmFtZVRhZ1BhcmVudDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhZyAmJiB0eXBlb2YgdGFnID09PSAnb2JqZWN0JyAmJiB0YWcuaWQ/LmluY2x1ZGVzKCdOYW1lVGFnJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhZywgJ19pc1Zpc2libGUnLCB7IGdldDogKCkgPT4gdHJ1ZSwgc2V0KHYpe30sIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFnLCAncmVuZGVyaW5nR3JvdXBJZCcsIHsgZ2V0OiAoKSA9PiAzLCBzZXQodil7fSwgY29uZmlndXJhYmxlOiB0cnVlIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIDE1MDAwKTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIk5hbWV0YWdzIGVuYWJsZWQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG5hbWVUYWdzRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChuYW1lVGFnc0ludGVydmFsSWQpOwogICAgICAgICAgICAgICAgbmFtZVRhZ3NJbnRlcnZhbElkID0gbnVsbDsKICAgICAgICAgICAgICAgIGlmIChuYW1lVGFnUGFyZW50KSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gbmFtZVRhZ1BhcmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YWcgPSBuYW1lVGFnUGFyZW50W2tleV07CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWcgJiYgdHlwZW9mIHRhZyA9PT0gJ29iamVjdCcgJiYgdGFnLmlkPy5pbmNsdWRlcygnTmFtZVRhZycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSB0YWcuX2lzVmlzaWJsZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGFnLl9pc1Zpc2libGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFnLl9pc1Zpc2libGUgPSBjdXJyZW50OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG5hbWVUYWdQYXJlbnQgPSBudWxsOwogICAgICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiTmFtZXRhZ3MgZGlzYWJsZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1lbmVteS1oZWFsdGgnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJFbmVteSBIZWFsdGgiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgIGlmIChlLnRhcmdldC5jaGVja2VkKSB7CiAgICAgICAgICAgICAgICAgc3RhcnRIZWFsdGhXYXRjaGVyKCk7CiAgICAgICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiRW5lbXkgSGVhbHRoIGVuYWJsZWQiKTsKICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoaGVhbHRoV2F0Y2hlckludGVydmFsKSBjbGVhckludGVydmFsKGhlYWx0aFdhdGNoZXJJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBpZiAocmVzZXRUaW1lb3V0KSBjbGVhclRpbWVvdXQocmVzZXRUaW1lb3V0KTsKICAgICAgICAgICAgICAgIHNldEhlYWx0aEJhcigxMDAsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGxhc3RQZXJjZW50ID0gbnVsbDsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIkVuZW15IEhlYWx0aCBkaXNhYmxlZCIpOwogICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1uaWdodCcpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHsKICAgICAgICAgICAgaWYgKCFwcmVDaGVjaygiTmlnaHQiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgaWYoZS50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgICAgICAgaWYoIXNreWJveE1lc2gpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDAwOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzaFN0YXRlID0gRnV4bnkuZW50aXRpZXMuZ2V0U3RhdGUoaSwgIm1lc2giKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1lc2hTdGF0ZT8ubWVzaD8uaWQgPT09ICJza3lCb3giKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBza3lib3hFbnRpdHkgPSBpOyBza3lib3hNZXNoID0gbWVzaFN0YXRlLm1lc2g7IGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYoc2t5Ym94TWVzaCkgc2t5Ym94TWVzaC5pc1Zpc2libGUgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIk5pZ2h0IGVuYWJsZWQiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmKHNreWJveE1lc2gpIHNreWJveE1lc2guaXNWaXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIk5pZ2h0IGRpc2FibGVkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hhY2stYmlnaGVhZHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgIGlmICghcHJlQ2hlY2soIkJpZ2hlYWRzIiwgZS50YXJnZXQpKSByZXR1cm47CiAgICAgICAgICAgIGNvbnN0IG9iamVjdERhdGEgPSByLnZhbHVlcyhGdXhueS5yZW5kZXJpbmcpWzE4XS5vYmplY3REYXRhOwogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIG9iamVjdERhdGEpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0gb2JqZWN0RGF0YVtrZXldOwogICAgICAgICAgICAgICAgICAgIGlmIChvYmo/LnR5cGUgPT09ICJQbGF5ZXIiICYmIG9iai5ub2Rlcz8uWzE2XSAmJiBvYmogIT09IG9iamVjdERhdGFbMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5vZGUgPSBvYmoubm9kZXNbMTZdOwogICAgICAgICAgICAgICAgICAgICAgICBub2RlLnNjYWxlLl94ID0gNjsgbm9kZS5zY2FsZS5feSA9IDY7IG5vZGUuc2NhbGUuX3ogPSA2OwogICAgICAgICAgICAgICAgICAgICAgICBub2RlLnBvc2l0aW9uLl95ID0gLTE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYmlnSGVhZHNJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gb2JqZWN0RGF0YSkgewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0gb2JqZWN0RGF0YVtrZXldOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAob2JqPy50eXBlID09PSAiUGxheWVyIiAmJiBvYmoubm9kZXM/LlsxNl0gJiYgb2JqICE9PSBvYmplY3REYXRhWzFdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbm9kZSA9IG9iai5ub2Rlc1sxNl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5zY2FsZS5feCA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2NhbGUuX3ggPSA2OyBub2RlLnNjYWxlLl95ID0gNjsgbm9kZS5zY2FsZS5feiA9IDY7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9kZS5wb3NpdGlvbi5feSA9IC0xOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgMTAwMDApOwogICAgICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiQmlnaGVhZHMgZW5hYmxlZCIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIG9iamVjdERhdGEpIHsKICAgICAgICAgICAgICAgICAgICBsZXQgb2JqID0gb2JqZWN0RGF0YVtrZXldOwogICAgICAgICAgICAgICAgICAgIGlmIChvYmo/LnR5cGUgPT09ICJQbGF5ZXIiICYmIG9iai5ub2Rlcz8uWzE2XSAmJiBvYmogIT09IG9iamVjdERhdGFbMV0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBub2RlID0gb2JqLm5vZGVzWzE2XTsKICAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUuc2NhbGUuX3ggPSAxOyBub2RlLnNjYWxlLl95ID0gMTsgbm9kZS5zY2FsZS5feiA9IDE7CiAgICAgICAgICAgICAgICAgICAgICAgICBub2RlLnBvc2l0aW9uLl95ID0gMC43MTk5OTk5NjkwMDU1ODQ3OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYmlnSGVhZHNJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBiaWdIZWFkc0ludGVydmFsID0gbnVsbDsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIkJpZ2hlYWRzIGRpc2FibGVkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gLS0tIEV4cGVyaW1lbnRhbCAtLS0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1ibGluaycpPy5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBlID0+IHsKICAgICAgICAgICAgaWYgKCFwcmVDaGVjaygiQmxpbmsiLCBlLnRhcmdldCkpIHJldHVybjsKICAgICAgICAgICAgdG9nZ2xlQmxpbmsoKTsKICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbihgQmxpbmsgJHtibGlua1N0YXRlLmVuYWJsZWQgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnfWApOwogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1waWNrdXAtcmVhY2gnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZSA9PiB7CiAgICAgICAgICAgIGlmICghcHJlQ2hlY2soIlBpY2t1cCBSZWFjaCIsIGUudGFyZ2V0KSkgcmV0dXJuOwogICAgICAgICAgICBpZiAoZS50YXJnZXQuY2hlY2tlZCkgewogICAgICAgICAgICAgICAgIGlmICghcHJvdG8gfHwgIW9yaWdpbmFsR2V0RW50aXRpZXNJbkFBQkIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBjbHMgPSBmaW5kQ2xhc3NDb25zdHJ1Y3RvcihGdXhueS5ub2EuZW50aXRpZXMpOwogICAgICAgICAgICAgICAgICAgIGlmICghY2xzKSB7IGNvbnNvbGUud2FybigiW3BpY2t1cFJlYWNoXSBDb3VsZCBub3QgZmluZCBjbGFzcyBjb25zdHJ1Y3RvciIpOyByZXR1cm47IH0KICAgICAgICAgICAgICAgICAgICBjb25zdCBnaE1ldGhvZCA9IGZpbmRHaE1ldGhvZChjbHMpOwogICAgICAgICAgICAgICAgICAgIGlmICghZ2hNZXRob2QpIHsgY29uc29sZS53YXJuKCJbcGlja3VwUmVhY2hdIENvdWxkIG5vdCBmaW5kIGdldEVudGl0aWVzSW5BQUJCIG1ldGhvZCIpOyByZXR1cm47IH0KICAgICAgICAgICAgICAgICAgICBwcm90byA9IGNscy5wcm90b3R5cGU7CiAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxHZXRFbnRpdGllc0luQUFCQiA9IGdoTWV0aG9kLmZuOwogICAgICAgICAgICAgICAgICAgIGdoTWV0aG9kS2V5ID0gZ2hNZXRob2Qua2V5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcHJvdG9bZ2hNZXRob2RLZXldID0gZnVuY3Rpb24oYm94LCBuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VudGVyID0gWyhib3guYmFzZVswXSArIGJveC5tYXhbMF0pIC8gMiwgKGJveC5iYXNlWzFdICsgYm94Lm1heFsxXSkgLyAyLCAoYm94LmJhc2VbMl0gKyBib3gubWF4WzJdKSAvIDJdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhbGZTaXplID0gWyhib3gubWF4WzBdIC0gYm94LmJhc2VbMF0pIC8gMiwgKGJveC5tYXhbMV0gLSBib3guYmFzZVsxXSkgLyAyLCAoYm94Lm1heFsyXSAtIGJveC5iYXNlWzJdKSAvIDJdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGVubGFyZ2VkID0geyBiYXNlOiBjZW50ZXIubWFwKChjLCBpKSA9PiBjIC0gaGFsZlNpemVbaV0gKiBSQU5HRV9NVUxUSVBMSUVSKSwgbWF4OiBjZW50ZXIubWFwKChjLCBpKSA9PiBjICsgaGFsZlNpemVbaV0gKiBSQU5HRV9NVUxUSVBMSUVSKSB9OwogICAgICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbEdldEVudGl0aWVzSW5BQUJCLmNhbGwodGhpcywgZW5sYXJnZWQsIG5hbWUpOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHBpY2t1cFJlYWNoRW5hYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCJQaWNrdXAgUmVhY2ggZW5hYmxlZCIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYocHJvdG8gJiYgZ2hNZXRob2RLZXkpIHByb3RvW2doTWV0aG9kS2V5XSA9IG9yaWdpbmFsR2V0RW50aXRpZXNJbkFBQkI7CiAgICAgICAgICAgICAgICBwaWNrdXBSZWFjaEVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIlBpY2t1cCBSZWFjaCBkaXNhYmxlZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLXNwYXduLXRlbGVwb3J0Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJTcGF3biBUZWxlcG9ydCIpKSByZXR1cm47CiAgICAgICAgICAgIGZ1bmN0aW9uIGZpbmRFbGVtZW50QnlUZXh0KHRleHQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ2Rpdiwgc3BhbiwgYnV0dG9uLCBhJyk7CiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVsIG9mIGFsbCkgaWYgKGVsLnRleHRDb250ZW50LnRyaW0oKSA9PT0gdGV4dCkgcmV0dXJuIGVsOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgdGVsZXBvcnRCdXR0b25UZXh0ID0gZmluZEVsZW1lbnRCeVRleHQoJ1RlbGVwb3J0IFRvIExvYmJ5IFNwYXduJyk7CiAgICAgICAgICAgIGlmICh0ZWxlcG9ydEJ1dHRvblRleHQpIHsKICAgICAgICAgICAgICAgIGxldCBjbGlja2FibGUgPSB0ZWxlcG9ydEJ1dHRvblRleHQ7CiAgICAgICAgICAgICAgICB3aGlsZSAoY2xpY2thYmxlICYmICFjbGlja2FibGUub25jbGljayAmJiBjbGlja2FibGUudGFnTmFtZSAhPT0gJ0JVVFRPTicpIGNsaWNrYWJsZSA9IGNsaWNrYWJsZS5wYXJlbnRFbGVtZW50OwogICAgICAgICAgICAgICAgaWYgKGNsaWNrYWJsZSkgY2xpY2thYmxlLmNsaWNrKCk7CiAgICAgICAgICAgICAgICBlbHNlIHRlbGVwb3J0QnV0dG9uVGV4dC5jbGljaygpOwogICAgICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiVGVsZXBvcnRpbmcgdG8gc3Bhd24uLi4iKTsKICAgICAgICAgICAgfSBlbHNlIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIlRlbGVwb3J0IGJ1dHRvbiBub3QgZm91bmQuIik7CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLWFudGktd2ViJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJBbnRpLVdlYiIpKSByZXR1cm47CiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGdXhueS5lbnRpdGllc1tGdXhueS5pbXBLZXldLm1vdmVTdGF0ZS5saXN0WzBdLnNwZWVkTXVsdGlwbGllci5tdWx0aXBsaWVycywgImluQ29id2ViIiwgeyBjb25maWd1cmFibGU6IHRydWUsIGVudW1lcmFibGU6IHRydWUsIGdldCgpIHsgcmV0dXJuIDE7IH0sIHNldCh2YWx1ZSkge30gfSk7CiAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIkFudGktV2ViIGFwcGxpZWQiKTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gLS0tIFNldHRpbmdzIC0tLQogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLWFudGktYmFuJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGUgPT4gewogICAgICAgICAgICBhbnRpQmFuRW5hYmxlZCA9IGUudGFyZ2V0LmNoZWNrZWQ7CiAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oYEFudGktQmFuIE1vZGUgJHthbnRpQmFuRW5hYmxlZCA/ICdFTkFCTEVEJyA6ICdESVNBQkxFRCd9YCk7CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLWhlYWx0aC1jb2xvcicpPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgIGNvbnN0IGhlYWx0aEJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIkJvdHRvbVNjcmVlblN0YXRCYXIiKVswXTsKICAgICAgICAgICAgIGlmIChoZWFsdGhCYXIpIHsKICAgICAgICAgICAgICAgIGhlYWx0aEJhci5zdHlsZS5iYWNrZ3JvdW5kID0gZGVmYXVsdEFjY2VudDsKICAgICAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIkhlYWx0aCBiYXIgY29sb3Igc2V0Iik7CiAgICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLXJhbmtzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICBpZiAoIXByZUNoZWNrKCJSYW5rcyIpKSByZXR1cm47CiAgICAgICAgICAgIEZ1eG55LmVudGl0eUxpc3RbMV1bMV0ucmFua3NbMF0gPSAiZGV2ZWxvcGVyIjsKICAgICAgICAgICAgRnV4bnkuZW50aXR5TGlzdFsxXVsxXS5yYW5rc1sxXSA9ICJ5b3V0dWJlciI7CiAgICAgICAgICAgIEZ1eG55LmVudGl0eUxpc3RbMV1bMV0ucmFua3NbMl0gPSAic3VwZXIiOwogICAgICAgICAgICBzaG93VGVtcG9yYXJ5Tm90aWZpY2F0aW9uKCJSYW5rcyBzcG9vZmVkIik7CiAgICAgICAgfSk7CgogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoYWNrLXBsYXllci1jb29yZHMnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgICAgIGlmICghcHJlQ2hlY2soIlBsYXllciBDb29yZHMiKSkgcmV0dXJuOwogICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBGdXhueS5ibG94ZC5lbnRpdHlOYW1lcykgewogICAgICAgICAgICAgICAgaWYgKGtleSA9PT0gIjEiKSBjb250aW51ZTsKICAgICAgICAgICAgICAgIGNvbnN0IG5hbWVPYmogPSBGdXhueS5ibG94ZC5lbnRpdHlOYW1lc1trZXldOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhdGUgPSBGdXhueS5lbnRpdGllcy5nZXRTdGF0ZShrZXksICdwb3NpdGlvbicpOwogICAgICAgICAgICAgICAgaWYgKCFzdGF0ZSB8fCAhc3RhdGUucG9zaXRpb24pIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgY29uc3QgcG9zID0gc3RhdGUucG9zaXRpb247CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5yb3VuZChwb3NbMF0pOyBjb25zdCB5ID0gTWF0aC5yb3VuZChwb3NbMV0pOyBjb25zdCB6ID0gTWF0aC5yb3VuZChwb3NbMl0pOwogICAgICAgICAgICAgICAgY29uc3QgYmFzZU5hbWUgPSBuYW1lT2JqLmVudGl0eU5hbWUucmVwbGFjZSgvXHMqXChcLT9cZCssXHMqXC0/XGQrLFxzKlwtP1xkK1wpJC8sICIiKTsKICAgICAgICAgICAgICAgIG5hbWVPYmouZW50aXR5TmFtZSA9IGAke2Jhc2VOYW1lfSAoJHt4fSwgJHt5fSwgJHt6fSlgOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNob3dUZW1wb3JhcnlOb3RpZmljYXRpb24oIlBsYXllciBjb29yZHMgdXBkYXRlZCBpbiBsZWFkZXJib2FyZCIpOwogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1wdXJnZS1jb29raWVzJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICB3aW5kb3cub25iZWZvcmV1bmxvYWQgPSBudWxsOwogICAgICAgICAgICBjb25zdCBkZWxldGVDb29raWUgPSAobmFtZSwgcGF0aCA9ICIvIiwgZG9tYWluID0gIiIpID0+IHsKICAgICAgICAgICAgICAgIGxldCBjb29raWVTdHIgPSBgJHtuYW1lfT07ZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIEdNVDtwYXRoPSR7cGF0aH07YDsKICAgICAgICAgICAgICAgIGlmIChkb21haW4pIGNvb2tpZVN0ciArPSBgZG9tYWluPSR7ZG9tYWlufTtgOwogICAgICAgICAgICAgICAgZG9jdW1lbnQuY29va2llID0gY29va2llU3RyOwogICAgICAgICAgICB9OwogICAgICAgICAgICBjb25zdCBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCI7Iik7CiAgICAgICAgICAgIGNvb2tpZXMuZm9yRWFjaChjb29raWUgPT4gewogICAgICAgICAgICAgICAgY29uc3QgZXFQb3MgPSBjb29raWUuaW5kZXhPZigiPSIpOwogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGVxUG9zID4gLTEgPyBjb29raWUuc2xpY2UoMCwgZXFQb3MpLnRyaW0oKSA6IGNvb2tpZS50cmltKCk7CiAgICAgICAgICAgICAgICBkZWxldGVDb29raWUobmFtZSwgIi8iKTsKICAgICAgICAgICAgICAgIGNvbnN0IGhvc3RuYW1lID0gbG9jYXRpb24uaG9zdG5hbWU7CiAgICAgICAgICAgICAgICBjb25zdCBkb21haW5QYXJ0cyA9IGhvc3RuYW1lLnNwbGl0KCIuIik7CiAgICAgICAgICAgICAgICBpZiAoZG9tYWluUGFydHMubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VEb21haW4gPSBkb21haW5QYXJ0cy5zbGljZSgtMikuam9pbigiLiIpOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZUNvb2tpZShuYW1lLCAiLyIsIGJhc2VEb21haW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgc2hvd1RlbXBvcmFyeU5vdGlmaWNhdGlvbigiQ29va2llcyBwdXJnZWQuIFJlbG9hZGluZy4uLiIpOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IGxvY2F0aW9uLnJlbG9hZCgpLCAxNTApOwogICAgICAgIH0pOwoKICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaGFjay1kaXNjb3JkJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgICAgICB3aW5kb3cub3BlbigiaHR0cHM6Ly9kaXNjb3JkLmdnL0c2a3NGZlFkYVciLCAiX2JsYW5rIik7CiAgICAgICAgfSk7CiAgICB9CgogICAgc2V0dXBIYWNrRXZlbnRMaXN0ZW5lcnMoKTsKCiAgICBjb25zdCBtb2R1bGVzVG9SZW5kZXIgPSBbXTsKICAgIGZ1bmN0aW9uIHJlbmRlckxvb3AoKSB7CiAgICAgICAgZm9yIChjb25zdCBtb2R1bGUgb2YgbW9kdWxlc1RvUmVuZGVyKSB7CiAgICAgICAgICAgIG1vZHVsZS5vblJlbmRlcigpOwogICAgICAgIH0KICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVuZGVyTG9vcCk7CiAgICB9CiAgICByZW5kZXJMb29wKCk7Cn0pKCk7CgoKKE9rIGl0J3MgYSBsb25nIGNvZGUsIGJ1dCB3b3Jrcy4gRXZlbiBEZWVwU2VlayBkb24ndCBrbm93IGhvdyBpdCB3b3JrcyBsb2wgYnJ1aC4uLi4uLikKClRoZXJlIGFyZSBqdXN0IHRvbyBtdWNoIGNsaWVudHMgb24gR3JlYXN5Rm9yayBzbyBnbyBmaW5kIG91dCB5b3Vyc2VsZiA9RCBodHRwczovL2dyZWFzeWZvcmsub3JnL2VuL3NjcmlwdHMvYnktc2l0ZS9ibG94ZC5pbwoKSG93IHRvIGdvIGludG8gQmxveGQuaW8gd2l0aG91dCBoYXZpbmcgdG8gd29ycnkgYWJvdXQgVlBOIGJsb2NrczoKClVzZSBPUEVSQSBHWCBhbmQgdXNlIGl0cyBWUE4gdG8gZW50ZXIgY3JhenlnYW1lcy5jb20vZ2FtZS9ibG94ZGhvcC1pby4gWW91IGRpZCBpdCEgSXQgaXMgU1VQRVIgc2xvdywgYnV0IGl0IHdvcmtzLgoKCuKVreKUgOKUgOKUgOKUgOKUgOKVrgrilIIgVlBOIOKUggrilbDilIDilIDilIDilIDilIDila8KClZQTiBpcyBibG9ja2VkLCBidXQgaG93ZXZlciwgd2UgY2FuIHN0aWxsIGdldCBhY2Nlc3MgdG8gdGhvc2UgU1VQRVIgVEFTVFkgSVAgQ0hBTkdFUlMuIAoKRmlyc3QgdXNhYmxlIFZQTiBkaXNjb3ZlcmVkIGJ5IFtVTktOT1dOXTogaHR0cHM6Ly93d3cuaG90c3BvdHNoaWVsZC5jb20vemgvbWlhbmZlaS12cG4vClNlY29uZCB1c2FibGUgVlBOIGRpc2NvdmVyZWQgYnkgSXRzTXJFcmljOiBodHRwczovL3Byb3RvbnZwbi5jb20vZG93bmxvYWQ/c3JzbHRpZD1BZm1CT29wUDhhTHIxRHZVMlJUeVJNdEVoRm01b0dtM21IYnJHWmVyVDRVQzBQSDB3UVExOXU3aQpTdGlsbCwgdGhlcmUncyBtYW55IGZyZWUgVlBOIHNvZnR3YXJlcyBzaXR0aW5nIGFyb3VuZCBvbiB0aGUgaW50ZXJuZXQuCg=="
            // "Image Editor Pro.zip": "base64datahere",
            // etc.
        };

        // Function to download files from Base64 data
        function downloadFromBase64(filename, fileType, base64Data) {
            // Create a temporary link element
            const link = document.createElement('a');
            link.style.display = 'none';
            
            // Convert Base64 to Blob
            const byteCharacters = atob(base64Data);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: fileType });
            
            // Create object URL and set as href
            const url = URL.createObjectURL(blob);
            link.href = url;
            link.download = filename;
            
            // Append to body, click, and remove
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Clean up the URL object
            setTimeout(() => URL.revokeObjectURL(url), 100);
        }

        // Add animation to download items when they come into view
        document.addEventListener('DOMContentLoaded', function() {
            const downloadItems = document.querySelectorAll('.download-item');
            
            downloadItems.forEach((item, index) => {
                // Add slight delay for staggered animation
                setTimeout(() => {
                    item.style.animation = 'slideIn 0.5s ease forwards';
                }, index * 100);
            });
            
            // Add click effect to download buttons
            const downloadButtons = document.querySelectorAll('.download-btn');
            downloadButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    const filename = this.getAttribute('data-filename');
                    const filetype = this.getAttribute('data-filetype');
                    
                    // Check if we have Base64 data for this file
                    if (fileData[filename]) {
                        // Add visual feedback
                        const originalText = this.textContent;
                        this.textContent = 'Downloading...';
                        this.style.backgroundColor = '#2e6ab3';
                        
                        // Download the file
                        downloadFromBase64(filename, filetype, fileData[filename]);
                        
                        // Reset after a short delay
                        setTimeout(() => {
                            this.textContent = originalText;
                            this.style.backgroundColor = '';
                        }, 1500);
                    } else {
                        // If no Base64 data is available, show an alert
                        alert('File data not available yet. Please add the Base64 data to the fileData object.');
                        
                        // Add visual feedback for error
                        const originalText = this.textContent;
                        this.textContent = 'Data Missing';
                        this.style.backgroundColor = '#e74c3c';
                        
                        // Reset after a short delay
                        setTimeout(() => {
                            this.textContent = originalText;
                            this.style.backgroundColor = '';
                        }, 1500);
                    }
                });
            });
        });
    </script>
</body>
</html>
